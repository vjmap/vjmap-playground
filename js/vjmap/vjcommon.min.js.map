{"version":3,"file":"vjcommon.min.js","sources":["../src/utils.ts","../src/layers/base.ts","../src/layers/line.ts","../src/layers/fill.ts","../src/layers/symbol.ts","../src/layers/circle.ts","../src/layers/fillExtrusion.ts","../src/layers/heatmap.ts","../src/layers/marker.ts","../src/layers/popup.ts","../src/layers/animateLine.ts","../src/layers/animateSymbol.ts","../src/layers/animateFill.ts","../src/layers/symbolCluster.ts","../src/layers/markerCluster.ts","../src/layers/text.ts","../src/layers/breathingMarker.ts","../src/layers/rotatingMarker.ts","../src/layers/haloRingMarker.ts","../src/layers/diffusedMarker.ts","../src/layers/textBorderMarker.ts","../src/layers/fluorescenceMarker.ts","../src/layers/curve.ts","../src/layers/lineExtrusions.ts","../src/layers/arrowLine.ts","../src/layers/pathAnimate.ts","../src/layers/symbolPathAnimate.ts","../src/layers/fillExtrusionsAnimate.ts","../src/layers/geojson.ts","../src/layers/draw.ts","../src/layers/raster.ts","../src/layers/vector.ts","../src/layers/divOverlay.ts","../src/layers/svgOverlay.ts","../src/layers/background.ts","../src/layers/sky.ts","../src/layers/index.ts","../src/cache/indexDb.ts","../src/cache/index.ts","../src/map/query.ts","../src/sysImages/index.ts","../src/sysImages/scatterDot.ts","../src/sysImages/pulsingDot.ts","../src/web/provider.ts","../src/map/setting.ts","../src/map/wms.ts","../src/map/keyboard.ts","../src/MapApp.ts","../src/draw/export.ts","../src/map/highlight.ts","../src/map/snap.ts","../src/map/select.ts","../src/draw/entity.ts","../src/draw/util.ts","../src/map/layer.ts","../src/map/measure.ts","../src/map/style.ts"],"sourcesContent":["import { MapLayer } from \"./types\";\r\nimport vjmap, { Map } from 'vjmap'\r\nimport * as common from './export'\r\nexport function toMapLayer(\r\n  layer: MapLayer,\r\n  props: Record<string, any>\r\n): MapLayer {\r\n  return {\r\n    layerId: layer.layerId,\r\n    sourceId: layer.sourceId,\r\n    tag: layer.tag,\r\n    type: layer.type,\r\n    before: layer.before,\r\n    visibleOff: layer.visibleOff,\r\n    ...props,\r\n  };\r\n}\r\n\r\n\r\nexport function sleep(ms?: number) {\r\n  return new Promise(resolve => setTimeout(resolve, ms ?? 100))\r\n}\r\n\r\n// 执行代码\r\nexport async function execProgram(code: string, map: Map, mapApp: any, context?: any) {\r\n  // 通过新的方法创建异步函数\r\n  const AsyncFunction = Object.getPrototypeOf(async function(){}).constructor;\r\n  // 使用\r\n  const asyncFunc = new AsyncFunction(\"vjmap\", \"map\", \"mapApp\", \"context\", \"vjcommon\", code);\r\n  let result = await asyncFunc(vjmap, map, mapApp, context, common);\r\n  return result;\r\n}\r\n\r\n// 获取ShardsUrl\r\nexport const getShardsTileUrl = (tileUrl: string, map?: Map) => {\r\n  if (!tileUrl) return [tileUrl];\r\n  if (map) {\r\n    let svc = map.getService();\r\n    tileUrl = tileUrl.replace(\"{serviceUrl}\", svc.serverUrl);\r\n    tileUrl = tileUrl.replace(\"{accessToken}\", svc.accessToken);\r\n  }\r\n  let reg = /{(\\d+-\\d+)}/g;\r\n  let matched = reg.exec(tileUrl);\r\n  if (!matched) return [ tileUrl ];\r\n  let match = matched[0];\r\n  if (!match) return [ tileUrl ];\r\n  match = match.replace(\"{\", \"\");\r\n  match = match.replace(\"}\", \"\");\r\n  let items = match.split(\"-\");\r\n  if (items.length != 2) return [ tileUrl ];\r\n  let n1 = +items[0];\r\n  let n2 = +items[1];\r\n  if (n2 <= n1) return [ tileUrl ];\r\n  let urls = [];\r\n  for(let n = n1 ; n <= n2; n++) {\r\n    urls.push(tileUrl.replace(matched[0], n + \"\"));\r\n  }\r\n  return urls;\r\n}\r\n\r\n// 获取TileShards\r\nexport const getTileShards = (tileUrl: string) => {\r\n  if (!tileUrl) return {\r\n    tileUrl,\r\n    tileShards: \"\"\r\n  };\r\n  let reg = /{(\\d+-\\d+)}/g;\r\n  let matched = reg.exec(tileUrl);\r\n  if (!matched) return {\r\n    tileUrl,\r\n    tileShards: \"\"\r\n  };\r\n  let match = matched[0];\r\n  if (!match) return {\r\n    tileUrl,\r\n    tileShards: \"\"\r\n  };\r\n  const newTileUrl = tileUrl.replace(match, \"{s}\");\r\n  match = match.replace(\"{\", \"\");\r\n  match = match.replace(\"}\", \"\");\r\n  let items = match.split(\"-\");\r\n  if (items.length != 2) return {\r\n    tileUrl,\r\n    tileShards: \"\"\r\n  };;\r\n  let n1 = +items[0];\r\n  let n2 = +items[1];\r\n  if (n2 <= n1) return {\r\n    tileUrl,\r\n    tileShards: \"\"\r\n  };\r\n  let tileShards = [];\r\n  for(let n = n1 ; n <= n2; n++) {\r\n    tileShards.push(n);\r\n  }\r\n  return {\r\n    tileUrl: newTileUrl,\r\n    tileShards: tileShards.join(\",\")\r\n  };\r\n}\r\n// 判断一个字符是英文字符或数字\r\nexport const isAlphanumeric = (char: string) => {\r\n  return /^[a-zA-Z0-9]+$/.test(char);\r\n}\r\n\r\n// 底图是否为互联网底图\r\nexport const isWebBaseMap = (baseMapType?: string) => {\r\n  return !(baseMapType == \"\" || baseMapType == \"CAD\" || baseMapType === undefined)\r\n}\r\n\r\n// 得到实体的objectID，在几何模式打开的情况下objectid有可能是块，会分成多个实体，而实际中是同一个，这里获取的是cad实体的objectid\r\nexport const getEntityObjectId = (id: string) => {\r\n  // id如 A0F$A10 或 380#26F&26C 这种格式，只要前面的一部分就是cad的实体objectid\r\n  let objectId = \"\";  \r\n  let k = 0;\r\n  for(k = 0; k < id.length; k++) { \r\n    if (isAlphanumeric(id[k])) {\r\n      objectId += id[k]\r\n    } else { \r\n      break;\r\n    }\r\n  } \r\n  return objectId;\r\n}\r\n\r\n\r\n// data geojson数据；basePt基点，destPt要移动至的位置；scale 缩放倍数，angle旋转角度, isGeoCoord传入的是否为几何坐标\r\nexport const transformGeoJsonData = (\r\n  map: Map,\r\n  data: any,\r\n  basePt: any,\r\n  destPt: any,\r\n  scale = 1.0,\r\n  angle = 0.0,\r\n  isGeoCoord = false\r\n) => {\r\n  return vjmap.transform.convert(data, (pt) => {\r\n    let point = isGeoCoord === true ? vjmap.geoPoint(pt) : map.fromLngLat(vjmap.geoPoint(pt));\r\n    point.transform(basePt, destPt, scale, angle);\r\n    return isGeoCoord === true ? [point.x, point.y] : map.toLngLat(point);\r\n  });\r\n};\r\n\r\n// data geojson数据；basePt基点，destPt要移动至的位置；scale 缩放倍数，angle旋转角度, isGeoCoord传入的是否为几何坐标\r\nexport const transformFourParam = (\r\n  map: Map,\r\n  data: any,\r\n  fourParam: any,\r\n  isGeoCoord = false\r\n) => {\r\n  return vjmap.transform.convert(data, (pt) => {\r\n    let point = isGeoCoord === true ? vjmap.geoPoint(pt) : map.fromLngLat(vjmap.geoPoint(pt));\r\n    let newPoint  = vjmap.coordTransfromByFourParamter(point, fourParam);\r\n    return isGeoCoord === true ? [newPoint.x, newPoint.y] : map.toLngLat(newPoint);\r\n  });\r\n};","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map, Marker } from \"vjmap\";\r\nimport { toMapLayer } from \"../utils\";\r\nexport default class LayerBase {\r\n    public map!: Map;\r\n    public mapLayer!: MapLayer;\r\n    public visibleOff?: boolean;\r\n    constructor() {\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n        this.map = map;\r\n        this.mapLayer = mapLayer;\r\n    }\r\n    setLayerStyle(map: Map, layerId: string, layerProps: Record<string, any>, oldLayer: MapLayer) {\r\n        this.mapLayer = toMapLayer(oldLayer, layerProps);\r\n        this.removeLayer(map, layerId);\r\n        this.addLayer(map, toMapLayer(oldLayer, layerProps));\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n      this.visibleOff = visibleOff;\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n\r\n    }\r\n    getLayerId(): string | string[] | undefined {\r\n        return this.mapLayer.layerId;\r\n    }\r\n    onSourceDataChange(map: Map, sourceId?: string, forceUpdate?: boolean, timerUpdate?: boolean) {\r\n        if (!this.mapLayer || !this.map) return;\r\n        if (sourceId && this.mapLayer.sourceId != sourceId) return;\r\n        if (this.mapLayer.disableTimerUpdate) return;\r\n        if (this.visibleOff === true) return;\r\n        this.removeLayer(map, this.mapLayer.layerId);\r\n        this.addLayer(map, this.mapLayer);\r\n    }\r\n    async loadUrlImage(src: string): Promise<HTMLImageElement> {\r\n        return new Promise((resolve, reject) => {\r\n            const image = new Image();\r\n            image.src = src;\r\n            image.onload = () => {\r\n                resolve(image)\r\n            }\r\n            image.onerror = ()=> {\r\n                reject(`load image ${src} error`)\r\n            }\r\n        })\r\n    }\r\n    // 执行字段中要执行的脚本值，包含\"return \"字符串的，都当成脚本处理\r\n    evalValue(options: Record<string, any> | string, properties: Record<string, any>, map: Map) {\r\n        if  (typeof options == \"string\") {\r\n            try {\r\n                return new Function(\"props\", \"map\", \"vjmap\", options)(properties, map, vjmap);\r\n            } catch (error) {\r\n            } \r\n        } else {\r\n            let newOpts: Record<string, any> = {};\r\n            for(let key in options) {\r\n                let value = options[key]\r\n                if (typeof(value) == \"string\" && value.indexOf(\"return \") >= 0) {\r\n                    try {\r\n                        value = new Function(\"props\", \"map\", \"vjmap\", value)(properties, map, vjmap);\r\n                    } catch (error) {\r\n                        \r\n                    }\r\n                    \r\n                }\r\n                newOpts[key] = value;\r\n            }\r\n            return newOpts;\r\n        }\r\n    }\r\n    async createAnimateImages(map: Map, mapLayer: MapLayer) {\r\n        let animateImages;\r\n        // 过滤出以animateImages_开头的属性做为创建动画集的属性\r\n        let animateImagesOptionsKeys = Object.keys(mapLayer).filter(key => key.indexOf(\"animateImages_\") == 0);\r\n        let animateImagesOptions: any = {};\r\n        \r\n        for(let key of animateImagesOptionsKeys) {\r\n            animateImagesOptions[key.replace(\"animateImages_\", \"\")] = mapLayer[key];\r\n        }\r\n        if (mapLayer.animateImagesType == \"arrow\") {\r\n            animateImages = vjmap.createArrowAnimateImages(animateImagesOptions);\r\n        } else if (mapLayer.animateImagesType == \"antpath\") {\r\n            animateImages = vjmap.createAntPathAnimateImages(animateImagesOptions);\r\n        } else if (mapLayer.animateImagesType == \"customImage\") {\r\n            // 自定义图片\r\n            let img = await this.loadUrlImage(mapLayer.customImageUrl);\r\n            let createImagesOptions = {\r\n                ...animateImagesOptions,\r\n                draw: (context: any, width: number, height: number, opts: Record<string, any>) => {\r\n                    // 绘制图片回调，只需绘制第一帧的内容 context为canvas上下文，width,height为图片宽高，opts为上面传入的选项值\r\n                    // 填充背景色\r\n                    if (opts.fillColor) {\r\n                        context.fillStyle = opts.fillColor;\r\n                        context.fillRect(0, 0, width, height );\r\n                    }\r\n                    // 图片居中显示\r\n                    context.drawImage(img, 0, 0, img.width, img.height, 0, height / 2.0 - img.height / 2.0, width, img.height)\r\n                }\r\n            };\r\n            animateImages = vjmap.createAntPathAnimateImages(createImagesOptions);\r\n        } else if (mapLayer.animateImagesType == \"animateImages\") {\r\n            // 多个图片生成动画 \r\n            // 直接通过加载url图片来生成动画图片集\r\n            animateImages = [];\r\n            for(let i = 0; i < mapLayer.animateImageUrls?.length; i++) {\r\n                let imageId = `image_animate_${mapLayer.layerId}_${i}`;\r\n                if (map.hasImage(imageId)) {\r\n                    map.removeImage(imageId);\r\n                }\r\n                await map.loadImageEx(imageId, mapLayer.animateImageUrls[i]);\r\n                animateImages.push(imageId)\r\n            }\r\n        } else if (mapLayer.animateImagesType == \"imageSprites\") {\r\n            // 同一个图片精灵动画集\r\n            let img = await this.loadUrlImage(mapLayer.imageSpriteUrl);\r\n            animateImages = vjmap.createAntPathAnimateImages({\r\n                fromImage: img,\r\n                ...animateImagesOptions\r\n            });\r\n        } else {\r\n            animateImages = vjmap.createAnimateImages(animateImagesOptions);\r\n        }\r\n        return animateImages\r\n    }\r\n    setMarkerOptions(marker: Marker, options: Record<string, any>) {\r\n        if (options?.minZoom !== undefined) {\r\n            // @ts-ignore\r\n            marker.setMinZoom(options?.minZoom);\r\n        }\r\n        if (options?.maxZoom !== undefined) {\r\n            // @ts-ignore\r\n            marker.setMaxZoom(options?.maxZoom);\r\n        }\r\n        if (options?.scaleMaxZoom !== undefined) {\r\n            // @ts-ignore\r\n            marker.setScaleMaxZoom(options?.scaleMaxZoom);\r\n        }\r\n        if (options?.height !== undefined) {\r\n            // @ts-ignore\r\n            marker.setHeight(options?.height);\r\n        }\r\n        if (options?.removeWhenNoInMapView !== undefined) {\r\n            // @ts-ignore\r\n            marker.setRemoveWhenNoInMapView(options?.removeWhenNoInMapView, options?.removeWhenNoInMapViewPadding);\r\n        }\r\n        if (options?.rotation !== undefined) {\r\n            marker.setRotation(options?.rotation);\r\n        }\r\n        if (options?.animationType !== undefined) {\r\n            marker.setAnimation(options?.animationType);\r\n        }\r\n        if (options?.draggable !== undefined) {\r\n            marker.setDraggable(options?.draggable);\r\n        }\r\n        if (options?.rotationAlignment !== undefined) {\r\n            marker.setRotationAlignment(options?.rotationAlignment);\r\n        }\r\n        if (options?.pitchAlignment !== undefined) {\r\n            marker.setPitchAlignment(options?.pitchAlignment);\r\n        }\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class LineLayer extends LayerBase {\r\n    polyline!: vjmap.Polyline;\r\n    constructor() {\r\n        super();\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n       super.addLayer(map, mapLayer);\r\n       this.polyline = new vjmap.Polyline(mapLayer as any);\r\n       this.polyline.addTo(map, mapLayer.before);\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        if (visibleOff) {\r\n         this.polyline.hide()\r\n        } else {\r\n         this.polyline.show();\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        map.removeLayerEx(layerId);\r\n        super.removeLayer(map, layerId);\r\n    }\r\n    onSourceDataChange(map: Map, sourceId?: string, forceUpdate?: boolean, timerUpdate?: boolean) {\r\n        if (forceUpdate) {\r\n            super.onSourceDataChange(map, sourceId, forceUpdate, timerUpdate);\r\n        }\r\n        // 因为数据源改了，数据会自动变化 ，所以不需要调用基类的移除再增加了，提高效率。\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class FillLayer extends LayerBase {\r\n    polygon!: vjmap.Polygon;\r\n    constructor() {\r\n        super();\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n       super.addLayer(map, mapLayer);\r\n       this.polygon = new vjmap.Polygon(mapLayer as any);\r\n       this.polygon.addTo(map, mapLayer.before);\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n       if (visibleOff) {\r\n        this.polygon.hide()\r\n       } else {\r\n        this.polygon.show();\r\n       }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        map.removeLayerEx(layerId);\r\n        super.removeLayer(map, layerId);\r\n    }\r\n    onSourceDataChange(map: Map, sourceId?: string, forceUpdate?: boolean, timerUpdate?: boolean) {\r\n        if (forceUpdate) {\r\n            super.onSourceDataChange(map, sourceId, forceUpdate, timerUpdate);\r\n        }\r\n        // 因为数据源改了，数据会自动变化 ，所以不需要调用基类的移除再增加了，提高效率。\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class SymbolLayer extends LayerBase {\r\n    symbol!: vjmap.Symbol;\r\n    constructor() {\r\n        super();\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n       super.addLayer(map, mapLayer);\r\n       this.symbol = new vjmap.Symbol(mapLayer as any);\r\n       this.symbol.addTo(map, mapLayer.before);\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        if (visibleOff) {\r\n         this.symbol.hide()\r\n        } else {\r\n         this.symbol.show();\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        map.removeLayerEx(layerId);\r\n        super.removeLayer(map, layerId);\r\n    }\r\n    onSourceDataChange(map: Map, sourceId?: string, forceUpdate?: boolean, timerUpdate?: boolean) {\r\n        if (forceUpdate) {\r\n            super.onSourceDataChange(map, sourceId, forceUpdate, timerUpdate);\r\n        }\r\n        // 因为数据源改了，数据会自动变化 ，所以不需要调用基类的移除再增加了，提高效率。\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class CircleLayer extends LayerBase {\r\n    circle!: vjmap.Circle;\r\n    constructor() {\r\n        super();\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n       super.addLayer(map, mapLayer);\r\n       this.circle = new vjmap.Circle(mapLayer as any);\r\n       this.circle.addTo(map, mapLayer.before);\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n       super.setVisible(map, layerId, visibleOff);\r\n       if (visibleOff) {\r\n        this.circle.hide()\r\n       } else {\r\n        this.circle.show();\r\n       }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        map.removeLayerEx(layerId);\r\n        super.removeLayer(map, layerId);\r\n    }\r\n    onSourceDataChange(map: Map, sourceId?: string, forceUpdate?: boolean, timerUpdate?: boolean) {\r\n        if (forceUpdate) {\r\n            super.onSourceDataChange(map, sourceId, forceUpdate, timerUpdate);\r\n        }\r\n        // 因为数据源改了，数据会自动变化 ，所以不需要调用基类的移除再增加了，提高效率。\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class FillExtrusionLayer extends LayerBase {\r\n    fillExtrusion!: vjmap.FillExtrusion;\r\n    constructor() {\r\n        super();\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n       super.addLayer(map, mapLayer);\r\n       this.fillExtrusion = new vjmap.FillExtrusion(mapLayer as any);\r\n       this.fillExtrusion.addTo(map, mapLayer.before);\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n       if (visibleOff) {\r\n        this.fillExtrusion.hide()\r\n       } else {\r\n        this.fillExtrusion.show();\r\n       }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        map.removeLayerEx(layerId);\r\n        super.removeLayer(map, layerId);\r\n    }\r\n    onSourceDataChange(map: Map, sourceId?: string, forceUpdate?: boolean, timerUpdate?: boolean) {\r\n        if (forceUpdate) {\r\n            super.onSourceDataChange(map, sourceId, forceUpdate, timerUpdate);\r\n        }\r\n        // 因为数据源改了，数据会自动变化 ，所以不需要调用基类的移除再增加了，提高效率。\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class HeatmapLayer extends LayerBase {\r\n    heatmap!: vjmap.Heatmap;\r\n    constructor() {\r\n        super();\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n       super.addLayer(map, mapLayer);\r\n       this.heatmap = new vjmap.Heatmap(mapLayer as any);\r\n       this.heatmap.addTo(map, mapLayer.before);\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n       if (visibleOff) {\r\n        this.heatmap.hide()\r\n       } else {\r\n        this.heatmap.show();\r\n       }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        map.removeLayerEx(layerId);\r\n        super.removeLayer(map, layerId);\r\n    }\r\n    onSourceDataChange(map: Map, sourceId?: string, forceUpdate?: boolean, timerUpdate?: boolean) {\r\n        if (forceUpdate) {\r\n            super.onSourceDataChange(map, sourceId, forceUpdate, timerUpdate);\r\n        }\r\n        // 因为数据源改了，数据会自动变化 ，所以不需要调用基类的移除再增加了，提高效率。\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\nexport class MarkerLayer extends LayerBase {\r\n    markers!: vjmap.Marker[];\r\n    constructor() {\r\n        super();\r\n    }\r\n    createMarker(lnglat: any, properties: Record<string, any>, options: Record<string, any>, map: Map) {\r\n        options = this.evalValue(options, properties, map);\r\n        if (options.customHtml) {\r\n            // 如果有自定义html内容\r\n            let element = this.evalValue(options.customHtml, properties, map); \r\n            options.element = element;\r\n        }\r\n        else if (options.customImage) {\r\n            let el = document.createElement('div');\r\n            el.className = 'marker';\r\n            if (options.customImage.toLowerCase().indexOf(\"<svg\") == 0) {\r\n                //svg或//base64 png\r\n                options.customImage =  \"data:image/svg+xml;base64,\" + window.btoa(unescape(encodeURIComponent(options.customImage))) ;\r\n            }\r\n            el.style.backgroundImage =\r\n                `url(\"${options.customImage}\")`;\r\n            el.style.width = (options.customImageWidth ?? 40) + 'px';\r\n            el.style.height = (options.customImageHeight ?? 40) + 'px';\r\n            el.style.backgroundSize = '100%';\r\n            options.element = el;\r\n        }\r\n        let marker = vjmap.createMarker(options);\r\n        marker.setLngLat(lnglat).addTo(map);\r\n\r\n        if (options.animationType) {\r\n            marker.setAnimation(options.animationType);\r\n        }\r\n\r\n        if (options.popupHtml) {\r\n            let popup = new vjmap.Popup({\r\n                offset: options.popupOffset ?? [0, 0],\r\n                anchor: options.popupAnchor,\r\n                closeButton: options.closeButton,\r\n                closeOnClick: options.closeOnClick,\r\n                closeOnMove: options.closeOnMove,\r\n                focusAfterOpen: options.focusAfterOpen,\r\n                className: options.className,\r\n                maxWidth: options.maxWidth,\r\n            });\r\n            let html = options.popupHtml; //\"<h3 style='color:red'>index ${props.index}</h3>\"\r\n            let htmlValue = this.evalValue(\"return `\" + html + \"`\", properties, map); \r\n            popup.setHTML(htmlValue);\r\n            marker.setPopup(popup);\r\n        }\r\n       \r\n        this.markers = this.markers || [];\r\n        this.markers.push(marker);\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n        super.addLayer(map, mapLayer);\r\n        let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n        let features = featureCollection.features;\r\n        for (let i = 0; i < features.length; i++) {\r\n            let geometry = features[i].geometry;\r\n            if (geometry.type == 'Point') {\r\n                this.createMarker(geometry.coordinates, features[i].properties, mapLayer, map); \r\n            }\r\n            if (mapLayer.isDrawLinePoint) {\r\n                let coordinates = []\r\n                if (geometry.type == 'LineString' ) {\r\n                    coordinates = geometry.coordinates;\r\n                } else if (geometry.type == 'Polygon' ) {\r\n                    coordinates = geometry.coordinates[0];\r\n                }\r\n                for(let co of coordinates) {\r\n                    this.createMarker(co, features[i].properties, mapLayer, map); \r\n                }\r\n            }\r\n        }\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        for(let m of this.markers) {\r\n           m.setVisible(!visibleOff, true);\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        if (!this.markers) return;\r\n        for(let m of this.markers) {\r\n            m.remove();\r\n        }\r\n        this.markers = [];\r\n        super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\nexport class PopupLayer extends LayerBase {\r\n    popups!: vjmap.Popup[];\r\n    constructor() {\r\n        super();\r\n    }\r\n    createPopup(lnglat: any, properties: Record<string, any>, options: Record<string, any>, map: Map) {\r\n        let popup = new vjmap.Popup({\r\n            offset: options.offset ?? [0, 0],\r\n            anchor: options.anchor,\r\n            closeButton: options.closeButton,\r\n            closeOnClick: options.closeOnClick,\r\n            closeOnMove: options.closeOnMove,\r\n            focusAfterOpen: options.focusAfterOpen,\r\n            className: options.className,\r\n            maxWidth: options.maxWidth,\r\n        });\r\n        let html = options.html; //\"<h3 style='color:red'>index ${props.index}</h3>\"\r\n        let htmlValue = this.evalValue(\"return `\" + html + \"`\", properties, map); \r\n        popup.setHTML(htmlValue).setLngLat(lnglat).addTo(map);\r\n        this.popups = this.popups || [];\r\n        this.popups.push(popup);\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n        super.addLayer(map, mapLayer);\r\n        let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n        let features = featureCollection.features;\r\n        for (let i = 0; i < features.length; i++) {\r\n            let geometry = features[i].geometry;\r\n            if (geometry.type == 'Point') {\r\n                this.createPopup(geometry.coordinates, features[i].properties, mapLayer, map); \r\n            }\r\n            if (mapLayer.isDrawLinePoint) {\r\n                let coordinates = []\r\n                if (geometry.type == 'LineString' ) {\r\n                    coordinates = geometry.coordinates;\r\n                } else if (geometry.type == 'Polygon' ) {\r\n                    coordinates = geometry.coordinates[0];\r\n                }\r\n                for(let co of coordinates) {\r\n                    this.createPopup(co, features[i].properties, mapLayer, map); \r\n                }\r\n            }\r\n        }\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        for(let m of this.popups) {\r\n            m.getElement().style.display = visibleOff ? \"none\": '';\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        if (!this.popups) return;\r\n        for(let m of this.popups) {\r\n            m.remove();\r\n        }\r\n        this.popups = [];\r\n        super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class AnimateLineLayer extends LayerBase {\r\n    animateLine!: vjmap.ICreateLineAnimateLayerResult;\r\n    constructor() {\r\n        super();\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n        super.addLayer(map, mapLayer);\r\n        let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n        let animateImages = await this.createAnimateImages(map, mapLayer);\r\n        let options = {...mapLayer};\r\n        // layerId和sourceId内部会自动生成，无需再传\r\n        // @ts-ignore\r\n        delete options.layerId;\r\n        // @ts-ignore\r\n        delete options.sourceId;\r\n        this.animateLine = vjmap.createAnimateLineLayer(map, featureCollection, {\r\n            animateImages,\r\n            speed: mapLayer.speed ?? 1,\r\n            ...options,\r\n        });\r\n    }\r\n    getLayerId() {\r\n        return this.animateLine.layerId;\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        if (visibleOff) {\r\n         this.animateLine.stopAnimation();\r\n         this.animateLine.polyline.hide()\r\n        } else {\r\n         this.animateLine.polyline.show();\r\n         this.animateLine.startAnimation();\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n       this.animateLine.remove();\r\n       super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class AnimateSymbolLayer extends LayerBase {\r\n    animateSymbol!: vjmap.ICreateSymbolAnimateLayerResult;\r\n    constructor() {\r\n        super();\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n        super.addLayer(map, mapLayer);\r\n        let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n        let animateImages = await this.createAnimateImages(map, mapLayer);\r\n        let options = {...mapLayer};\r\n        // layerId和sourceId内部会自动生成，无需再传\r\n        // @ts-ignore\r\n        delete options.layerId;\r\n        // @ts-ignore\r\n        delete options.sourceId;\r\n        this.animateSymbol = vjmap.createAnimateSymbolLayer(map, featureCollection, {\r\n            animateImages,\r\n            speed: mapLayer.speed ?? 1,\r\n            ...options,\r\n        });\r\n    }\r\n    getLayerId() {\r\n        return this.animateSymbol.layerId;\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        if (visibleOff) {\r\n            this.animateSymbol.stopAnimation();\r\n            this.animateSymbol.symbol.hide()\r\n        } else {\r\n            this.animateSymbol.symbol.show();\r\n            this.animateSymbol.startAnimation();\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n       this.animateSymbol.remove();\r\n       super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class AnimateFillLayer extends LayerBase {\r\n    animateFill!: vjmap.ICreateFillAnimateLayerResult;\r\n    constructor() {\r\n        super();\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n        super.addLayer(map, mapLayer);\r\n        let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n        let animateImages = await this.createAnimateImages(map, mapLayer);\r\n        let options = {...mapLayer};\r\n        // layerId和sourceId内部会自动生成，无需再传\r\n        // @ts-ignore\r\n        delete options.layerId;\r\n        // @ts-ignore\r\n        delete options.sourceId;\r\n        this.animateFill = vjmap.createAnimateFillLayer(map, featureCollection, {\r\n            animateImages,\r\n            // @ts-ignore\r\n            speed: mapLayer.speed ?? 1,\r\n            ...options,\r\n        });\r\n    }\r\n    getLayerId() {\r\n        return this.animateFill.layerId;\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        if (visibleOff) {\r\n            this.animateFill.stopAnimation();\r\n            this.animateFill.polygon.hide()\r\n        } else {\r\n            this.animateFill.polygon.show();\r\n            this.animateFill.startAnimation();\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n       this.animateFill.remove();\r\n       super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class SymbolClusterLayer extends LayerBase {\r\n    sourceId!: string;\r\n    events!: Array<[string, string, any]>\r\n    constructor() {\r\n        super();\r\n        this.events = [];\r\n    }\r\n    async createCluster(map: Map, mapLayer: MapLayer) {\r\n        this.sourceId = 'cluster-points' + vjmap.RandomID();\r\n        let geoDatas = map.getSourceData(mapLayer.sourceId);\r\n        map.addSource(this.sourceId, {\r\n            type: 'geojson',\r\n            data: geoDatas,\r\n            cluster: true,\r\n            clusterMaxZoom: mapLayer.clusterMaxZoom ?? 10,\r\n            clusterRadius: mapLayer.clusterRadius ?? 60\r\n        });\r\n    \r\n        //添加聚合图层\r\n        let outerColors =  mapLayer.outerColors ?? [[1000, 'rgba(253, 156, 115, 0.6)'], [100, 'rgba(241, 211, 87, 0.6)'], [0, 'rgba(181, 226, 140, 0.6)']];\r\n    \r\n        outerColors.forEach( (color: any, i: number) => {\r\n            map.addLayer({\r\n                \"id\": \"point-outer-cluster-\" + this.sourceId + i,\r\n                \"type\": \"circle\",\r\n                \"source\": this.sourceId,\r\n                \"paint\": {\r\n                    \"circle-color\": color[1],\r\n                    \"circle-radius\": mapLayer.outerCircleRadius ?? 20\r\n                },\r\n                \"filter\": i === 0 ?\r\n                    [\">=\", \"point_count\", color[0]] :\r\n                    [\"all\", [\">=\", \"point_count\", color[0]], [\"<\", \"point_count\", outerColors[i - 1][0]]]\r\n            });\r\n        });\r\n        let innerColors =  mapLayer.innerColors ??[[1000, 'rgba(241, 128, 23, 0.6)'], [100, 'rgba(240, 194, 12, 0.6)'], [0, 'rgba(110, 204, 57, 0.6)']];\r\n    \r\n        innerColors.forEach((color: any, i: number) => {\r\n            map.addLayer({\r\n                \"id\": \"point-inner-cluster-\" + this.sourceId + i,\r\n                \"type\": \"circle\",\r\n                \"source\": this.sourceId,\r\n                \"paint\": {\r\n                    \"circle-color\": color[1],\r\n                    \"circle-radius\": mapLayer.innerCircleRadius ?? 15\r\n                },\r\n                \"filter\": i === 0 ?\r\n                    [\">=\", \"point_count\", color[0]] :\r\n                    [\"all\", [\">=\", \"point_count\", color[0]], [\"<\", \"point_count\", innerColors[i - 1][0]]]\r\n            });\r\n        });\r\n    \r\n    \r\n        map.addLayer({\r\n            id: 'cluster-count' + this.sourceId,\r\n            type: 'symbol',\r\n            source: this.sourceId,\r\n            filter: ['has', 'point_count'],\r\n            layout: {\r\n                'text-field': '{point_count_abbreviated}',\r\n                'text-font': ['simsun'],\r\n                'text-size': mapLayer.clusterTextSize ?? 12\r\n            }\r\n        });\r\n    \r\n        map.addLayer({\r\n            // 使用map.properties 把属性 驼峰式 写法改成 kebab-case 写法\r\n            ...map.properties({\r\n                ...mapLayer\r\n            }),\r\n            id: 'unclustered-point' + this.sourceId,\r\n            type: 'symbol',\r\n            source: this.sourceId,\r\n            filter: ['!', ['has', 'point_count']],\r\n        });\r\n    \r\n        for(let i = 0; i < outerColors.length; i++) {\r\n            let clusterLayer = \"point-outer-cluster-\" + this.sourceId + i;\r\n            const click = (e: any) => {\r\n                let features = map.queryRenderedFeatures(e.point, {\r\n                    layers: [clusterLayer]\r\n                });\r\n                // @ts-ignore\r\n                let clusterId = features[0].properties.cluster_id;\r\n                // @ts-ignore\r\n                map.getSource(this.sourceId)?.getClusterExpansionZoom(\r\n                    clusterId,\r\n                     (err: any, zoom: number) => {\r\n                        if (err) return;\r\n                        map.easeTo({\r\n                            // @ts-ignore\r\n                            center: features[0].geometry.coordinates,\r\n                            zoom: zoom\r\n                        });\r\n                    }\r\n                );\r\n            }\r\n            map.on('click', clusterLayer, click);\r\n            this.events.push([\"click\", clusterLayer, click]);\r\n    \r\n            const mouseenter = (e: any) => {\r\n                map.getCanvas().style.cursor = 'pointer';\r\n            }\r\n            map.on('mouseenter', clusterLayer, mouseenter);\r\n            this.events.push([\"mouseenter\", clusterLayer, mouseenter]);\r\n\r\n            const mouseleave = (e: any) => {\r\n                map.getCanvas().style.cursor = '';\r\n            }\r\n            map.on('mouseleave', clusterLayer, mouseleave);\r\n            this.events.push([\"mouseleave\", clusterLayer, mouseleave]);\r\n        }\r\n    \r\n    \r\n        const clickUnclustered = (e: any) => {\r\n            // @ts-ignore\r\n            let coordinates = e.features[0].geometry.coordinates.slice();\r\n            // @ts-ignore\r\n            let index = e.features[0].properties.index;\r\n    \r\n            if (mapLayer.popupHtml) {\r\n                let popup = new vjmap.Popup({\r\n                    offset: mapLayer.popupOffset ?? [0, 0],\r\n                    anchor: mapLayer.popupAnchor,\r\n                    closeButton: mapLayer.closeButton,\r\n                    closeOnClick: mapLayer.closeOnClick,\r\n                    closeOnMove: mapLayer.closeOnMove,\r\n                    focusAfterOpen: mapLayer.focusAfterOpen,\r\n                    className: mapLayer.className,\r\n                    maxWidth: mapLayer.maxWidth,\r\n                });\r\n                popup.setLngLat(coordinates)\r\n                let html = mapLayer.popupHtml; //\"<h3 style='color:red'>index ${props.index}</h3>\"\r\n                // @ts-ignore\r\n                let htmlValue = this.evalValue(\"return `\" + html + \"`\", e.features[0].properties, this.map);  \r\n                popup.setHTML(htmlValue)\r\n                .addTo(map);\r\n            }\r\n        }\r\n        map.on('click', 'unclustered-point' + this.sourceId, clickUnclustered);\r\n        this.events.push([\"click\", 'unclustered-point' + this.sourceId, clickUnclustered]);\r\n    \r\n        const mouseenterUnclustered = () => {\r\n            map.getCanvas().style.cursor = 'pointer';\r\n        }\r\n        map.on('mouseenter', 'unclustered-point' + this.sourceId,  mouseenterUnclustered);\r\n        this.events.push([\"mouseenter\", 'unclustered-point' + this.sourceId, mouseenterUnclustered]);\r\n\r\n        const mouseleaveUnclustered = () => {\r\n            map.getCanvas().style.cursor = '';\r\n        }\r\n        map.on('mouseleave', 'unclustered-point' + this.sourceId, mouseleaveUnclustered );\r\n        this.events.push([\"mouseleave\", 'unclustered-point' + this.sourceId, mouseleaveUnclustered]);\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n        super.addLayer(map, mapLayer);\r\n        this.createCluster(map, mapLayer);\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        if (visibleOff) {\r\n            map.hideSource(this.sourceId);\r\n        } else {\r\n            map.showSource(this.sourceId);\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        if (this.events) {\r\n            for(let event of this.events) {\r\n                // @ts-ignore\r\n                map.off(event[0], event[1], event[1]);// 取消之前绑定的事件\r\n            }\r\n            this.events = [];\r\n        }\r\n        map.removeSourceEx(this.sourceId);\r\n        super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map, Marker, MarkerClusterData } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\nexport class MarkerClusterLayer extends LayerBase {\r\n  markerCluster!: vjmap.MarkerCluster;\r\n  popupInfo: vjmap.Popup | null;\r\n  constructor() {\r\n    super();\r\n    this.popupInfo = null;\r\n  }\r\n  getColor(textColors: any, num: number, isText?: boolean) {\r\n    textColors = textColors ?? [\r\n      [0, \"#00FFFF\", \"#00FFFF\"],\r\n      [5, \"#F0F\", \"#80FF00\"],\r\n      [10, \"#00F\", \"#FFFF00\"],\r\n      [1000, \"#FFF\", \"#FF3D3D\"],\r\n    ];\r\n    for (let i = 0; i < textColors.length; i++) {\r\n      if (num <= textColors[i][0]) {\r\n        return isText ? textColors[i][1] : textColors[i][2];\r\n      }\r\n    }\r\n    if (textColors.length == 0) return \"#00FFFF\";\r\n    return isText\r\n      ? textColors[textColors.length - 1][1]\r\n      : textColors[textColors.length - 1][2]; // 没找到返回最后一个\r\n  }\r\n\r\n  async addLayer(map: Map, mapLayer: MapLayer) {\r\n    super.addLayer(map, mapLayer);\r\n    let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n    let features = featureCollection.features;\r\n    let data = [];\r\n\r\n    for (let i = 0; i < features.length; i++) {\r\n      let geometry = features[i].geometry;\r\n      if (geometry.type == \"Point\") {\r\n        data.push({\r\n          point: map.fromLngLat(geometry.coordinates),\r\n          properties: {\r\n            ...features[i].properties,\r\n          },\r\n        });\r\n      }\r\n      if (mapLayer.isDrawLinePoint) {\r\n        let coordinates = [];\r\n        if (geometry.type == \"LineString\") {\r\n          coordinates = geometry.coordinates;\r\n        } else if (geometry.type == \"Polygon\") {\r\n          coordinates = geometry.coordinates[0];\r\n        }\r\n        for (let co of coordinates) {\r\n          data.push({\r\n            point: map.fromLngLat(co),\r\n            properties: {\r\n              ...features[i].properties,\r\n            },\r\n          });\r\n        }\r\n      }\r\n    }\r\n\r\n    // 创建Marker回调，必须返回一个Marker或从Marker派生的对象\r\n    // curMarkerData 当前要显示的marker的数据， clusterMarkersData 当前聚合的maker的数据，包括当前要显示的)\r\n    const createMarker = (\r\n      curMarkerData: MarkerClusterData,\r\n      clusterMarkersData: MarkerClusterData[]\r\n    ) => {\r\n      if (clusterMarkersData.length <= 1) {\r\n        // 只有一个，没有聚合的实体，直接用Marker来绘制\r\n        let options = { ...mapLayer };\r\n        // @ts-ignore\r\n        options = this.evalValue(options, curMarkerData.properties, this.map);\r\n        let marker = new vjmap.Marker({\r\n          ...mapLayer,\r\n          color: this.getColor(options.textColors, clusterMarkersData.length),\r\n        }).setLngLat(this.map.toLngLat(curMarkerData.point));\r\n\r\n        if (options.popupHtml) {\r\n          // 给marker增加点击事件\r\n          marker.on(\"click\", (e) => {\r\n            if (!this.popupInfo) {\r\n              this.popupInfo = new vjmap.Popup({\r\n                offset: options.popupOffset ?? [0, 0],\r\n                anchor: options.popupAnchor,\r\n                closeButton: options.closeButton,\r\n                closeOnClick: options.closeOnClick,\r\n                closeOnMove: options.closeOnMove,\r\n                focusAfterOpen: options.focusAfterOpen,\r\n                className: options.className,\r\n                maxWidth: options.maxWidth,\r\n              });\r\n            } else {\r\n              this.popupInfo.remove();\r\n            }\r\n            let html = options.popupHtml; //\"<h3 style='color:red'>index ${props.index}</h3>\"\r\n            // @ts-ignore\r\n            let htmlValue = this.evalValue(\"return `\" + html + \"`\", marker.clusterMarkersData[0].properties, this.map);\r\n            this.popupInfo.setHTML(htmlValue);\r\n            this.popupInfo.setLngLat(marker.getLngLat()).addTo(this.map);\r\n          });\r\n        }\r\n        return marker;\r\n      } else {\r\n        // 如果有聚合的实体，则显示聚合数\r\n        // vjmap.Text是从Marker派生的对象，具有Marker对象的方法，所以可以返回Text对象\r\n        let text = new vjmap.Text({\r\n          text: clusterMarkersData.length + \"\", //总共聚合的个数\r\n          anchor: \"center\",\r\n          offset: [0, 0], // x,y 方向像素偏移量\r\n          style: {\r\n            // 自定义样式\r\n            \"background-color\": this.getColor(\r\n              mapLayer.textColors,\r\n              clusterMarkersData.length\r\n            ),\r\n            color: this.getColor(\r\n              mapLayer.textColors,\r\n              clusterMarkersData.length,\r\n              true\r\n            ),\r\n            ...mapLayer.textStyle,\r\n          },\r\n        });\r\n        text.setLngLat(this.map.toLngLat(curMarkerData.point)).addTo(this.map);\r\n        text.on(\"click\", (e) => {\r\n          // @ts-ignore\r\n          if (text.clusterMarkersData.length === 1) return;\r\n          // 获取所有聚合的点何地\r\n          // @ts-ignore\r\n          let pts = text.clusterMarkersData.map((c) => c.point);\r\n          let showBounds = vjmap.geoBounds();\r\n          showBounds.update(pts); //得到所有点坐标的范围\r\n          let lngLatBounds = this.map.toLngLat(showBounds);\r\n          this.map.fitBounds(lngLatBounds, {\r\n            padding: 40, //旁边留几十个像素，方便全部看到\r\n          });\r\n        });\r\n        return text;\r\n      }\r\n    };\r\n    // 更新Marker回调，如果返回空，则表示只更新Marker内容，如果返回了Marker对象，表示要替换之前的Marker对象\r\n    // curMarkerData 当前要显示的marker的数据， clusterMarkersData 当前聚合的maker的数据，包括当前要显示的; marker当前的实例对象)\r\n    const updateMarker = (\r\n      curMarkerData: MarkerClusterData,\r\n      clusterMarkersData: MarkerClusterData[],\r\n      marker: Marker\r\n    ) => {\r\n      if (marker instanceof vjmap.Text) {\r\n        // 如果是文本对象\r\n        if (clusterMarkersData.length > 1) {\r\n          // 还是聚合对象，只要改变文本就可以\r\n          marker.setText(clusterMarkersData.length + \"\");\r\n          // 修改的话，不用返回\r\n        } else {\r\n          //  要变成marker对象才可以了\r\n          // 先删除自己，再创建marker\r\n          marker.remove();\r\n          return createMarker(curMarkerData, clusterMarkersData);\r\n        }\r\n      } else {\r\n        // 如果是marker\r\n        if (clusterMarkersData.length > 1) {\r\n          // 如果数量大于1，表示需要聚合，先删除自己的Marker对象，再创建text\r\n          marker.remove();\r\n          return createMarker(curMarkerData, clusterMarkersData);\r\n        }\r\n      }\r\n    };\r\n    this.markerCluster = new vjmap.MarkerCluster({\r\n      /** 数据内容.(传入坐标为CAD地理坐标) */\r\n      data,\r\n      // 创建Marker回调，必须返回一个Marker或从Marker派生的对象 (curMarkerData 当前要显示的marker的数据， clusterMarkersData 当前聚合的maker的数据，包括当前要显示的)\r\n      createMarker,\r\n      // 更新Marker回调，如果返回空，则表示只更新Marker内容，如果返回了Marker对象，表示要替换之前的Marker对象 (curMarkerData 当前要显示的marker的数据， clusterMarkersData 当前聚合的maker的数据，包括当前要显示的; marker当前的实例对象)\r\n      updateMarker,\r\n      /** 是否允许重叠，默认false. */\r\n      allowOverlap: mapLayer.allowOverlap ?? false,\r\n      /** 允许重叠的最大缩放级别，小于或等于此级别才会处理重叠，超过此级时会全部显示当前所有的(如果不允许重叠时有效).默认4级*/\r\n      allowOverlapMaxZoom: mapLayer.allowOverlapMaxZoom ?? 4,\r\n      /** marker div的像素宽，用于计算重叠时需要，默认40. 如果在data的properties设置了属性markerWidth，则以data设置的为准*/\r\n      markerWidth: mapLayer.markerWidth ?? 28,\r\n      /** marker div的像素高，用于计算重叠时需要，默认40. 如果在data的properties设置了属性markerHeight，则以data设置的为准 */\r\n      markerHeight: mapLayer.markerHeight ?? 40,\r\n    });\r\n    this.markerCluster.addTo(map);\r\n  }\r\n  setLayerStyle(\r\n    map: Map,\r\n    layerId: string,\r\n    layerProps: Record<string, any>,\r\n    oldLayer: MapLayer\r\n  ) {\r\n    super.setLayerStyle(map, layerId, layerProps, oldLayer);\r\n    this.removeLayer(map, layerId);\r\n    this.addLayer(map, toMapLayer(oldLayer, layerProps));\r\n  }\r\n  setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n    super.setVisible(map, layerId, visibleOff);\r\n    if (visibleOff) {\r\n      this.markerCluster.hide();\r\n    } else {\r\n      this.markerCluster.show();\r\n    }\r\n  }\r\n  removeLayer(map: Map, layerId: string) {\r\n    this.markerCluster.remove();\r\n    if (this.popupInfo) {\r\n      this.popupInfo.remove();\r\n      this.popupInfo = null;\r\n    }\r\n    super.removeLayer(map, layerId);\r\n  }\r\n}\r\n","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\nexport class TextLayer extends LayerBase {\r\n    texts!: vjmap.Text[];\r\n    constructor() {\r\n        super();\r\n    }\r\n    createText(lnglat: any, properties: Record<string, any>, options: Record<string, any>, map: Map) {\r\n        options = this.evalValue(options, properties, map);\r\n        let content = options.text || ''; //\"<h3 style='color:red'>index ${props.index}</h3>\"\r\n        let contentValue = this.evalValue(\"return `\" + content + \"`\", properties, map); \r\n        \r\n        let text = new vjmap.Text({\r\n            ...options,\r\n            text: contentValue\r\n        });\r\n        this.setMarkerOptions(text as any, options);\r\n        text.setLngLat(lnglat).addTo(map);\r\n\r\n        if (options.animationType) {\r\n            text.setAnimation(options.animationType);\r\n        }\r\n\r\n        if (options.popupHtml) {\r\n            let popup = new vjmap.Popup({\r\n                offset: options.popupOffset ?? [0, 0],\r\n                anchor: options.popupAnchor,\r\n                closeButton: options.closeButton,\r\n                closeOnClick: options.closeOnClick,\r\n                closeOnMove: options.closeOnMove,\r\n                focusAfterOpen: options.focusAfterOpen,\r\n                className: options.className,\r\n                maxWidth: options.maxWidth,\r\n            });\r\n            let html = options.popupHtml; //\"<h3 style='color:red'>index ${props.index}</h3>\"\r\n            let htmlValue = this.evalValue(\"return `\" + html + \"`\", properties, map); \r\n            popup.setHTML(htmlValue);\r\n            text.setPopup(popup);\r\n        }\r\n       \r\n        this.texts = this.texts || [];\r\n        this.texts.push(text);\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n        super.addLayer(map, mapLayer);\r\n        let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n        let features = featureCollection.features;\r\n        for (let i = 0; i < features.length; i++) {\r\n            let geometry = features[i].geometry;\r\n            if (geometry.type == 'Point') {\r\n                this.createText(geometry.coordinates, features[i].properties, mapLayer, map); \r\n            }\r\n            if (mapLayer.isDrawLinePoint) {\r\n                let coordinates = []\r\n                if (geometry.type == 'LineString' ) {\r\n                    coordinates = geometry.coordinates;\r\n                } else if (geometry.type == 'Polygon' ) {\r\n                    coordinates = geometry.coordinates[0];\r\n                }\r\n                for(let co of coordinates) {\r\n                    this.createText(co, features[i].properties, mapLayer, map); \r\n                }\r\n            }\r\n        }\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        for(let m of this.texts) {\r\n            if (visibleOff) {\r\n              m.hide()\r\n            } else {\r\n              m.show();\r\n            }\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        if (!this.texts) return;\r\n        for(let m of this.texts) {\r\n            m.remove();\r\n        }\r\n        this.texts = [];\r\n        super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\nexport class BreathingMarkerLayer extends LayerBase {\r\n    markers!: vjmap.Marker[];\r\n    constructor() {\r\n        super();\r\n    }\r\n    createMarker(lnglat: any, properties: Record<string, any>, options: Record<string, any>, map: Map) {\r\n        options = this.evalValue(options, properties, map);\r\n        let content = options.text || ''; //\"<h3 style='color:red'>index ${props.index}</h3>\"\r\n        let contentValue = this.evalValue(\"return `\" + content + \"`\", properties, map);\r\n        let marker = new vjmap.BreathingApertureMarker({\r\n            lngLat: lnglat,\r\n            text: contentValue\r\n        }, {\r\n            ...options,\r\n            colors: [options.color1, options.color2],\r\n            height: options.markerHeight\r\n        }).createMarker();\r\n        marker.addTo(map);\r\n        this.setMarkerOptions(marker, options);\r\n        this.markers = this.markers || [];\r\n        this.markers.push(marker);\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n        super.addLayer(map, mapLayer);\r\n        let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n        let features = featureCollection.features;\r\n        for (let i = 0; i < features.length; i++) {\r\n            let geometry = features[i].geometry;\r\n            if (geometry.type == 'Point') {\r\n                this.createMarker(geometry.coordinates, features[i].properties, mapLayer, map); \r\n            }\r\n            if (mapLayer.isDrawLinePoint) {\r\n                let coordinates = []\r\n                if (geometry.type == 'LineString' ) {\r\n                    coordinates = geometry.coordinates;\r\n                } else if (geometry.type == 'Polygon' ) {\r\n                    coordinates = geometry.coordinates[0];\r\n                }\r\n                for(let co of coordinates) {\r\n                    this.createMarker(co, features[i].properties, mapLayer, map); \r\n                }\r\n            }\r\n        }\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        for(let m of this.markers) {\r\n           m.setVisible(!visibleOff, true);\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        if (!this.markers) return;\r\n        for(let m of this.markers) {\r\n            m.remove();\r\n        }\r\n        this.markers = [];\r\n        super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\nexport class RotatingMarkerLayer extends LayerBase {\r\n    markers!: vjmap.Marker[];\r\n    constructor() {\r\n        super();\r\n    }\r\n    createMarker(lnglat: any, properties: Record<string, any>, options: Record<string, any>, map: Map) {\r\n        options = this.evalValue(options, properties, map);\r\n        let content = options.text || ''; //\"<h3 style='color:red'>index ${props.index}</h3>\"\r\n        let contentValue = this.evalValue(\"return `\" + content + \"`\", properties, map); \r\n        let marker = new vjmap.RotatingApertureMarker({\r\n            lngLat: lnglat,\r\n            text: contentValue\r\n        }, {\r\n            ...options,\r\n            colors: [options.color1, options.color2],\r\n            height: options.markerHeight\r\n        }).createMarker();\r\n        marker.addTo(map);\r\n        this.setMarkerOptions(marker, options);\r\n        this.markers = this.markers || [];\r\n        this.markers.push(marker);\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n        super.addLayer(map, mapLayer);\r\n        let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n        let features = featureCollection.features;\r\n        for (let i = 0; i < features.length; i++) {\r\n            let geometry = features[i].geometry;\r\n            if (geometry.type == 'Point') {\r\n                this.createMarker(geometry.coordinates, features[i].properties, mapLayer, map); \r\n            }\r\n            if (mapLayer.isDrawLinePoint) {\r\n                let coordinates = []\r\n                if (geometry.type == 'LineString' ) {\r\n                    coordinates = geometry.coordinates;\r\n                } else if (geometry.type == 'Polygon' ) {\r\n                    coordinates = geometry.coordinates[0];\r\n                }\r\n                for(let co of coordinates) {\r\n                    this.createMarker(co, features[i].properties, mapLayer, map); \r\n                }\r\n            }\r\n        }\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        for(let m of this.markers) {\r\n           m.setVisible(!visibleOff, true);\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        if (!this.markers) return;\r\n        for(let m of this.markers) {\r\n            m.remove();\r\n        }\r\n        this.markers = [];\r\n        super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\nexport class HaloRingMarkerLayer extends LayerBase {\r\n    markers!: vjmap.Marker[];\r\n    constructor() {\r\n        super();\r\n    }\r\n    createMarker(lnglat: any, properties: Record<string, any>, options: Record<string, any>, map: Map) {\r\n        options = this.evalValue(options, properties, map);\r\n        let content = options.text || ''; //\"<h3 style='color:red'>index ${props.index}</h3>\"\r\n        let contentValue = this.evalValue(\"return `\" + content + \"`\", properties, map);\r\n        let marker = new vjmap.HaloRingMarker({\r\n            lngLat: lnglat,\r\n            text: contentValue\r\n        }, {\r\n            ...options,\r\n            colors: [options.color1, options.color2],\r\n            height: options.markerHeight\r\n        }).createMarker();\r\n        marker.addTo(map);\r\n        this.setMarkerOptions(marker, options);\r\n        this.markers = this.markers || [];\r\n        this.markers.push(marker);\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n        super.addLayer(map, mapLayer);\r\n        let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n        let features = featureCollection.features;\r\n        for (let i = 0; i < features.length; i++) {\r\n            let geometry = features[i].geometry;\r\n            if (geometry.type == 'Point') {\r\n                this.createMarker(geometry.coordinates, features[i].properties, mapLayer, map); \r\n            }\r\n            if (mapLayer.isDrawLinePoint) {\r\n                let coordinates = []\r\n                if (geometry.type == 'LineString' ) {\r\n                    coordinates = geometry.coordinates;\r\n                } else if (geometry.type == 'Polygon' ) {\r\n                    coordinates = geometry.coordinates[0];\r\n                }\r\n                for(let co of coordinates) {\r\n                    this.createMarker(co, features[i].properties, mapLayer, map); \r\n                }\r\n            }\r\n        }\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        for(let m of this.markers) {\r\n           m.setVisible(!visibleOff, true);\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        if (!this.markers) return;\r\n        for(let m of this.markers) {\r\n            m.remove();\r\n        }\r\n        this.markers = [];\r\n        super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\nexport class DiffusedMarkerLayer extends LayerBase {\r\n    markers!: vjmap.Marker[];\r\n    constructor() {\r\n        super();\r\n    }\r\n    createMarker(lnglat: any, properties: Record<string, any>, options: Record<string, any>, map: Map) {\r\n        options = this.evalValue(options, properties, map);\r\n        let content = options.text || ''; //\"<h3 style='color:red'>index ${props.index}</h3>\"\r\n        let contentValue = this.evalValue(\"return `\" + content + \"`\", properties, map);\r\n        let marker = new vjmap.DiffusedApertureMarker({\r\n            lngLat: lnglat,\r\n            text: contentValue\r\n        }, {\r\n            ...options,\r\n            colors: [options.color1, options.color2],\r\n            height: options.markerHeight\r\n        }).createMarker();\r\n        marker.addTo(map);\r\n        this.setMarkerOptions(marker, options);\r\n        this.markers = this.markers || [];\r\n        this.markers.push(marker);\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n        super.addLayer(map, mapLayer);\r\n        let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n        let features = featureCollection.features;\r\n        for (let i = 0; i < features.length; i++) {\r\n            let geometry = features[i].geometry;\r\n            if (geometry.type == 'Point') {\r\n                this.createMarker(geometry.coordinates, features[i].properties, mapLayer, map); \r\n            }\r\n            if (mapLayer.isDrawLinePoint) {\r\n                let coordinates = []\r\n                if (geometry.type == 'LineString' ) {\r\n                    coordinates = geometry.coordinates;\r\n                } else if (geometry.type == 'Polygon' ) {\r\n                    coordinates = geometry.coordinates[0];\r\n                }\r\n                for(let co of coordinates) {\r\n                    this.createMarker(co, features[i].properties, mapLayer, map); \r\n                }\r\n            }\r\n        }\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        for(let m of this.markers) {\r\n           m.setVisible(!visibleOff, true);\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        if (!this.markers) return;\r\n        for(let m of this.markers) {\r\n            m.remove();\r\n        }\r\n        this.markers = [];\r\n        super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\nexport class TextBorderMarkerLayer extends LayerBase {\r\n    markers!: vjmap.Marker[];\r\n    constructor() {\r\n        super();\r\n    }\r\n    createMarker(lnglat: any, properties: Record<string, any>, options: Record<string, any>, map: Map) {\r\n        options = this.evalValue(options, properties, map);\r\n        let content = options.text || ''; //\"<h3 style='color:red'>index ${props.index}</h3>\"\r\n        let contentValue = this.evalValue(\"return `\" + content + \"`\", properties, map); \r\n        let marker = new vjmap.RotatingTextBorderMarker({\r\n            lngLat: lnglat,\r\n            text: contentValue\r\n        }, {\r\n            ...options,\r\n            colors: [options.color1, options.color2],\r\n            height: options.markerHeight\r\n        }).createMarker();\r\n        marker.addTo(map);\r\n        this.setMarkerOptions(marker, options);\r\n        this.markers = this.markers || [];\r\n        this.markers.push(marker);\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n        super.addLayer(map, mapLayer);\r\n        let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n        let features = featureCollection.features;\r\n        for (let i = 0; i < features.length; i++) {\r\n            let geometry = features[i].geometry;\r\n            if (geometry.type == 'Point') {\r\n                this.createMarker(geometry.coordinates, features[i].properties, mapLayer, map); \r\n            }\r\n            if (mapLayer.isDrawLinePoint) {\r\n                let coordinates = []\r\n                if (geometry.type == 'LineString' ) {\r\n                    coordinates = geometry.coordinates;\r\n                } else if (geometry.type == 'Polygon' ) {\r\n                    coordinates = geometry.coordinates[0];\r\n                }\r\n                for(let co of coordinates) {\r\n                    this.createMarker(co, features[i].properties, mapLayer, map); \r\n                }\r\n            }\r\n        }\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        for(let m of this.markers) {\r\n           m.setVisible(!visibleOff, true);\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        if (!this.markers) return;\r\n        for(let m of this.markers) {\r\n            m.remove();\r\n        }\r\n        this.markers = [];\r\n        super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\nexport class FluorescenceMarkerLayer extends LayerBase {\r\n    markers!: vjmap.Marker[];\r\n    constructor() {\r\n        super();\r\n    }\r\n    createMarker(lnglat: any, properties: Record<string, any>, options: Record<string, any>, map: Map) {\r\n        options = this.evalValue(options, properties, map);\r\n        let content = options.text || ''; //\"<h3 style='color:red'>index ${props.index}</h3>\"\r\n        let contentValue = this.evalValue(\"return `\" + content + \"`\", properties, map);\r\n        let marker = new vjmap.FluorescenceMarker({\r\n            lngLat: lnglat,\r\n            text: contentValue\r\n        }, {\r\n            ...options,\r\n            colors: [options.color1, options.color2],\r\n            height: options.markerHeight\r\n        }).createMarker();\r\n        marker.addTo(map);\r\n        this.setMarkerOptions(marker, options);\r\n        this.markers = this.markers || [];\r\n        this.markers.push(marker);\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n        super.addLayer(map, mapLayer);\r\n        let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n        let features = featureCollection.features;\r\n        for (let i = 0; i < features.length; i++) {\r\n            let geometry = features[i].geometry;\r\n            if (geometry.type == 'Point') {\r\n                this.createMarker(geometry.coordinates, features[i].properties, mapLayer, map); \r\n            }\r\n            if (mapLayer.isDrawLinePoint) {\r\n                let coordinates = []\r\n                if (geometry.type == 'LineString' ) {\r\n                    coordinates = geometry.coordinates;\r\n                } else if (geometry.type == 'Polygon' ) {\r\n                    coordinates = geometry.coordinates[0];\r\n                }\r\n                for(let co of coordinates) {\r\n                    this.createMarker(co, features[i].properties, mapLayer, map); \r\n                }\r\n            }\r\n        }\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        for(let m of this.markers) {\r\n           m.setVisible(!visibleOff, true);\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        if (!this.markers) return;\r\n        for(let m of this.markers) {\r\n            m.remove();\r\n        }\r\n        this.markers = [];\r\n        super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class CurveLayer extends LayerBase {\r\n  polyline!: vjmap.Polyline;\r\n  constructor() {\r\n    super();\r\n  }\r\n  async addLayer(map: Map, mapLayer: MapLayer) {\r\n    super.addLayer(map, mapLayer);\r\n    let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n    let geoDatas = [];\r\n    // 遍历里面所有的线\r\n    let features = featureCollection.features;\r\n    for (let i = 0; i < features.length; i++) {\r\n      let geometry = features[i].geometry;\r\n      if (geometry.type != \"LineString\") continue;\r\n      let curvePath = geometry.coordinates;\r\n      if (geometry.coordinates.length > 2) {\r\n        // 把曲线上的点转为贝塞尔曲线参数\r\n        const c = vjmap.polylineToBezierCurve(map.fromLngLat(geometry.coordinates).map((c: any) => [c.x, c.y]));\r\n        // 据贝塞尔曲线参数离散成线\r\n        curvePath = vjmap.bezierCurveToPolyline(c);\r\n        geoDatas.push({\r\n            points: map.toLngLat(curvePath),\r\n            properties: geometry.properties,\r\n          });\r\n      } else {\r\n        geoDatas.push({\r\n            points: curvePath,\r\n            properties: geometry.properties,\r\n          });\r\n      }\r\n    }\r\n    let options = { ...mapLayer };\r\n    // layerId和sourceId内部会自动生成，无需再传\r\n    // @ts-ignore\r\n    delete options.layerId;\r\n    // @ts-ignore\r\n    delete options.sourceId;\r\n    this.polyline = new vjmap.Polyline({\r\n      data: geoDatas,\r\n      ...options,\r\n    });\r\n    this.polyline.addTo(map, mapLayer.before);\r\n  }\r\n  getLayerId() {\r\n      return this.polyline.layerId;\r\n  }\r\n  setLayerStyle(\r\n    map: Map,\r\n    layerId: string,\r\n    layerProps: Record<string, any>,\r\n    oldLayer: MapLayer\r\n  ) {\r\n    super.setLayerStyle(map, layerId, layerProps, oldLayer);\r\n    this.removeLayer(map, layerId);\r\n    this.addLayer(map, toMapLayer(oldLayer, layerProps));\r\n  }\r\n  setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n    super.setVisible(map, layerId, visibleOff);\r\n    if (visibleOff) {\r\n      this.polyline.hide();\r\n    } else {\r\n      this.polyline.show();\r\n    }\r\n  }\r\n  removeLayer(map: Map, layerId: string) {\r\n    if (this.polyline) {\r\n        this.polyline.remove();\r\n    }\r\n    super.removeLayer(map, layerId);\r\n  }\r\n}\r\n","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class LineExtrusionsLayer extends LayerBase {\r\n  fillExtrusion!: vjmap.FillExtrusion;\r\n  anim: any;\r\n  constructor() {\r\n    super();\r\n  }\r\n  async addLayer(map: Map, mapLayer: MapLayer) {\r\n    super.addLayer(map, mapLayer);\r\n    let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n    let geoDatas = [];\r\n    // 遍历里面所有的线\r\n    let features = featureCollection.features;\r\n    for (let i = 0; i < features.length; i++) {\r\n      let geometry = features[i].geometry;\r\n      let lineCoords = []\r\n      if (geometry.type == \"LineString\") {\r\n        lineCoords.push(geometry.coordinates)\r\n      } else if (geometry.type == \"MultiLineString\") {\r\n        lineCoords.push(...geometry.coordinates)\r\n      } else {\r\n        continue;\r\n      }\r\n      if (mapLayer.isBreakLine) {\r\n        // 打断线\r\n        let splitLineCoords = []\r\n        for(let c of lineCoords) {\r\n          for(let k = 0; k < c.length - 1; k++) {\r\n            splitLineCoords.push([c[k], c[k + 1]])\r\n          }\r\n          lineCoords = splitLineCoords;\r\n        }\r\n      }\r\n      for(const coord of lineCoords) {\r\n        let coordinates = map.fromLngLat(coord);\r\n        let path = vjmap.polylineMarginToPolygon(coordinates, {\r\n          offset: mapLayer.offsetLine ?? 10,\r\n        });\r\n  \r\n        geoDatas.push({\r\n          points: map.toLngLat(path),\r\n          properties: {\r\n            ...features[i].properties,\r\n            path: path, // 把点坐标保存进属性中\r\n          },\r\n        });\r\n      }\r\n    }\r\n    let options = { ...mapLayer };\r\n    // layerId和sourceId内部会自动生成，无需再传\r\n    // @ts-ignore\r\n    delete options.layerId;\r\n    // @ts-ignore\r\n    delete options.sourceId;\r\n    this.fillExtrusion = new vjmap.FillExtrusion({\r\n      data: geoDatas,\r\n      ...options,\r\n    });\r\n    this.fillExtrusion.addTo(map, mapLayer.before);\r\n\r\n    if (mapLayer.anmiDuration) {\r\n      // 复制下初始数据，防止以后更新\r\n      const initData: any = vjmap.cloneDeep(this.fillExtrusion.getData());\r\n      this.anim = vjmap.createAnimation({\r\n        from: 0,\r\n        to: 1,\r\n        repeatType: mapLayer.anmiRepeatType ?? \"reverse\", // 交替反转动画\r\n        repeat: mapLayer.anmiRepeat || Infinity,\r\n        duration: mapLayer.anmiDuration * 1000,\r\n        ease: vjmap.linear, //线性\r\n        onUpdate: (latest: number) => {\r\n          const data: any = this.fillExtrusion.getData();\r\n          for (let i = 0; i < data.features.length; i++) {\r\n            const value = latest;\r\n            const prop = initData.features[i].properties;\r\n            const path = vjmap.interpolatePointsByRatio(prop.path, value);\r\n            if (path.length > 1) {\r\n              const polyPath = vjmap.polylineMarginToPolygon(path, {\r\n                offset: mapLayer.offsetLine ?? 10,\r\n              });\r\n              const geojson: any = vjmap.createPolygonGeoJson(\r\n                map.toLngLat(polyPath)\r\n              );\r\n              if (geojson.features[0] && geojson.features[0].geometry) {\r\n                data.features[i].geometry.coordinates =\r\n                  geojson.features[0].geometry.coordinates;\r\n              }\r\n            }\r\n          }\r\n          this.fillExtrusion.setData(data);\r\n        },\r\n      });\r\n    }\r\n  }\r\n  setLayerStyle(\r\n    map: Map,\r\n    layerId: string,\r\n    layerProps: Record<string, any>,\r\n    oldLayer: MapLayer\r\n  ) {\r\n    super.setLayerStyle(map, layerId, layerProps, oldLayer);\r\n    this.removeLayer(map, layerId);\r\n    this.addLayer(map, toMapLayer(oldLayer, layerProps));\r\n  }\r\n  setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n    super.setVisible(map, layerId, visibleOff);\r\n    if (visibleOff) {\r\n      this.fillExtrusion.hide();\r\n      if (this.anim) {\r\n        this.anim.stop();\r\n      }\r\n    } else {\r\n      this.fillExtrusion.show();\r\n      if (this.anim) {\r\n        this.anim.start();\r\n      }\r\n    }\r\n  }\r\n  removeLayer(map: Map, layerId: string) {\r\n    if (this.fillExtrusion) this.fillExtrusion.remove();\r\n    if (this.anim) {\r\n      this.anim.stop();\r\n      this.anim = null;\r\n    }\r\n    super.removeLayer(map, layerId);\r\n  }\r\n}\r\n","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class ArrowLineLayer extends LayerBase {\r\n  polylineArrows!: vjmap.PolylineArrow[];\r\n  constructor() {\r\n    super();\r\n  }\r\n  async addLayer(map: Map, mapLayer: MapLayer) {\r\n    super.addLayer(map, mapLayer);\r\n    this.polylineArrows = this.polylineArrows || [];\r\n    let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n    // 遍历里面所有的线\r\n    let features = featureCollection.features;\r\n    \r\n    for (let i = 0; i < features.length; i++) {\r\n      let geometry = features[i].geometry;\r\n      if (geometry.type != \"LineString\") continue;\r\n      await map.onLoad(true);\r\n      let coordinates = geometry.coordinates;\r\n      let options = this.evalValue(mapLayer, features[i].properties, map);\r\n      // layerId和sourceId内部会自动生成，无需再传\r\n      // @ts-ignore\r\n      delete options.layerId;\r\n      // @ts-ignore\r\n      delete options.sourceId;\r\n      let polylineArrow = new vjmap.PolylineArrow({\r\n        ...options,\r\n        path: coordinates,\r\n      });\r\n      polylineArrow.addTo(map, mapLayer.before);\r\n      this.polylineArrows.push(polylineArrow);\r\n    }\r\n  }\r\n  getLayerId() {\r\n      return this.polylineArrows.map(p => p.id);\r\n  }\r\n  setLayerStyle(\r\n    map: Map,\r\n    layerId: string,\r\n    layerProps: Record<string, any>,\r\n    oldLayer: MapLayer\r\n  ) {\r\n    super.setLayerStyle(map, layerId, layerProps, oldLayer);\r\n    this.removeLayer(map, layerId);\r\n    this.addLayer(map, toMapLayer(oldLayer, layerProps));\r\n  }\r\n  setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n    super.setVisible(map, layerId, visibleOff);\r\n    if (this.polylineArrows && this.polylineArrows.length) {\r\n      for (let arrow of this.polylineArrows) {\r\n        if (visibleOff) {\r\n          arrow.hide();\r\n        } else {\r\n          arrow.show();\r\n        }\r\n      }\r\n    }\r\n  }\r\n  removeLayer(map: Map, layerId: string) {\r\n    if (this.polylineArrows && this.polylineArrows.length) {\r\n      for (let arrow of this.polylineArrows) {\r\n        arrow.remove();\r\n      }\r\n      this.polylineArrows = [];\r\n    }\r\n    super.removeLayer(map, layerId);\r\n  }\r\n}\r\n","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class PathAnimateLayer extends LayerBase {\r\n  polylineArrows!: vjmap.PolylineArrow[];\r\n  symbolSourcedIds!: string[];\r\n  anims!: any[];\r\n  constructor() {\r\n    super();\r\n  }\r\n  async addLayer(map: Map, mapLayer: MapLayer) {\r\n    super.addLayer(map, mapLayer);\r\n    this.polylineArrows = this.polylineArrows || [];\r\n    this.symbolSourcedIds = this.symbolSourcedIds || [];\r\n    this.anims = this.anims || [];\r\n    let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n    // 遍历里面所有的线\r\n    let features = featureCollection.features;\r\n    \r\n    for (let i = 0; i < features.length; i++) {\r\n      let geometry = features[i].geometry;\r\n      if (geometry.type != \"LineString\") continue;\r\n      await map.onLoad(true);\r\n      let coordinates = geometry.coordinates;\r\n      let options = this.evalValue(mapLayer, features[i].properties, map);\r\n      // layerId和sourceId内部会自动生成，无需再传\r\n      // @ts-ignore\r\n      delete options.layerId;\r\n      // @ts-ignore\r\n      delete options.sourceId;\r\n      let polylineArrow = new vjmap.PolylineArrow({\r\n        ...options,\r\n        path: coordinates,\r\n      });\r\n      polylineArrow.addTo(map, mapLayer.before);\r\n      this.polylineArrows.push(polylineArrow);\r\n\r\n      let symbolSourceid: any;\r\n      if (mapLayer.iconImage) {\r\n        let symbolOptionsKeys = Object.keys(mapLayer).filter(key => key.indexOf(\"symbol\") == 0 || key.indexOf(\"icon\") == 0 || key.indexOf(\"text\") == 0);\r\n        let symbolOptions: any = {};\r\n        for(let key of symbolOptionsKeys) {\r\n          symbolOptions[key] = mapLayer[key];\r\n        }\r\n  \r\n        let randID = vjmap.RandomID();\r\n        symbolSourceid = \"path_animi_source_\" + randID;\r\n        map.addGeoJSONSource(symbolSourceid);\r\n        map.addSymbolLayer(\"path_animi_layer_\" + randID, symbolSourceid, {\r\n            iconRotate: ['get', 'bearing'],\r\n            iconRotationAlignment: 'map',\r\n            iconAllowOverlap: true,\r\n            iconIgnorePlacement: true,\r\n            ...symbolOptions\r\n        })\r\n        this.symbolSourcedIds.push(symbolSourceid);\r\n      }\r\n      \r\n\r\n      let curFps = options.fps || 10;\r\n      const anim = polylineArrow.animate(100, curFps, true, status => {}, (status, context) => {\r\n        if (status !== vjmap.FrameAnimationStatus.Run || !symbolSourceid) return\r\n        // 动画每帧回调，在这里可以实时改变车的位置\r\n        // 获取角度\r\n        const angle = vjmap.geoPoint(context.endPnt).angleTo(vjmap.geoPoint(context.startPnt));\r\n        // 生成新的数据\r\n        const carGeoJson = vjmap.createPointGeoJson({\r\n            point: context.endPnt,\r\n            properties: { ...features[i].properties, bearing: vjmap.radToDeg(-angle)}\r\n        });\r\n        // 更新车的数据\r\n        map.setData(symbolSourceid, carGeoJson); // 更新位置\r\n      })\r\n      this.anims.push(anim);\r\n    }\r\n  }\r\n  setLayerStyle(\r\n    map: Map,\r\n    layerId: string,\r\n    layerProps: Record<string, any>,\r\n    oldLayer: MapLayer\r\n  ) {\r\n    super.setLayerStyle(map, layerId, layerProps, oldLayer);\r\n    this.removeLayer(map, layerId);\r\n    this.addLayer(map, toMapLayer(oldLayer, layerProps));\r\n  }\r\n  setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n    super.setVisible(map, layerId, visibleOff);\r\n    if (this.anims && this.anims.length) {\r\n      for (let anim of this.anims) {\r\n        if (visibleOff) {\r\n          anim.stop();\r\n        } else {\r\n          anim.start();\r\n        }\r\n      }\r\n    }\r\n    if (this.polylineArrows && this.polylineArrows.length) {\r\n      for (let arrow of this.polylineArrows) {\r\n        if (visibleOff) {\r\n          arrow.hide();\r\n        } else {\r\n          arrow.show();\r\n        }\r\n      }\r\n      for (let symbolSourceId of this.symbolSourcedIds) {\r\n        if (visibleOff) {\r\n          map.hideSource(symbolSourceId);\r\n        } else {\r\n          map.showSource(symbolSourceId);\r\n        }\r\n      }\r\n      \r\n    }\r\n  }\r\n  removeLayer(map: Map, layerId: string) {\r\n    if (this.anims && this.anims.length) {\r\n      for (let anim of this.anims) {\r\n        anim.stop();\r\n      }\r\n      this.anims = [];\r\n    }\r\n    if (this.polylineArrows && this.polylineArrows.length) {\r\n      for (let arrow of this.polylineArrows) {\r\n        arrow.remove();\r\n      }\r\n      this.polylineArrows = [];\r\n    }\r\n    if (this.symbolSourcedIds && this.symbolSourcedIds.length) {\r\n      for (let symbolSourceId of this.symbolSourcedIds) {\r\n        map.removeSourceEx(symbolSourceId);\r\n      }\r\n      this.symbolSourcedIds = [];\r\n    }\r\n    super.removeLayer(map, layerId);\r\n  }\r\n  \r\n}\r\n","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class SymbolPathAnimateLayer extends LayerBase {\r\n  line!: vjmap.Polyline;\r\n  symbol!: vjmap.Symbol;\r\n  anim: any;\r\n  constructor() {\r\n    super();\r\n  }\r\n  async addLayer(map: Map, mapLayer: MapLayer) {\r\n    super.addLayer(map, mapLayer);\r\n    let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n    // 遍历里面所有的线\r\n    let features = featureCollection.features;\r\n    let geoPointDatas = [];\r\n    let geoLineDatas = [];\r\n    \r\n    for (let i = 0; i < features.length; i++) {\r\n      let geometry = features[i].geometry;\r\n      \r\n      if (geometry.type != \"LineString\") continue;\r\n      let coordinates = map.fromLngLat(geometry.coordinates);\r\n\r\n      if (mapLayer.drawPath) {\r\n        // 线\r\n        geoLineDatas.push({\r\n          points: map.toLngLat(coordinates),\r\n          properties: {\r\n            ...features[i].properties,\r\n          },\r\n        });\r\n      }\r\n\r\n      // 点\r\n      // 获取角度\r\n      const angle = vjmap\r\n        .geoPoint(coordinates[1])\r\n        .angleTo(vjmap.geoPoint(coordinates[0]));\r\n      geoPointDatas.push({\r\n        point: map.toLngLat(coordinates[0]),\r\n        properties: {\r\n          ...features[i].properties,\r\n          bearing: vjmap.radToDeg(-angle),\r\n          path: coordinates,\r\n        },\r\n      });\r\n    }\r\n\r\n    if (geoLineDatas.length > 0) {\r\n        let lineOptionsKeys = Object.keys(mapLayer).filter(key => key.indexOf(\"line\") == 0);\r\n        let lineOptions: any = {};\r\n        for(let key of lineOptionsKeys) {\r\n            lineOptions[key] = mapLayer[key];\r\n        }\r\n       \r\n        this.line = new vjmap.Polyline({\r\n            data: geoLineDatas,\r\n            ...lineOptions,\r\n        });\r\n        this.line.addTo(map);\r\n    }\r\n\r\n    let symbolOptionsKeys = Object.keys(mapLayer).filter(key => key.indexOf(\"symbol\") == 0 || key.indexOf(\"icon\") == 0 || key.indexOf(\"text\") == 0);\r\n    let symbolOptions: any = {};\r\n    for(let key of symbolOptionsKeys) {\r\n        symbolOptions[key] = mapLayer[key];\r\n    }\r\n    this.symbol = new vjmap.Symbol({\r\n      data: geoPointDatas,\r\n      iconAllowOverlap: true,\r\n      iconRotationAlignment: \"map\",\r\n      ...symbolOptions,\r\n      iconRotate: [\"get\", \"bearing\"],\r\n    });\r\n    this.symbol.addTo(map, mapLayer.before);\r\n\r\n    const initData = vjmap.cloneDeep(this.symbol.getData()) as any;\r\n    let lastValue = 0;\r\n    this.anim = vjmap.createAnimation({\r\n      from: 0,\r\n      to: 1,\r\n      repeatType: mapLayer.anmiRepeatType ?? \"reverse\", // 交替反转动画\r\n      repeat: mapLayer.anmiRepeat || Infinity,\r\n      duration: mapLayer.anmiDuration * 1000,\r\n      ease: vjmap.linear, //线性\r\n      onUpdate: (latest: number) => {\r\n        // 是否反转动画了,反转动画需要把车的方向改了\r\n        let isReverse = lastValue > latest;\r\n        lastValue = latest;\r\n        const data = this.symbol.getData() as any;\r\n        for (let i = 0; i < data.features.length; i++) {\r\n          const value = latest;\r\n          const prop = initData.features[i].properties;\r\n          const path = vjmap.interpolatePointsByRatio(prop.path, value);\r\n          if (path.length > 1) {\r\n            let start = path[path.length - 2];\r\n            let end = path[path.length - 1];\r\n            let angle = 0;\r\n            if (isReverse) {\r\n              angle = vjmap.geoPoint(start).angleTo(vjmap.geoPoint(end));\r\n            } else {\r\n              angle = vjmap.geoPoint(end).angleTo(vjmap.geoPoint(start));\r\n            }\r\n            // 更改方位\r\n            data.features[i].properties.bearing = vjmap.radToDeg(-angle);\r\n\r\n            // 更新坐标\r\n            const geojson = vjmap.createPointGeoJson(map.toLngLat(end)) as any;\r\n            if (geojson.features[0] && geojson.features[0].geometry) {\r\n              data.features[i].geometry.coordinates =\r\n                geojson.features[0].geometry.coordinates;\r\n            }\r\n          }\r\n        }\r\n        this.symbol.setData(data);\r\n      },\r\n    });\r\n  }\r\n  setLayerStyle(\r\n    map: Map,\r\n    layerId: string,\r\n    layerProps: Record<string, any>,\r\n    oldLayer: MapLayer\r\n  ) {\r\n    super.setLayerStyle(map, layerId, layerProps, oldLayer);\r\n    this.removeLayer(map, layerId);\r\n    this.addLayer(map, toMapLayer(oldLayer, layerProps));\r\n  }\r\n  setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n    super.setVisible(map, layerId, visibleOff);\r\n    if (visibleOff) {\r\n      this.anim.stop();\r\n      this.symbol.hide();\r\n      if (this.line) this.line.hide();\r\n    } else {\r\n      if (this.line)this.line.show();\r\n      this.symbol.show();\r\n      this.anim.start();\r\n    }\r\n  }\r\n  removeLayer(map: Map, layerId: string) {\r\n    this.anim.stop();\r\n    this.symbol.remove();\r\n    if (this.line) this.line.remove();\r\n    super.removeLayer(map, layerId);\r\n  }\r\n}\r\n","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class FillExtrusionsAnimateLayer extends LayerBase {\r\n  fillExtrusion!: vjmap.FillExtrusion;\r\n  anim: any;\r\n  constructor() {\r\n    super();\r\n  }\r\n  async addLayer(map: Map, mapLayer: MapLayer) {\r\n    super.addLayer(map, mapLayer);\r\n    let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n    let geoDatas = [];\r\n    // 遍历里面所有的线\r\n    let features = featureCollection.features;\r\n    for (let i = 0; i < features.length; i++) {\r\n      let geometry = features[i].geometry;\r\n      if (geometry.type != \"Polygon\") continue;\r\n      geoDatas.push({\r\n        points: geometry.coordinates,\r\n        properties: {\r\n          ...geometry.properties,\r\n        },\r\n      });\r\n    }\r\n    let options = { ...mapLayer };\r\n    // layerId和sourceId内部会自动生成，无需再传\r\n    // @ts-ignore\r\n    delete options.layerId;\r\n    // @ts-ignore\r\n    delete options.sourceId;\r\n    this.fillExtrusion = new vjmap.FillExtrusion({\r\n      data: geoDatas,\r\n      ...options,\r\n      fillExtrusionHeight:['get', 'height'],\r\n    });\r\n    this.fillExtrusion.addTo(map, mapLayer.before);\r\n\r\n    if (mapLayer.anmiDuration) {\r\n      const initData = vjmap.cloneDeep(this.fillExtrusion.getData()) as any;\r\n\r\n      const mapProgressToValues = (idx: number) =>\r\n        vjmap.interpolate(\r\n          [0, 1],\r\n          [\r\n            { height: 0 },\r\n            { height: initData.features[idx].properties.height || 500000 },\r\n          ]\r\n        );\r\n      this.anim = vjmap.createAnimation({\r\n        from: 0,\r\n        to: 1,\r\n        repeatType: mapLayer.anmiRepeatType ?? \"loop\", // 交替反转动画\r\n        repeat: mapLayer.anmiRepeat || Infinity,\r\n        duration: mapLayer.anmiDuration * 1000,\r\n        onUpdate: (latest: number) => {\r\n          const data = this.fillExtrusion.getData() as any;\r\n          for (let i = 0; i < data.features.length; i++) {\r\n            const value = mapProgressToValues(i)(latest);\r\n            data.features[i].properties.height = value.height;\r\n          }\r\n          this.fillExtrusion.setData(data);\r\n        },\r\n      });\r\n    }\r\n  }\r\n  setLayerStyle(\r\n    map: Map,\r\n    layerId: string,\r\n    layerProps: Record<string, any>,\r\n    oldLayer: MapLayer\r\n  ) {\r\n    super.setLayerStyle(map, layerId, layerProps, oldLayer);\r\n    this.removeLayer(map, layerId);\r\n    this.addLayer(map, toMapLayer(oldLayer, layerProps));\r\n  }\r\n  setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n    super.setVisible(map, layerId, visibleOff);\r\n    if (visibleOff) {\r\n      this.fillExtrusion.hide();\r\n      if (this.anim) {\r\n        this.anim.stop();\r\n      }\r\n    } else {\r\n      this.fillExtrusion.show();\r\n      if (this.anim) {\r\n        this.anim.start();\r\n      }\r\n    }\r\n  }\r\n  removeLayer(map: Map, layerId: string) {\r\n    if (this.fillExtrusion) this.fillExtrusion.remove();\r\n    if (this.anim) {\r\n      this.anim.stop();\r\n      this.anim = null;\r\n    }\r\n    super.removeLayer(map, layerId);\r\n  }\r\n}\r\n","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class GeojsonLayer extends LayerBase {\r\n  sourceId!: string;\r\n  constructor() {\r\n    super();\r\n  }\r\n  async addLayer(map: Map, mapLayer: MapLayer) {\r\n    super.addLayer(map, mapLayer);\r\n    let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n    let sourceId = \"geojson_source_\" + vjmap.RandomID();\r\n    this.sourceId = sourceId;\r\n    map.addGeoJSONSource(sourceId, featureCollection);\r\n    // 填充图层\r\n    let fillOptionsKeys = Object.keys(mapLayer).filter(\r\n      (key) => key.indexOf(\"fill\") == 0\r\n    );\r\n    let fillOptions: any = {};\r\n    for (let key of fillOptionsKeys) {\r\n      fillOptions[key] = mapLayer[key];\r\n    }\r\n    map.addFillLayer(sourceId + \"-layer-polygons\", sourceId, {\r\n      source: sourceId,\r\n      ...fillOptions,\r\n      filter: [\"==\", [\"geometry-type\"], \"Polygon\"],\r\n    });\r\n\r\n    // 线图层\r\n    let lineOptionsKeys = Object.keys(mapLayer).filter(\r\n      (key) => key.indexOf(\"line\") == 0\r\n    );\r\n    let lineOptions: any = {};\r\n    for (let key of lineOptionsKeys) {\r\n      lineOptions[key] = mapLayer[key];\r\n    }\r\n    map.addLineLayer(sourceId + \"-layer-lines\", sourceId, {\r\n      source: sourceId,\r\n      ...lineOptions,\r\n      filter: [\"==\", [\"geometry-type\"], \"LineString\"],\r\n    });\r\n\r\n    // 点符号图层\r\n    let circleOptionsKeys = Object.keys(mapLayer).filter(\r\n      (key) => key.indexOf(\"circle\") == 0\r\n    );\r\n    let circleOptions: any = {};\r\n    for (let key of circleOptionsKeys) {\r\n      circleOptions[key] = mapLayer[key];\r\n    }\r\n    map.addCircleLayer(sourceId + \"-layer-points\", sourceId, {\r\n      source: sourceId,\r\n      ...circleOptions,\r\n      filter: [\"==\", [\"geometry-type\"], \"Point\"],\r\n    });\r\n  }\r\n  setLayerStyle(\r\n    map: Map,\r\n    layerId: string,\r\n    layerProps: Record<string, any>,\r\n    oldLayer: MapLayer\r\n  ) {\r\n    super.setLayerStyle(map, layerId, layerProps, oldLayer);\r\n    this.removeLayer(map, layerId);\r\n    this.addLayer(map, toMapLayer(oldLayer, layerProps));\r\n  }\r\n  setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n    super.setVisible(map, layerId, visibleOff);\r\n    if (!this.sourceId) return;\r\n    if (visibleOff) {\r\n      map.hideSource(this.sourceId);\r\n    } else {\r\n      map.showSource(this.sourceId);\r\n    }\r\n  }\r\n  removeLayer(map: Map, layerId: string) {\r\n    if (this.sourceId) {\r\n      map.removeSourceEx(this.sourceId);\r\n      // @ts-ignore\r\n      this.sourceId = undefined;\r\n    }\r\n    super.removeLayer(map, layerId);\r\n  }\r\n}\r\n","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class DrawLayer extends LayerBase {\r\n    draw: any;\r\n    sourceID!: string;\r\n    constructor() {\r\n        super();\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n        super.addLayer(map, mapLayer);\r\n        this.sourceID = mapLayer.sourceId;\r\n        let featureCollection = map.getSourceData(mapLayer.sourceId);\r\n        if (mapLayer.entColorToHtmlColor && featureCollection && featureCollection.features) {\r\n            featureCollection.features.forEach((f: any) => {\r\n                if (f.properties && typeof f.properties.color == \"number\") {\r\n                    f.properties.color = map.entColorToHtmlColor(f.properties.color);\r\n                }\r\n            })\r\n        }\r\n        const opts = vjmap.cloneDeep(vjmap.Draw.defaultOptions()) as any;\r\n        opts.isActionDrawMode = true; // 按钮都隐藏，界面用自己的\r\n        // @ts-ignore\r\n        this.draw = new vjmap.Draw.Tool(opts);\r\n        map.addControl(this.draw, 'top-right');\r\n        this.draw.set(featureCollection);\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        if (!this.draw) return;\r\n        if (visibleOff) {\r\n            this.draw.set({\r\n                type: \"FeatureCollection\",\r\n                features: []\r\n            });\r\n        } else {\r\n            let featureCollection = map.getSourceData(this.sourceID);\r\n            this.draw.set(featureCollection);\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        if (this.draw) {\r\n            this.map.removeControl(this.draw);\r\n            this.draw = null;\r\n        }\r\n        super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class RasterLayer extends LayerBase {\r\n   \r\n    constructor() {\r\n        super();\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n       super.addLayer(map, mapLayer);\r\n       map.addRasterLayer(mapLayer.layerId, mapLayer.sourceId, mapLayer as any, mapLayer.before);\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n       super.setVisible(map, layerId, visibleOff);\r\n       if (visibleOff) {\r\n        map.hide(layerId);\r\n       } else {\r\n        map.show(layerId);\r\n       }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        map.removeLayerEx(layerId);\r\n        super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\n\r\nexport class VectorLayer extends LayerBase {\r\n   layers!: vjmap.AnyLayer[]\r\n    constructor() {\r\n        super();\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n       super.addLayer(map, mapLayer);\r\n       const vectorStyle = map.getService().vectorStyle();\r\n       this.layers = vectorStyle.layers;\r\n       for(let layer of this.layers) {\r\n        // @ts-ignore\r\n         layer.source = mapLayer.sourceId;\r\n         layer.id = layer.id.replace(\"vector-\", mapLayer.layerId + \"-\");\r\n         map.addLayer(layer);\r\n       }\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n       super.setVisible(map, layerId, visibleOff);\r\n       if (visibleOff) {\r\n        for(let layer of this.layers) {\r\n            map.hide(layer.id);\r\n        }\r\n       } else {\r\n        for(let layer of this.layers) {\r\n            map.show(layer.id);\r\n        }\r\n       }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        for(let layer of this.layers) {\r\n            map.removeLayerEx(layer.id);\r\n        }\r\n        super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { DivOverlayOptions, Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nimport { toMapLayer } from \"../utils\";\r\nexport class DivOverlayLayer extends LayerBase {\r\n    overlay!: vjmap.DivOverlay;\r\n    constructor() {\r\n        super();\r\n    }\r\n    createDivOverlay(properties: Record<string, any>, options: Record<string, any>, map: Map) {\r\n        let divOverlayOpts = this.evalValue(options, properties, map);\r\n        if (!divOverlayOpts.bounds) return;\r\n        if (!divOverlayOpts.width) return;\r\n        if (!divOverlayOpts.height) return;\r\n       \r\n        if (Array.isArray(divOverlayOpts.bounds) && divOverlayOpts.bounds.length == 2) {\r\n            divOverlayOpts.bounds = new vjmap.GeoBounds(vjmap.geoPoint(divOverlayOpts.bounds[0]), vjmap.geoPoint(divOverlayOpts.bounds[1]))\r\n        }\r\n        if (divOverlayOpts.customHtml) {\r\n            // 如果有自定义html内容\r\n            let element = this.evalValue(options.customHtml, properties, map); \r\n            divOverlayOpts.element = element;\r\n        }\r\n        else if (divOverlayOpts.customImage) {\r\n            if (divOverlayOpts.customImage.toLowerCase().indexOf(\"<svg\") == 0) {\r\n                //svg或//base64 png\r\n                divOverlayOpts.customImage =  \"data:image/svg+xml;base64,\" + window.btoa(unescape(encodeURIComponent(options.customImage))) ;\r\n            }\r\n            const image = document.createElement( \"img\" );\r\n            image.style.position = \"absolute\"; // 有多个divoverlay时，一定要加定位，否则会导致其他绘制不对\r\n            image.style.left = '0px';\r\n            image.style.top = '0px';\r\n            image.style.width = divOverlayOpts.width + \"px\";\r\n            image.style.height = divOverlayOpts.height + \"px\";\r\n            image.src = divOverlayOpts.customImage\r\n            image.style.pointerEvents = \"none\"\r\n            divOverlayOpts.element = image;\r\n        }\r\n        if (!divOverlayOpts.element) return;\r\n\r\n        this.overlay = new vjmap.DivOverlay(divOverlayOpts);\r\n        this.overlay.addTo(map);\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n        super.addLayer(map, mapLayer);\r\n        this.createDivOverlay({}, mapLayer, map); \r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        if (this.overlay) {\r\n            this.overlay.setVisible(!visibleOff)\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        if (this.overlay) {\r\n            this.overlay.remove();\r\n        }\r\n        super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map, SvgOverlayOptions } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\nexport class SvgOverlayLayer extends LayerBase {\r\n    overlay!: vjmap.SvgOverlay;\r\n    constructor() {\r\n        super();\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n        super.addLayer(map, mapLayer);\r\n        this.overlay = new vjmap.SvgOverlay(mapLayer as SvgOverlayOptions);\r\n        this.overlay.addTo(map);\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n        super.setVisible(map, layerId, visibleOff);\r\n        if (this.overlay && this.overlay.divOverlay) {\r\n            this.overlay.divOverlay.setVisible(!visibleOff)\r\n        }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        if (this.overlay) {\r\n            this.overlay.remove();\r\n        }\r\n        super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\n\r\nexport class BackgroundLayer extends LayerBase {\r\n    background!: vjmap.BackgroundLayer;\r\n    constructor() {\r\n        super();\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n       super.addLayer(map, mapLayer);\r\n       this.background = new vjmap.BackgroundLayer(mapLayer as any);\r\n       this.background.addTo(map, mapLayer.before);\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n       super.setVisible(map, layerId, visibleOff);\r\n       if (visibleOff) {\r\n        this.background.hide()\r\n       } else {\r\n        this.background.show();\r\n       }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        map.removeLayerEx(layerId);\r\n        super.removeLayer(map, layerId);\r\n    }\r\n}","import { MapLayer } from \"../types\";\r\nimport vjmap, { Map } from \"vjmap\";\r\nimport LayerBase from \"./base\";\r\n\r\nexport class SkyLayer extends LayerBase {\r\n    sky!: vjmap.SkyLayer;\r\n    constructor() {\r\n        super();\r\n    }\r\n    async addLayer(map: Map, mapLayer: MapLayer) {\r\n       super.addLayer(map, mapLayer);\r\n       this.sky = new vjmap.SkyLayer(mapLayer as any);\r\n       this.sky.addTo(map, mapLayer.before);\r\n    }\r\n    setVisible(map: Map, layerId: string, visibleOff?: boolean) {\r\n       super.setVisible(map, layerId, visibleOff);\r\n       if (visibleOff) {\r\n        this.sky.hide()\r\n       } else {\r\n        this.sky.show();\r\n       }\r\n    }\r\n    removeLayer(map: Map, layerId: string) {\r\n        map.removeLayerEx(layerId);\r\n        super.removeLayer(map, layerId);\r\n    }\r\n}","import LayerBase from './base';\r\nimport { LineLayer } from './line';\r\nimport { FillLayer } from './fill';\r\nimport { SymbolLayer } from './symbol';\r\nimport { CircleLayer } from './circle';\r\nimport { FillExtrusionLayer } from './fillExtrusion';\r\nimport { HeatmapLayer } from './heatmap';\r\nimport { MarkerLayer } from './marker';\r\nimport { PopupLayer } from './popup';\r\nimport { AnimateLineLayer } from './animateLine';\r\nimport { AnimateSymbolLayer } from './animateSymbol';\r\nimport { AnimateFillLayer } from './animateFill';\r\nimport { SymbolClusterLayer } from './symbolCluster';\r\nimport { MarkerClusterLayer } from './markerCluster';\r\nimport { TextLayer } from './text';\r\nimport { BreathingMarkerLayer } from './breathingMarker';\r\nimport { RotatingMarkerLayer } from './rotatingMarker';\r\nimport { HaloRingMarkerLayer } from './haloRingMarker';\r\nimport { DiffusedMarkerLayer } from './diffusedMarker';\r\nimport { TextBorderMarkerLayer } from './textBorderMarker';\r\nimport { FluorescenceMarkerLayer } from './fluorescenceMarker';\r\nimport { CurveLayer } from './curve';\r\nimport { LineExtrusionsLayer } from './lineExtrusions';\r\nimport { ArrowLineLayer } from './arrowLine';\r\nimport { PathAnimateLayer } from './pathAnimate'\r\nimport { SymbolPathAnimateLayer} from './symbolPathAnimate'\r\nimport { FillExtrusionsAnimateLayer } from './fillExtrusionsAnimate'\r\nimport { GeojsonLayer } from './geojson'\r\nimport { DrawLayer } from './draw';\r\nimport { RasterLayer } from './raster'\r\nimport { VectorLayer } from './vector'\r\nimport { DivOverlayLayer } from './divOverlay'\r\nimport { SvgOverlayLayer } from './svgOverlay'\r\nimport { BackgroundLayer } from './background'\r\nimport { SkyLayer } from './sky'\r\n\r\nconst providerLayers = {\r\n    \"line\": LineLayer,\r\n    \"fill\": FillLayer,\r\n    \"symbol\": SymbolLayer,\r\n    \"marker\": MarkerLayer,\r\n    \"popup\": PopupLayer,\r\n    \"circle\": CircleLayer,\r\n    \"fillExtrusion\": FillExtrusionLayer,\r\n    \"heatmap\": HeatmapLayer,\r\n    \"animateLine\": AnimateLineLayer,\r\n    \"animateSymbol\": AnimateSymbolLayer,\r\n    \"animateFill\": AnimateFillLayer,\r\n    \"symbolCluster\": SymbolClusterLayer,\r\n    \"markerCluster\": MarkerClusterLayer,\r\n    \"text\": TextLayer,\r\n    \"breathingMarker\": BreathingMarkerLayer,\r\n    \"rotatingMarker\": RotatingMarkerLayer,\r\n    \"haloRingMarker\": HaloRingMarkerLayer,\r\n    \"diffusedMarker\": DiffusedMarkerLayer,\r\n    \"textBorderMarker\": TextBorderMarkerLayer,\r\n    \"fluorescenceMarker\": FluorescenceMarkerLayer,\r\n    \"curve\": CurveLayer,\r\n    \"lineExtrusions\": LineExtrusionsLayer,\r\n    \"arrowLine\": ArrowLineLayer,\r\n    \"pathAnimate\": PathAnimateLayer,\r\n    \"symbolPathAnimate\": SymbolPathAnimateLayer,\r\n    \"fillExtrusionsAnimate\": FillExtrusionsAnimateLayer,\r\n    \"geojson\": GeojsonLayer,\r\n    \"draw\": DrawLayer,\r\n    'raster': RasterLayer,\r\n    'vector': VectorLayer,\r\n    'divOverlay': DivOverlayLayer,\r\n    'svgOverlay': SvgOverlayLayer,\r\n    \"background\": BackgroundLayer,\r\n    \"sky\": SkyLayer,\r\n} as Record<string, typeof LayerBase>\r\n\r\nexport type providerLayerTypes = keyof typeof providerLayers\r\nexport {\r\n    providerLayers,\r\n    LayerBase\r\n}","export type IIndexDb = {\r\n    dbName: string\r\n    version: number\r\n    tables: DbTable[]\r\n}\r\nexport type DbIndex = { key: string, option?: IDBIndexParameters }\r\nexport type DbTable = {\r\n    tableName: string,\r\n    option?: IDBObjectStoreParameters\r\n    indexs: DbIndex[]\r\n}\r\nexport interface DbOperate<T> {\r\n    tableName: string,\r\n    key: string,\r\n    data: T | T[],\r\n    value: string | number,\r\n    condition(data: T): boolean\r\n    success(res: T[] | T): void\r\n    handle(res: T): void\r\n\r\n}\r\n\r\nexport class TsIndexDb {\r\n\r\n    private dbName: string = '';//数据库名称\r\n    private version: number = 1;//数据库版本\r\n    private tableList: DbTable[] = [];//表单列表\r\n    private db: IDBDatabase | null = null;\r\n    private queue: (() => void)[] = []; //事务队列，实例化一次以后下次打开页面时数据库自启动\r\n    constructor({ dbName, version, tables }: IIndexDb) {\r\n        this.dbName = dbName;\r\n        this.version = version;\r\n        this.tableList = tables;\r\n    }\r\n\r\n    private static _instance: any = null;\r\n\r\n    public static getInstance(dbOptions: IIndexDb): TsIndexDb {\r\n        TsIndexDb._instance = TsIndexDb._instance ?? {};\r\n        const dbName = dbOptions?.dbName ?? \"\";\r\n        if (!TsIndexDb._instance[dbName]) {\r\n            TsIndexDb._instance[dbName] = new TsIndexDb(dbOptions);\r\n        }\r\n        return TsIndexDb._instance[dbName];\r\n    }\r\n\r\n\r\n\r\n\r\n    //=================relate select================================\r\n    /**\r\n     * @method 查询某张表的所有数据(返回具体数组)\r\n     * @param {Object}\r\n     *   @property {String} tableName 表名\r\n     */\r\n    queryAll<T>({ tableName }: Pick<DbOperate<T>, 'tableName'>) {\r\n        const res: T[] = [];\r\n        return this.commitDb<T[]>(tableName, (transaction: IDBObjectStore) => transaction.openCursor(), 'readonly', (e: any, resolve: (data: T[]) => void) => {\r\n            this.cursor_success(e, {\r\n                condition: () => true,\r\n                handler: ({ currentValue }: any) => res.push(currentValue),\r\n                success: () => resolve(res)\r\n            })\r\n        })\r\n    }\r\n\r\n    /**\r\n     * @method 查询(返回具体数组)\r\n     * @param {Object}\r\n     *   @property {String} tableName 表名\r\n     *   @property {Function} condition 查询的条件\r\n     * */\r\n    query<T>({ tableName, condition }: Pick<DbOperate<T>, 'condition' | 'tableName'>) {\r\n        const res: T[] = [];\r\n        return this.commitDb<T[]>(tableName, (transaction: IDBObjectStore) => transaction.openCursor(), 'readonly', (e: any, resolve: (data: T[]) => void) => {\r\n            this.cursor_success(e, {\r\n                condition,\r\n                handler: ({ currentValue }: any) => res.push(currentValue),\r\n                success: () => resolve(res)\r\n            })\r\n        })\r\n    }\r\n\r\n    /**\r\n     * @method 查询数据(更具表具体属性)返回具体某一个\r\n     * @param {Object}\r\n     *   @property {String} tableName 表名\r\n     *   @property {Number|String} key 名\r\n     *   @property {Number|String} value 值\r\n     *\r\n     * */\r\n    query_by_keyValue<T>({ tableName, key, value }: Pick<DbOperate<T>, 'tableName' | 'key' | 'value'>) {\r\n        return this.commitDb<T>(tableName, (transaction: IDBObjectStore) => transaction.index(key).get(value), 'readonly', (e: any, resolve: (data: T) => void) => {\r\n            resolve(e.target.result || null);\r\n        })\r\n    }\r\n\r\n    /**\r\n     * @method 查询数据（主键值）\r\n     * @param {Object}\r\n     *   @property {String} tableName 表名\r\n     *   @property {Number|String} value 主键值\r\n     *\r\n     * */\r\n    query_by_primaryKey<T>({ tableName, value }: Pick<DbOperate<T>, 'tableName' | 'value'>) {\r\n        return this.commitDb<T>(tableName, (transaction: IDBObjectStore) => transaction.get(value), 'readonly', (e: any, resolve: (data: T) => void) => {\r\n            resolve(e.target.result || null);\r\n        })\r\n    }\r\n\r\n    //=================relate update================================\r\n    /**\r\n     * @method 修改数据(返回修改的数组)\r\n     * @param {Object}\r\n     *   @property {String} tableName 表名\r\n     *   @property {Function} condition 查询的条件，遍历，与filter类似\r\n     *      @arg {Object} 每个元素\r\n     *      @return 条件\r\n     *   @property {Function} handle 处理函数，接收本条数据的引用，对其修改\r\n     * */\r\n    update<T>({ tableName, condition, handle }: Pick<DbOperate<T>, 'tableName' | 'condition' | 'handle'>) {\r\n        const res: T[] = [];\r\n        return this.commitDb<T>(tableName, (transaction: IDBObjectStore) => transaction.openCursor(), 'readwrite', (e: any, resolve: (data: T[]) => void) => {\r\n            this.cursor_success(e, {\r\n                condition,\r\n                handler: ({ currentValue, cursor }: any) => {\r\n                    const value = handle(currentValue);\r\n                    res.push(value as any);\r\n                    cursor.update(value);\r\n                },\r\n                success: () => {\r\n                    resolve(res);\r\n                }\r\n            })\r\n        })\r\n    }\r\n\r\n    /**\r\n    * @method 修改某条数据(主键)返回修改的对象\r\n    * @param {Object}\r\n    *   @property {String} tableName 表名\r\n    *   @property {String\\|Number} value 目标主键值\r\n    *   @property {Function} handle 处理函数，接收本条数据的引用，对其修改\r\n    * */\r\n    update_by_primaryKey<T>({ tableName, value, handle }: Pick<DbOperate<T>, 'tableName' | 'value' | 'handle'>) {\r\n        return this.commitDb<T>(tableName, (transaction: IDBObjectStore) => transaction.get(value), 'readwrite',\r\n            (e: any, resolve: (data: T | null) => void, store: IDBObjectStore) => {\r\n                const currentValue = e.target.result;\r\n                if (!currentValue) {\r\n                    resolve(null);\r\n                    return\r\n                }\r\n                const value = handle(currentValue);\r\n                store.put(value);\r\n                resolve(value as any);\r\n            });\r\n    }\r\n\r\n    //=================relate insert================================\r\n    /**\r\n     * @method 增加数据\r\n     * @param {Object}\r\n     *   @property {String} tableName 表名\r\n     *   @property {Object} data 插入的数据\r\n     * */\r\n    insert<T>({ tableName, data }: Pick<DbOperate<T>, 'tableName' | 'data'>) {\r\n        return this.commitDb<T>(tableName, undefined, 'readwrite',\r\n            (_: any, resolve: () => void, store: IDBObjectStore) => {\r\n                data instanceof Array ? data.forEach(v => store.put(v)) : store.put(data);\r\n                resolve();\r\n            })\r\n\r\n    }\r\n    //=================relate delete================================\r\n    /**\r\n     * @method 删除数据(返回删除数组)\r\n     * @param {Object}\r\n     *   @property {String} tableName 表名\r\n     *   @property {Function} condition 查询的条件，遍历，与filter类似\r\n     *      @arg {Object} 每个元素\r\n     *      @return 条件\r\n     * */\r\n    delete<T>({ tableName, condition }: Pick<DbOperate<T>, 'tableName' | 'condition'>) {\r\n        const res: T[] = [];\r\n        return this.commitDb<T>(tableName, (transaction: IDBObjectStore) => transaction.openCursor(), 'readwrite', (e: any, resolve: (data: T[]) => void) => {\r\n            this.cursor_success(e, {\r\n                condition,\r\n                handler: ({ currentValue, cursor }: any) => {\r\n                    res.push(currentValue);\r\n                    cursor.delete();\r\n                },\r\n                success: () => {\r\n                    resolve(res);\r\n                }\r\n            })\r\n        })\r\n    }\r\n\r\n\r\n    /**\r\n     * @method 删除数据(主键)\r\n     * @param {Object}\r\n     *   @property {String} tableName 表名\r\n     *   @property {String\\|Number} value 目标主键值\r\n     * */\r\n    delete_by_primaryKey<T>({ tableName, value }: Pick<DbOperate<T>, 'tableName' | 'value'>) {\r\n        return this.commitDb<T>(tableName, (transaction: IDBObjectStore) => transaction.delete(value), 'readwrite', (e: any, resolve: () => void) => {\r\n            resolve()\r\n        })\r\n    }\r\n\r\n    //=================relate db================================\r\n\r\n    /**\r\n     * @method 打开数据库\r\n     */\r\n    open_db() {\r\n        return new Promise<TsIndexDb>((resolve, reject) => {\r\n            const request = window.indexedDB.open(this.dbName, this.version);\r\n            request.onerror = e => {\r\n                reject(e);\r\n            };\r\n            request.onsuccess = (event: any) => {\r\n                this.db = event.target.result;\r\n                let task: () => void;\r\n\r\n                // eslint-disable-next-line no-cond-assign\r\n                while (task = this.queue.pop() as any) {\r\n                    task();\r\n                }\r\n\r\n                resolve(this);\r\n            };\r\n            //数据库升级\r\n            request.onupgradeneeded = e => {\r\n                this.tableList.forEach((element: DbTable) => {\r\n                    this.create_table((e.target as any).result, element);\r\n                });\r\n            };\r\n        });\r\n    }\r\n\r\n    /**\r\n        *@method 关闭数据库\r\n        * @param  {[type]} db [数据库名称]\r\n        */\r\n    close_db() {\r\n        return new Promise((resolve, reject) => {\r\n            try {\r\n                if (!this.db) {\r\n                    resolve('请开启数据库')\r\n                    return\r\n                }\r\n                this.db!.close();\r\n                this.db = null;\r\n                if (TsIndexDb._instance) {\r\n                    delete TsIndexDb._instance[this.dbName];\r\n                }\r\n                resolve(true)\r\n            } catch (error) {\r\n                reject(error)\r\n            }\r\n        })\r\n\r\n    }\r\n    /**\r\n     * @method 删除数据库\r\n     * @param {String}name 数据库名称\r\n     */\r\n    delete_db(name: string) {\r\n        return new Promise((resolve, reject) => {\r\n            const request = indexedDB.deleteDatabase(name);\r\n            request.onerror = e => {\r\n                reject(e);\r\n            };\r\n            request.onsuccess = e => {\r\n                resolve(e);\r\n            };\r\n        });\r\n    }\r\n\r\n    /**\r\n    * @method 删除表数据\r\n    * @param {String}name 数据库名称\r\n    */\r\n    delete_table(tableName: string) {\r\n        return this.commitDb(tableName, (transaction: IDBObjectStore) => transaction.clear(), 'readwrite',\r\n            (_: any, resolve: () => void) => {\r\n                resolve();\r\n            })\r\n    }\r\n    /**\r\n     * 创建table\r\n     * @option<Object>  keyPath指定主键 autoIncrement是否自增\r\n     * @index 索引配置\r\n     * */\r\n    private create_table(idb: any, { tableName, option, indexs = [] }: DbTable) {\r\n\r\n        if (!idb.objectStoreNames.contains(tableName)) {\r\n            const store = idb.createObjectStore(tableName, option);\r\n            for (const { key, option } of indexs) {\r\n                store.createIndex(key, key, option);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * 提交Db请求\r\n     * @param tableName  表名\r\n     * @param commit 提交具体函数\r\n     * @param mode 事物方式\r\n     * @param backF 游标方法\r\n     */\r\n    private commitDb<T>(tableName: string,\r\n        commit?: (transaction: IDBObjectStore) => IDBRequest<any>,\r\n        mode: IDBTransactionMode = 'readwrite',\r\n        backF?: (request: any, resolve: any, store: IDBObjectStore) => void) {\r\n        return new Promise<T>((resolve, reject) => {\r\n            const task = () => {\r\n                try {\r\n                    if (this.db) {\r\n                        const store = this.db.transaction(tableName, mode).objectStore(tableName);\r\n                        if (!commit) {\r\n                            backF!(null, resolve, store);\r\n                            return;\r\n                        }\r\n                        const res = commit(store);\r\n                        res!.onsuccess = (e: any) => {\r\n                            if (backF) {\r\n                                backF(e, resolve, store);\r\n                            } else {\r\n                                resolve(e);\r\n                            }\r\n                        };\r\n                        res!.onerror = (event) => {\r\n                            reject(event);\r\n                        };\r\n\r\n                    } else {\r\n                        reject(new Error('请开启数据库'));\r\n                    }\r\n                } catch (error) {\r\n                    reject(error);\r\n                }\r\n            };\r\n\r\n            if (!this.db) {\r\n                this.queue.push(task);\r\n            } else {\r\n                task();\r\n            }\r\n            \r\n        });\r\n    }\r\n\r\n    /**\r\n    * @method 游标开启成功,遍历游标\r\n    * @param {Function} 条件\r\n    * @param {Function} 满足条件的处理方式 @arg {Object} @property cursor游标 @property currentValue当前值\r\n    * @param {Function} 游标遍历完执行的方法\r\n    * @return {Null}\r\n    * */\r\n    cursor_success(e: any, { condition, handler, success }: any) {\r\n        const cursor: IDBCursorWithValue = e.target.result;\r\n        if (cursor) {\r\n            const currentValue = cursor.value;\r\n            if (condition(currentValue)) handler({ cursor, currentValue });\r\n            cursor.continue();\r\n        } else {\r\n            success();\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * @method 初始化函数\r\n * @param param0 \r\n * @param isMany \r\n */\r\nexport const initIndexDb = ({ dbName, version = 1, tables = [] }: IIndexDb): Promise<TsIndexDb> => {\r\n    const db = TsIndexDb.getInstance({\r\n        dbName,\r\n        version,\r\n        tables\r\n    })\r\n    return db.open_db()\r\n}\r\n\r\n/**\r\n * @method 获取单例的单个对象\r\n */\r\nexport const getInstance = (dbName: string) => TsIndexDb.getInstance({ dbName, version:1, tables: []} )\r\n","import { getInstance, initIndexDb } from \"./indexDb\";\r\n\r\nexport type DbRecord = {\r\n  id?: string;\r\n  key: string;\r\n  value: string;\r\n};\r\n\r\nexport class CacheDbStorage {\r\n  dbName: string;\r\n  tableName: string;\r\n  isInitDb: boolean;\r\n  constructor() {\r\n    this.dbName = \"vjmapCache\";\r\n    this.tableName = \"cache\";\r\n    this.isInitDb = false;\r\n  }\r\n\r\n  public async init() {\r\n    if (this.isInitDb) return;\r\n    await initIndexDb({\r\n      dbName: this.dbName, // 数据库名称\r\n      version: 1, // 版本号\r\n      tables: [\r\n        {\r\n          tableName: this.tableName, // 表名\r\n          option: { keyPath: \"id\", autoIncrement: true }, // 指明主键为id\r\n          indexs: [\r\n            // 数据库索引\r\n            {\r\n              key: \"id\",\r\n              option: {\r\n                unique: true,\r\n              },\r\n            },\r\n            {\r\n              key: \"key\",\r\n            },\r\n            {\r\n              key: \"value\",\r\n            },\r\n          ],\r\n        },\r\n      ],\r\n    });\r\n    this.isInitDb = true;\r\n  }\r\n\r\n  public getInst() {\r\n    return getInstance(this.dbName);\r\n  }\r\n  public async getAll() {\r\n    await this.init();\r\n    return await this.getInst().queryAll<DbRecord>({\r\n      tableName: this.tableName,\r\n    });\r\n  }\r\n\r\n  public async getRecordByKey(key: string) {\r\n    await this.init();\r\n    return await this.getInst().query<DbRecord>({\r\n      tableName: this.tableName,\r\n      condition: (item) => item.key === key,\r\n    });\r\n  }\r\n\r\n  public async getValueByKey(key: string, parseJson?: boolean) {\r\n    const records = await this.getRecordByKey(key);\r\n    if (records.length == 0) return;\r\n    if (parseJson === true) {\r\n        return JSON.parse(records[0].value);\r\n    }\r\n    return records[0].value;\r\n  }\r\n\r\n  public async setValueByKey(key: string, value: any, toJson?: boolean) {\r\n    return await this.upsert({\r\n      key,\r\n      value: toJson === true ? JSON.stringify(value, null, 0) : value\r\n    })\r\n  }\r\n\r\n  public async upsert(record: DbRecord) {\r\n    await this.init();\r\n    const records = await this.getRecordByKey(record.key);\r\n    if (records.length == 0) {\r\n      // 新增\r\n      return await this.getInst().insert<DbRecord>({\r\n        tableName: this.tableName,\r\n        data: record,\r\n      });\r\n    } else {\r\n      // 修改\r\n      return await this.getInst().update<DbRecord>({\r\n        tableName: this.tableName,\r\n        condition: (item) => item.key === record.key,\r\n        handle: (r) => {\r\n          r.value = record.value;\r\n          return r;\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  public async deleteRecord(key: string) {\r\n    await this.init();\r\n    return await this.getInst().delete<DbRecord>({\r\n      tableName: this.tableName,\r\n      condition: (item) => item.key === key,\r\n    });\r\n  }\r\n\r\n  public async deleteTable() {\r\n    await this.init();\r\n    return await this.getInst().delete_table(this.tableName);\r\n  }\r\n\r\n  public async deleteDb() {\r\n    await this.init();\r\n    return await this.getInst().delete_db(this.dbName);\r\n  }\r\n\r\n  public toStringKey(key: Record<string, any>, prefix?: string): string {\r\n    prefix = prefix ?? \"\"\r\n    return prefix + JSON.stringify(key, null, 0)\r\n  }\r\n}\r\n\r\nconst cacheStorage = new CacheDbStorage();\r\nexport {\r\n  cacheStorage\r\n};\r\n","import vjmap, { Map } from \"vjmap\";\r\nimport { cacheStorage } from \"../cache\";\r\n\r\n// 从后台查询地图数据\r\nexport async function queryMapData(\r\n  map: Map,\r\n  queryParam: {\r\n    condition?: string /* 查询 sql 条件 */;\r\n    bounds?: string /* 查询 范围，为空表示不限制 */;\r\n    isContains?: boolean /* 相交或包含 */;\r\n    coordType?: 0 | 1 /* 0 查询位置坐标 1 查询几何坐标 */;\r\n    clearPropData?: boolean /* 是否清空属性数据 */;\r\n    disableCacheData?: boolean /* 是否禁用本地缓存数据 */;\r\n  },\r\n  condition?: Record<string, any>\r\n) {\r\n  let svc = map.getService();\r\n  // 先从缓存中去查询。如果缓存中有，则直接从缓存中获取就可能了\r\n  const cacheKey = {\r\n    mapId: svc.currentMapParam()?.mapid,\r\n    version: svc.currentMapParam()?.version,\r\n    workspace: svc.getCurWorkspaceName(),\r\n    layername: svc.currentMapParam()?.layer,\r\n    ...queryParam,\r\n    ...condition\r\n  };\r\n  if (queryParam.disableCacheData === true) {\r\n    let cahceResult = await cacheStorage.getValueByKey(cacheStorage.toStringKey(cacheKey, \"query_\"), true);\r\n    if (cahceResult) return cahceResult; // 返回缓存结果\r\n  }\r\n  let res: any;\r\n  const result = [];\r\n  let beginPos = 0; // 记录查询开始位置\r\n  // 有可能记录数会很多，这里用分页查询\r\n  const limit = 50000; // 每次查5万条\r\n  let bounds: any;\r\n  if (queryParam.bounds) {\r\n    bounds = vjmap.GeoBounds.fromString(queryParam.bounds).toArray();\r\n  }\r\n  // eslint-disable-next-line no-constant-condition\r\n  while (true) {\r\n    const query = await svc.conditionQueryFeature({\r\n      condition: queryParam.condition ?? '', // 只需要写sql语句where后面的条件内容,字段内容请参考文档\"服务端条件查询和表达式查询\"\r\n      bounds: bounds, //查找此范围内的实体\r\n      fields: \"\",\r\n      includegeom: queryParam.coordType == 1, // 是否返回几何数据,为了性能问题，realgeom为false时，如果返回条数大于1.只会返回每个实体的外包矩形，如果条数为1的话，会返回此实体的真实geojson；realgeom为true时每条都会返回实体的geojson\r\n      realgeom: queryParam.coordType == 1,\r\n      isContains: queryParam.isContains, //矩形包含才行,false是相交关系\r\n      beginpos: beginPos, // 记录开始位置\r\n      limit: limit, // 每次查5万条\r\n      ...queryParam,\r\n    });\r\n    if (!query.result) break;\r\n    beginPos += limit; // 开始位置位置挪动\r\n    result.push(...(query.result || []));\r\n    if (result.length >= query.recordCount) break;\r\n  }\r\n  res = {\r\n    result,\r\n    recordCount: result.length,\r\n  };\r\n\r\n  let retResult = ProcessDataToFeatureCollection(map, res, queryParam.coordType == 1);\r\n  if (queryParam.disableCacheData === true) {\r\n    await cacheStorage.setValueByKey(cacheStorage.toStringKey(cacheKey, \"query_\"), retResult, true);\r\n  }\r\n  return retResult;\r\n}\r\n\r\nexport const toProperties = (param: Record<string, any>) => {\r\n  const excludeKeys = new Set([\r\n    \"id\",\r\n    \"isEnvelop\",\r\n    \"envelop\",\r\n    \"geojson\",\r\n    \"geom\",\r\n    \"isPoint\",\r\n    \"isline\",\r\n    \"points\"\r\n  ]);\r\n  const props: Record<string, any> = {};\r\n  for (const k in param) {\r\n    if (excludeKeys.has(k)) continue;\r\n    props[k] = param[k];\r\n  }\r\n  return props;\r\n};\r\n// 把后台查询的数据转成Geojson数据\r\nexport function ProcessDataToFeatureCollection(map: Map, res: any /* 后台查询的数据结果 */, isUseGeomCoord: boolean /* 是否是几何坐标 */) {\r\n  const FeatureCollection = {\r\n    features: [],\r\n    type: \"FeatureCollection\",\r\n  };\r\n\r\n  \r\n  if (res && res.result && res.result.length > 0) {\r\n    for (const ent of res.result) {\r\n      if (isUseGeomCoord) {\r\n        // 几何坐标\r\n        if (ent.geom && ent.geom.geometries) {\r\n          let ft: any = {\r\n              id: ent.id,\r\n              type: \"Feature\",\r\n              properties: toProperties(ent)\r\n          }\r\n          if (ent.geom.geometries.length == 1) {\r\n             ft = {\r\n                  ...ft,\r\n                  geometry: ent.geom.geometries[0],\r\n             };\r\n          } else {\r\n              ft = {\r\n                  ...ft,\r\n                  geometry: {\r\n                      geometries: ent.geom.geometries,\r\n                      type: \"GeometryCollection\"\r\n                  },\r\n              };\r\n          }\r\n          // @ts-ignore\r\n          FeatureCollection.features.push(ft);\r\n        }\r\n      } else {\r\n        // 使用位置坐标\r\n        const coord =\r\n          ent.points || ent.positon || ent.location || ent.origin || ent.center;\r\n        if (coord) {\r\n          const pts = coord.split(\";\");\r\n          const points = [];\r\n          for(let p of pts) {\r\n            if (p.indexOf(\",\") > 0)\r\n            points.push(map.toLngLat(vjmap.GeoPoint.fromString(p)))\r\n          }\r\n\r\n          if (points.length == 1) {\r\n            const feature = {\r\n              type: \"Feature\",\r\n              id: ent.id,\r\n              properties: toProperties(ent),\r\n              geometry: {\r\n                // @ts-ignore\r\n                type: \"Point\",\r\n                // @ts-ignore\r\n                coordinates: points[0],\r\n              },\r\n            };\r\n            // @ts-ignore\r\n            FeatureCollection.features.push(feature);\r\n          } else if (points.length > 1) {\r\n            const feature = {\r\n              type: \"Feature\",\r\n              id: ent.id,\r\n              properties: toProperties(ent),\r\n              geometry: {\r\n                // @ts-ignore\r\n                type: \"LineString\",\r\n                // @ts-ignore\r\n                coordinates: points,\r\n              },\r\n            };\r\n            // @ts-ignore\r\n            FeatureCollection.features.push(feature);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  let retResult = map.fromLngLat(FeatureCollection);\r\n  return retResult;\r\n}\r\n\r\n// 请求动态数据\r\nexport async function requestChangeData(\r\n  map: Map,\r\n  param: {\r\n    reqType: 'GET' | 'POST' | \"SOURCE\";\r\n    url: string;\r\n    data?: any;\r\n    header?: Record<string, string>; // 请求头\r\n    processJS?: string; // 处理数据的js代码\r\n    fromSourceId?: string; // 来源数据源ID\r\n  },\r\n  mapApp?: any\r\n) {\r\n  let res: any;\r\n  if (param.reqType == \"SOURCE\") {\r\n    // 数据源数据\r\n    if (param.fromSourceId) {\r\n      res = await mapApp.getSourceData(param.fromSourceId);\r\n    }\r\n  } else {\r\n    if (param.data && typeof param.data == \"string\") {\r\n      param.data = JSON.parse(param.data);\r\n    }\r\n    if (param.header && typeof param.header == \"string\") {\r\n      param.header = JSON.parse(param.header);\r\n    }\r\n    let args = {\r\n      headers: {\"Accept\": \"application/json\", \"Content-Type\":\"application/json\", ...param.header}\r\n    }\r\n    if (param.url) {\r\n      if (param.reqType == \"POST\") {\r\n        res = await vjmap.httpHelper.post(param.url, param.data, args)\r\n      } else {\r\n        res = await vjmap.httpHelper.get(param.url, param.data, args)\r\n      }\r\n    }\r\n  }\r\n  \r\n  if (param.processJS) {\r\n    res = await evalDataConvert(res, param.processJS, map, mapApp);\r\n  }\r\n  return res;\r\n}\r\n\r\n\r\nexport const convertArrayToGeoJson = (value: Array<[number, number]>) => {\r\n  let colls: any = {\r\n      type: \"FeatureCollection\",\r\n      features: []\r\n  }\r\n  // 点\r\n  for(let i = 0; i < value.length; i++) {\r\n      let item = value[i];\r\n      if (Array.isArray(item) && item.length == 2 && typeof(item)[0] == 'number') {\r\n          // 数组项格式为[x,y]，则为点\r\n          colls.features.push({\r\n              \"type\": \"Feature\",\r\n              \"id\": i + 1,\r\n              \"properties\": {\r\n                  \"index\": i + 1\r\n              },\r\n              \"geometry\": {\r\n                  \"type\": \"Point\",\r\n                  \"coordinates\": item\r\n              }\r\n          })\r\n      } else if (Array.isArray(item) && Array.isArray(item[0]) && typeof(item[0][0]) == 'number') {\r\n          // 数组项格式为[[x1,y1], [x2,y2],...]，则为线\r\n          colls.features.push({\r\n              \"type\": \"Feature\",\r\n              \"id\": i + 1,\r\n              \"properties\": {\r\n                  \"index\": i + 1\r\n              },\r\n              \"geometry\": {\r\n                  \"type\": \"LineString\",\r\n                  \"coordinates\": value[i]\r\n              }\r\n          })\r\n      } else if (Array.isArray(item) && Array.isArray(item[0]) && Array.isArray(item[0][0]) && typeof(item[0][0][0]) == 'number') {\r\n          // 数组项格式为[[[x1,y1], [x2,y2],...]]，则为多边形\r\n          colls.features.push({\r\n              \"type\": \"Feature\",\r\n              \"id\": i + 1,\r\n              \"properties\": {\r\n                  \"index\": i + 1\r\n              },\r\n              \"geometry\": {\r\n                  \"type\": \"Polygon\",\r\n                  \"coordinates\": value[i]\r\n              }\r\n          })\r\n      }\r\n  }\r\n  return colls\r\n}\r\n\r\n// 执行数据转换代码\r\nexport async function evalDataConvert(featureCollection: any, code: string, map: Map, mapApp: any) {\r\n  // 如果是数组，则统一为geojson\r\n  if (Array.isArray(featureCollection)) {\r\n    featureCollection = convertArrayToGeoJson(featureCollection)\r\n  }\r\n  // 通过新的方法创建异步函数\r\n  const AsyncFunction = Object.getPrototypeOf(async function(){}).constructor;\r\n  // 使用\r\n  const asyncFunc = new AsyncFunction(\"data\", \"vjmap\", \"map\", \"mapApp\", \"utils\", code);\r\n  const utils = {\r\n    ProcessDataToFeatureCollection,\r\n    convertArrayToGeoJson\r\n  }\r\n  let result = await asyncFunc(featureCollection, vjmap, map, mapApp, utils);\r\n  return result;\r\n}\r\n","import scatterDot from \"./scatterDot\";\r\nimport pulsingDot from \"./pulsingDot\"\r\nexport default {\r\n    \"scatterDot\": scatterDot, // 扩散的点\r\n    \"pulsingDot\": pulsingDot \r\n} as Record<string, any>","import { Map } from 'vjmap';\r\nexport default (map: Map, options: {\r\n    size?: number\r\n    duration?: number\r\n    rgb?: [number, number, number]\r\n} = {}) => {\r\n    const size = options.size ?? 100;\r\n    const scatterDot = {\r\n        width: size,\r\n        height: size,\r\n        data: new Uint8Array(size * size * 4),\r\n        //将图层添加到地图时获取地图画布的渲染上下文\r\n        onAdd: function () {\r\n            let canvas = document.createElement('canvas');\r\n            canvas.width = this.width;\r\n            canvas.height = this.height;\r\n            // @ts-ignore\r\n            this.context = canvas.getContext('2d');\r\n        },\r\n    \r\n        // 在将使用图标的每一帧之前调用一次\r\n        render: function () {\r\n            const duration = options.duration ?? 1500;\r\n            const colorList = options.rgb ?? [0,150,0];\r\n            let t = (performance.now() % duration) / duration;\r\n    \r\n            let radius = (size / 2) * 0.3;\r\n            let outerRadius = (size / 2) * 0.7 * t + radius;\r\n            // @ts-ignore\r\n            let context = this.context;\r\n            context.clearRect(0, 0, this.width, this.height);\r\n            context.beginPath();\r\n            context.arc(\r\n                this.width / 2,\r\n                this.height / 2,\r\n                outerRadius,\r\n                0,\r\n                Math.PI * 2\r\n            );\r\n            context.fillStyle = 'rgba(' + colorList[0] + ',' + colorList[1] + ',' + colorList[2] + ',' + (1 - t) + ' )';\r\n            context.fill();\r\n    \r\n            // draw inner circle\r\n            context.beginPath();\r\n            context.arc(\r\n                this.width / 2,\r\n                this.height / 2,\r\n                radius,\r\n                0,\r\n                Math.PI * 2\r\n            );\r\n            this.data = context.getImageData(\r\n                0,\r\n                0,\r\n                this.width,\r\n                this.height\r\n            ).data;\r\n    \r\n            // 不断地重绘地图，导致圆点的平滑动画\r\n            map.triggerRepaint();\r\n    \r\n            // 返回 `true` 让地图知道图像已更新\r\n            return true;\r\n    \r\n        }\r\n    };\r\n    return scatterDot;\r\n}\r\n\r\n","import { Map } from 'vjmap';\r\nexport default (map: Map, options: {\r\n    size?: number\r\n    duration?: number\r\n    outFillRgb?: [number, number, number],\r\n    innerFillRgb?: [number, number, number],\r\n    innerStrokeStyle?: string,\r\n    innerRadiusRatio?: number\r\n    outerRadiusRatio?: number\r\n    innerLineWidth?: number\r\n} = {}) => {\r\n    const size = options.size ?? 100;\r\n    const pulsingDot = {\r\n        width: size,\r\n        height: size,\r\n        data: new Uint8Array(size * size * 4),\r\n    \r\n        // 将图层添加到地图时获取地图画布的渲染上下文\r\n        onAdd: function() {\r\n            const canvas = document.createElement('canvas');\r\n            canvas.width = this.width;\r\n            canvas.height = this.height;\r\n            // @ts-ignore\r\n            this.context = canvas.getContext('2d');\r\n        },\r\n    \r\n        // 在将使用图标的每一帧之前调用一次\r\n        render: function() {\r\n            const duration = options.duration ?? 1000;\r\n            const t = (performance.now() % duration) / duration;\r\n            const outFillRgb = options.outFillRgb ?? [255, 200, 200];\r\n            const innerFillRgb = options.innerFillRgb ?? [255, 100, 100];\r\n            const radius = (size / 2) * (options.innerRadiusRatio ?? 0.3);\r\n            const outerRadius = (size / 2) * (options.outerRadiusRatio ?? 0.7) * t + radius;\r\n            // @ts-ignore\r\n            const context = this.context;\r\n    \r\n            // draw outer circle\r\n            context.clearRect(0, 0, this.width, this.height);\r\n            context.beginPath();\r\n            context.arc(\r\n                this.width / 2,\r\n                this.height / 2,\r\n                outerRadius,\r\n                0,\r\n                Math.PI * 2\r\n            );\r\n            context.fillStyle = 'rgba(' + outFillRgb[0] + ',' + outFillRgb[1] + ',' + outFillRgb[2] + ',' + (1 - t) + ' )';\r\n            context.fill();\r\n    \r\n            // draw inner circle\r\n            context.beginPath();\r\n            context.arc(\r\n                this.width / 2,\r\n                this.height / 2,\r\n                radius,\r\n                0,\r\n                Math.PI * 2\r\n            );\r\n            context.fillStyle = 'rgba(' + innerFillRgb[0] + ',' + innerFillRgb[1] + ',' + innerFillRgb[2] + ',1)';\r\n            context.strokeStyle = options.innerStrokeStyle ?? 'white';\r\n            context.lineWidth = 2 + (options.innerLineWidth ?? 4) * (1 - t);\r\n            context.fill();\r\n            context.stroke();\r\n    \r\n            // 使用画布中的数据更新此图像的数据\r\n            this.data = context.getImageData(\r\n                0,\r\n                0,\r\n                this.width,\r\n                this.height\r\n            ).data;\r\n    \r\n            // 不断地重绘地图，导致圆点的平滑动画\r\n            map.triggerRepaint();\r\n    \r\n            // 返回 `true` 让地图知道图像已更新\r\n            return true;\r\n        }\r\n    };\r\n    return pulsingDot;\r\n}\r\n\r\n","import { MapAppConfig } from '../types'\r\nimport vjmap, { Map } from 'vjmap'\r\nimport { getShardsTileUrl } from '../utils'\r\n// osm地图数据提供 (WGS84坐标)\r\nexport const osmProviderTiles = () => {\r\n    return  [\"https://c.tile.openstreetmap.org/{z}/{x}/{y}.png\"]\r\n}\r\n\r\n//  天地图地图数据提供 (WGS84坐标)\r\nexport const tiandituProviderTiles = (isImageUrl?: boolean /* 是否为影像地址 */) => {\r\n    // 请用自己的token，这里用几个测试的token\r\n    const tokens = [\r\n        \"85c9d12d5d691d168ba5cb6ecaa749eb\",\r\n        \"583e63953a6ed6bf304e68120db4c512\",\r\n        \"93d1fdef41f93d2211deed6d22780c48\",\r\n        \"7e2ced6843b376a14f69a9f5885d3d2d\",\r\n        \"44964a97c8c44e4d04efdf3cba594467\",\r\n        \"57f1b8146ef867f14189f3f4bb1adc1c\"\r\n    ];\r\n    const tk = tokens[vjmap.randInt(0, tokens.length - 1)]\r\n    return [\r\n        !isImageUrl ? \"https://t{0-7}.tianditu.gov.cn/DataServer?T=vec_w&X={x}&Y={y}&L={z}&tk=\" + tk :\r\n        \"https://t{0-7}.tianditu.gov.cn/DataServer?T=img_w&X={x}&Y={y}&L={z}&tk=\" + tk,\r\n        \"https://t{0-7}.tianditu.gov.cn/DataServer?T=cva_w&X={x}&Y={y}&L={z}&tk=\" + tk\r\n    ];\r\n}\r\n\r\n// 高德地图数据提供 (GCJ02火星坐标)\r\nexport const gaodeProviderTiles = (isImageUrl?: boolean /* 是否为影像地址 */) => {\r\n    return !isImageUrl ? [\r\n        \"https://webrd0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}\"\r\n    ] : [\r\n        \"https://webst0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=6&x={x}&y={y}&z={z}\",\r\n        \"https://webst0{1-4}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}\"\r\n    ]\r\n}\r\n\r\nexport const loadWebMap = (map: Map, config: MapAppConfig) => {\r\n    let webMapTiles = config.webMapTiles;\r\n    if (!webMapTiles) {\r\n        // 如果没有，则用默认的\r\n        if (config.baseMapType == \"WGS84\") {\r\n            webMapTiles = tiandituProviderTiles();\r\n        } else if (config.baseMapType == \"GCJ02\") {\r\n            webMapTiles = gaodeProviderTiles();\r\n        }\r\n    }\r\n    if (!webMapTiles) return;\r\n    for(let t = 0; t < webMapTiles.length; t++) {\r\n        const sourceId = `${config.baseMapType}_base_webmap_source_${t}`;\r\n        map.addRasterSource(sourceId, {\r\n            type: \"raster\",\r\n            tiles: getShardsTileUrl(webMapTiles[t], map)\r\n        })\r\n        const layerId = `${config.baseMapType}_base_webmap_layer_${t}`;\r\n        map.addRasterLayer(layerId, sourceId, {});\r\n    }\r\n    \r\n}\r\n","export const locale = {\r\n    'FullscreenControl.Enter': '进入全屏',\r\n    'FullscreenControl.Exit': '退出全屏',\r\n    'NavigationControl.ZoomIn': '放大',\r\n    'NavigationControl.ZoomOut': '缩小',\r\n    'NavigationControl.ResetBearing': '方位角复位',\r\n    'ScaleControl.Meters': '', // 如果制图单位不是米，请修改。如制图单位是毫米，可改成毫米，如果没有制图单位，可为空\r\n    'ScaleControl.Kilometers': 'K',// 如果制图单位不是米，请修改。如制图单位是毫米，可改成米，如果没有制图单位，可写为k\r\n}","import { getTileShards, isWebBaseMap } from \"../utils\";\r\nimport { GeoBounds, IMapStyleParam, Service } from \"vjmap\";\r\nimport vjmap from \"vjmap\";\r\n\r\n// wms叠加地图的方式 \r\nexport enum WmsOverlayMapType {\r\n    /** 不叠加. */\r\n    None = \"none\",\r\n    /** 直接叠加. */\r\n    Direct = \"direct\",\r\n    /** 自动叠加 */\r\n    Auto = \"auto\",\r\n    /** 四参数叠加 */\r\n    Param = \"param\"\r\n}\r\n\r\n\r\n// wms地图底图参数\r\nexport interface WmsBaseMapParam {\r\n    // 底图类型\r\n    baseMapType?: \"\" | \"CAD\" | \"WGS84\" | \"GCJ02\"/*| \"BD09\"*/; // 底图为cad，或者为互联网地图的wgs84坐标（如osm、天地图)、或火星坐标如GCJ02(高德)。为空时默认为CAD图做为底图\r\n    /** 地图ID. */\r\n    mapid?: string;\r\n    /** 地图版本. */\r\n    version?: string;\r\n    /** 地理真实范围 */\r\n    mapbounds?: string;\r\n}\r\n\r\n// wms需要叠加的地图参数\r\nexport interface WmsMapParam {\r\n    /** 地图ID(为空时采用当前打开的mapid) */\r\n    mapid: string;\r\n    /** 地图版本(为空时采用当前打开的地图版本). */\r\n    version?: string;\r\n    /** 图层样式名称. (如果图层样式名称为空时，则根据下面的样式去获取图层样式名称) */\r\n    layer?: string;\r\n    /** 图层样式. */\r\n    style?: IMapStyleParam;\r\n    /** cad图的坐标系 */\r\n    crs?: string;\r\n    /** 四参数(x偏移,y偏移,缩放，旋转弧度)*/\r\n    fourParameterX?: number;\r\n    fourParameterY?: number;\r\n    fourParameterScale?: number;\r\n    fourParameterRotate?: number;\r\n    // 底图类型\r\n    baseMapType?: \"\" | \"CAD\" | \"WGS84\" | \"GCJ02\"/*| \"BD09\"*/; // 底图为cad，或者为互联网地图的wgs84坐标（如osm、天地图)、或火星坐标如GCJ02(高德)。为空时默认为CAD图做为底图\r\n    // 底图为互联网地图时，数据瓦片地址\r\n    webMapTiles?: string[];\r\n    isSetRotateZero?: boolean; // 公共点叠加时是否允许旋转\r\n    coordinates?: {x1: number;y1: number;x2: number;y2: number;}[] // 公共点坐标 x1,y1底图坐标, x2,y2对应点坐标\r\n}\r\n\r\nexport interface OverMapParam {\r\n    maps: WmsMapParam | WmsMapParam[],\r\n    layerProps: Record<string, any>\r\n}\r\n\r\n\r\nexport const createMapStyleLayerName = async (svc: Service, overMapType: WmsOverlayMapType, overMapParam: WmsMapParam | WmsMapParam[], backcolor?: number) => {\r\n    if (!Array.isArray(overMapParam)) {\r\n        if (!overMapParam.mapid) return\r\n        if (!overMapParam.layer) {\r\n            if (!overMapParam.style) {\r\n                overMapParam.style = {\r\n                    backcolor: backcolor ?? 0\r\n                }\r\n            }\r\n            let res = await svc.createStyle(overMapParam.style, overMapParam.mapid, overMapParam.version);\r\n            overMapParam.layer = res.stylename;\r\n        }\r\n    } else {\r\n        for await (let item of overMapParam) {\r\n            if (!item.layer) {\r\n                if (!item.style) {\r\n                    item.style = {\r\n                        backcolor: backcolor ?? 0\r\n                    }\r\n                }\r\n                if (item.mapid) {\r\n                    let res = await svc.createStyle(item.style, item.mapid, item.version);\r\n                    item.layer = res.stylename;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return overMapParam;\r\n}\r\n\r\n// 获取wms图层叠加后的在底图上面的范围\r\nexport const getWmsMapsBounds = async (svc: Service, overMapType: WmsOverlayMapType, baseMapType: \"\" | \"CAD\" | \"WGS84\" | \"GCJ02\"/*| \"BD09\"*/, overMapParam: WmsMapParam | WmsMapParam[]) => {\r\n    let bounds: vjmap.GeoBounds | undefined;\r\n    const getMapBounds = async (omp: WmsMapParam) => {\r\n        if (!omp.mapid) return\r\n        let metadata = await svc.metadata(omp.mapid, omp.version);\r\n        let mapbounds = vjmap.GeoBounds.fromString(metadata.bounds);\r\n        if (overMapType == WmsOverlayMapType.Auto) {\r\n            // 自动叠加\r\n            if (isWebBaseMap(baseMapType)) {\r\n                let fourParam =  omp.fourParameterX !== undefined ? [omp.fourParameterX ?? 0, omp.fourParameterY ?? 0, omp.fourParameterScale ?? 1, omp.fourParameterRotate ?? 0].join(\",\") : undefined\r\n                let points = mapbounds.toPointArray();\r\n                let b = new vjmap.GeoBounds();\r\n                for await(let p of points) {\r\n                    let pt = await cad2webCoordinate(svc, vjmap.geoPoint(p), omp.crs ?? '', fourParam, baseMapType == \"WGS84\" );\r\n                    b.update([vjmap.geoPoint(pt)]);\r\n                }\r\n                return b;\r\n            } else {\r\n                // cad为底图叠加互联网地图，不需限制wms范围\r\n                return\r\n            }\r\n        } else if(overMapType == WmsOverlayMapType.Param) {\r\n            // 参数叠加\r\n            if (isWebBaseMap(omp.baseMapType)) {\r\n                // 如果要叠加的是互联网地图\r\n                return\r\n            }\r\n            let points = mapbounds.toPointArray();\r\n            let b;\r\n            for (let p of points) {\r\n                if (omp.coordinates) {\r\n                    let pt = overlay2BaseCoordinate(vjmap.geoPoint(p), omp.coordinates, omp.isSetRotateZero, isWebBaseMap(baseMapType));\r\n                    if (!b) {\r\n                        b = new vjmap.GeoBounds();\r\n                    }\r\n                    b.update([vjmap.geoPoint(pt)]);\r\n                }\r\n            }\r\n            return b;\r\n        }\r\n        return mapbounds;\r\n    }\r\n    if (!Array.isArray(overMapParam)) {\r\n        let extent = await getMapBounds(overMapParam);\r\n        if (!extent) return;\r\n        if (!bounds) {\r\n            bounds = new vjmap.GeoBounds();\r\n        }\r\n        bounds.updateByBounds(extent);\r\n    } else {\r\n        for await (let item of overMapParam) {\r\n            let extent = await getMapBounds(item);\r\n            if (!extent) return;\r\n            if (!bounds) {\r\n                bounds = new vjmap.GeoBounds();\r\n            }\r\n            bounds.updateByBounds(extent);\r\n        }\r\n    }\r\n    return bounds;\r\n}\r\n\r\nconst getMapInfo = (overMapType: WmsOverlayMapType, baseMapParam: WmsBaseMapParam, overMapParam: WmsMapParam | WmsMapParam[]) => {\r\n    const getFourParam = (item: WmsMapParam) => {\r\n        if (overMapType == WmsOverlayMapType.Param) {\r\n            if (!item.coordinates || item.coordinates.length <= 1) return;\r\n            // 如果是公共点叠加，需要通过公共点计算四参数\r\n            if (isWebBaseMap(baseMapParam.baseMapType)) {\r\n                // 互联网为底图\r\n                let epsg3857Points = item.coordinates.map(w => vjmap.geoPoint(vjmap.Projection.lngLat2Mercator([w.x1, w.y1])));\r\n                let cadPoints = item.coordinates.map(w => vjmap.geoPoint([w.x2, w.y2]));\r\n                let param = vjmap.coordTransfromGetFourParamter(epsg3857Points, cadPoints, item.isSetRotateZero ?? false, true);\r\n                return [param.dx, param.dy, param.scale, param.rotate]\r\n            } else {\r\n                let basePoints = item.coordinates.map(w => vjmap.geoPoint([w.x1, w.y1]));\r\n                let cadPoints = item.coordinates.map(w => vjmap.geoPoint([w.x2, w.y2]));\r\n                let param = vjmap.coordTransfromGetFourParamter(basePoints, cadPoints, item.isSetRotateZero ?? false, true);\r\n                return [param.dx, param.dy, param.scale, param.rotate]\r\n            }\r\n        } else {\r\n            return item.fourParameterX !== undefined ? [item.fourParameterX ?? 0, item.fourParameterY ?? 0, item.fourParameterScale ?? 1, item.fourParameterRotate ?? 0] : undefined\r\n        }\r\n    }\r\n    if (!Array.isArray(overMapParam)) {\r\n        return {\r\n            mapid: overMapParam.mapid,\r\n            version: overMapParam.version,\r\n            layers: overMapParam.layer,\r\n            crs: overMapParam.crs,\r\n            fourParameter: getFourParam(overMapParam)\r\n        }\r\n    } else {\r\n        if (overMapParam.length == 1) {\r\n            return {\r\n                mapid: overMapParam[0].mapid,\r\n                version: overMapParam[0].version,\r\n                layers: overMapParam[0].layer,\r\n                crs: overMapParam[0].crs,\r\n                fourParameter: getFourParam(overMapParam[0])\r\n            }\r\n        } else {\r\n            let mapids = [], versions = [], layers = [], crss = [], fourParameters = [];\r\n            for(let i = 0; i < overMapParam.length; i++) {\r\n                mapids.push(overMapParam[i].mapid);\r\n                versions.push(overMapParam[i].version);\r\n                layers.push(overMapParam[i].layer);\r\n                crss.push(overMapParam[i].crs);\r\n                fourParameters.push( getFourParam(overMapParam[i]))\r\n            }\r\n            return {\r\n                mapid: mapids,\r\n                version: versions,\r\n                layers: layers,\r\n                crs: crss,\r\n                fourParameter: fourParameters\r\n            }\r\n        }\r\n    }\r\n}\r\n// 获取wms直接叠加瓦片地址\r\nexport const getWmsDirectTileUrl = async (svc: Service, overMapType: WmsOverlayMapType, baseMapParam: WmsBaseMapParam, overMapParam: WmsMapParam | WmsMapParam[], layerProps?: Record<string, any>) => {\r\n   await createMapStyleLayerName(svc, overMapType, overMapParam);\r\n   return svc.wmsTileUrl(\r\n    {\r\n        ...getMapInfo(overMapType, baseMapParam, overMapParam) as any,\r\n        mapbounds: baseMapParam.mapbounds,\r\n        ...layerProps\r\n    }\r\n   )\r\n}\r\n\r\n// 获取wms自动叠加瓦片地址(互联网为底图,CAD图进行叠加适配)\r\nexport const getWmsAutoWebBaseMapTileUrl = async (svc: Service,overMapType: WmsOverlayMapType, baseMapParam: WmsBaseMapParam, overMapParam: WmsMapParam | WmsMapParam[], layerProps?: Record<string, any>) => {\r\n    await createMapStyleLayerName(svc, overMapType, overMapParam);\r\n    const mapInfos =  vjmap.cloneDeep(getMapInfo(overMapType, baseMapParam, overMapParam)) as any;\r\n    if (mapInfos.fourParameter) {\r\n        // xy的偏移量应该是反算，所以得减去设置的值\r\n        if (Array.isArray(mapInfos.mapid)) {\r\n            for(let i  = 0; i < mapInfos.fourParameter.length; i++) {\r\n                if (typeof(mapInfos.fourParameter[i][0]) == \"number\") {\r\n                    mapInfos.fourParameter[i][0] = - mapInfos.fourParameter[i][0] ;\r\n                }\r\n                if (typeof(mapInfos.fourParameter[i][1]) == \"number\") {\r\n                    mapInfos.fourParameter[i][1] = - mapInfos.fourParameter[i][1] ;\r\n                }\r\n                mapInfos.fourParameter[i][0] = mapInfos.fourParameter[i][0]  || 0\r\n                mapInfos.fourParameter[i][1] = mapInfos.fourParameter[i][1]  || 0\r\n                mapInfos.fourParameter[i][2] = mapInfos.fourParameter[i][2]  || 1\r\n                mapInfos.fourParameter[i][3] = mapInfos.fourParameter[i][3]  || 0\r\n            }\r\n        } else {\r\n            if (typeof(mapInfos.fourParameter[0]) == \"number\") {\r\n                mapInfos.fourParameter[0] = - mapInfos.fourParameter[0] ;\r\n            }\r\n            if (typeof(mapInfos.fourParameter[1]) == \"number\") {\r\n                mapInfos.fourParameter[1] = - mapInfos.fourParameter[1] ;\r\n            }\r\n            mapInfos.fourParameter[0] = mapInfos.fourParameter[0]  || 0\r\n            mapInfos.fourParameter[1] = mapInfos.fourParameter[1]  || 0\r\n            mapInfos.fourParameter[2] = mapInfos.fourParameter[2]  || 1\r\n            mapInfos.fourParameter[3] = mapInfos.fourParameter[3]  || 0\r\n        }\r\n    }\r\n    return svc.wmsTileUrl(\r\n     {\r\n         ...mapInfos as any,\r\n         srs: \"EPSG:3857\", \r\n         webMapType: baseMapParam.baseMapType, // 底图类型\r\n         ...layerProps\r\n     }\r\n    )\r\n }\r\n\r\n \r\n// 获取wms自动叠加瓦片地址(CAD图为底图,互联网进行叠加适配)\r\nexport const getWmsAutoCadBaseMapTileUrl = async (svc: Service, baseMapParam: WmsBaseMapParam, overMapParam: WmsMapParam | WmsMapParam[], layerProps?: Record<string, any>) => {\r\n    let overMap: WmsMapParam | undefined;\r\n    if (Array.isArray(overMapParam)) {\r\n        overMap = overMapParam.find(o => isWebBaseMap(o.baseMapType));\r\n    } else {\r\n        overMap = overMapParam;\r\n    }\r\n    if (!overMap) return;\r\n    const tiles = overMap.webMapTiles?.map(t => getTileShards(t)) || [];\r\n    return svc.webMapUrl({\r\n        tileCrs: overMap.baseMapType == \"GCJ02\" ? \"gcj02\" : \"wgs84\",\r\n        tileUrl:  tiles?.map(t => t.tileUrl) ?? '',\r\n        tileSize: 256,\r\n        tileRetina: 1,\r\n        tileMaxZoom: 18,\r\n        tileShards: (tiles.length >= 0) ? tiles[0].tileShards : '',\r\n        tileToken: \"\",\r\n        tileFlipY: false,\r\n        mapbounds: baseMapParam.mapbounds,\r\n        srs: overMap.crs,\r\n        fourParameterBefore: overMap.fourParameterX !== undefined ? [overMap.fourParameterX ?? 0, overMap.fourParameterY ?? 0, overMap.fourParameterScale?? 1, overMap.fourParameterRotate ?? 0].join(\",\") : undefined\r\n    });\r\n }\r\n\r\n // 获取wms参数叠加瓦片地址\r\nexport const getWmsParamTileUrl = async (svc: Service, overMapType: WmsOverlayMapType, baseMapParam: WmsBaseMapParam, overMapParam: WmsMapParam | WmsMapParam[], layerProps?: Record<string, any>) => {\r\n    await createMapStyleLayerName(svc, overMapType, overMapParam);\r\n    let mapbounds;\r\n    if (!isWebBaseMap(baseMapParam.baseMapType) ) {\r\n        mapbounds = baseMapParam.mapbounds\r\n        if (mapbounds) {\r\n            mapbounds = mapbounds.replace(\"[\", \"\");\r\n            mapbounds = mapbounds.replace(\"]\", \"\");\r\n        }\r\n    }\r\n    return svc.wmsTileUrl(\r\n     {\r\n         ...getMapInfo(overMapType, baseMapParam, overMapParam) as any,\r\n         mapbounds: mapbounds,\r\n         ...layerProps\r\n     }\r\n    )\r\n }\r\n\r\n// 获取wms瓦片地址\r\nexport const getWmsTileUrl = async (svc: Service, baseMapParam: WmsBaseMapParam, overMapType: WmsOverlayMapType, overMapParam: OverMapParam) => {\r\n    let tileUrl;\r\n    if (overMapType == WmsOverlayMapType.Direct) {\r\n        // 直接叠加\r\n        tileUrl = await getWmsDirectTileUrl(svc, overMapType, baseMapParam, overMapParam.maps, overMapParam.layerProps);\r\n    } else if (overMapType == WmsOverlayMapType.Auto) {\r\n        // 自动叠加\r\n        if (isWebBaseMap(baseMapParam.baseMapType)) {\r\n            tileUrl = await getWmsAutoWebBaseMapTileUrl(svc, overMapType, baseMapParam, overMapParam.maps, overMapParam.layerProps);\r\n        } else {\r\n            tileUrl = await getWmsAutoCadBaseMapTileUrl(svc, baseMapParam, overMapParam.maps, overMapParam.layerProps);\r\n        }\r\n    }  else if (overMapType == WmsOverlayMapType.Param) {\r\n        tileUrl = await getWmsParamTileUrl(svc, overMapType, baseMapParam, overMapParam.maps, overMapParam.layerProps);\r\n    }\r\n    if (!tileUrl) return;\r\n    return [tileUrl]\r\n}\r\n\r\n\r\n// cad转web坐标，isWgs84是否为wgs84 4326坐标，如天地图；否的话为gcj02火星坐标,如高德地图  crs为epsg代号 fourParameter \"x,y,scale,rotate\"\r\nexport const cad2webCoordinate = async (svc: vjmap.Service, pt: vjmap.GeoPoint, crs: string, fourParameterStr?: string, isWgs84?: boolean) => {\r\n    if (fourParameterStr) {\r\n        let fourParameter = fourParameterStr.split(\",\");\r\n        pt = vjmap.coordTransfromByFourParamter(pt, {\r\n            dx: +fourParameter[0],\r\n            dy: +fourParameter[1],\r\n            scale: +fourParameter[2],\r\n            rotate: +fourParameter[3]\r\n        })\r\n    }\r\n    // 通过坐标转换把4527转成wgs84 4326坐标\r\n    let res = await svc.cmdTransform(crs, \"EPSG:4326\",pt); // 如果不想调服务转，也可以在前端用proj4库\r\n    // 如果为火星坐标，还需要从4326转火星\r\n    let webPt = res[0];// 返回的第1条结果\r\n    if (isWgs84 === false) {\r\n        webPt = vjmap.transform.convert(webPt, vjmap.transform.CRSTypes.EPSG4326, vjmap.transform.CRSTypes.AMap)\r\n    }\r\n    return webPt;\r\n}\r\n\r\n// web转cad坐标，isWgs84是否为wgs84 4326坐标，如天地图；否的话为gcj02火星坐标,如高德地图 crs为epsg代号 fourParameter \"x,y,scale,rotate\"\r\nexport const web2cadCoordinate = async (svc: vjmap.Service, pt: vjmap.GeoPoint, crs: string, fourParameterStr?: string, isWgs84?: boolean) => {\r\n    // (上面计算过程的逆过程), 如果为火星坐标，还需要从火星转4326，再通过坐标转换把wgs84 4326转成4527坐标, 4527坐标先通过四参数，得到cad坐标\r\n    if (isWgs84 === false) {\r\n        pt = vjmap.transform.convert(pt, vjmap.transform.CRSTypes.AMap, vjmap.transform.CRSTypes.EPSG4326);\r\n    }\r\n    // 通过坐标转换把4527转成wgs84 4326坐标\r\n    let res = await svc.cmdTransform(\"EPSG:4326\",crs,vjmap.geoPoint(pt)); // 如果不想调服务转，也可以在前端用proj4库\r\n    let cadPt = res[0];// 返回的第1条结果\r\n   \r\n    if (fourParameterStr) {\r\n        // 四参数反算\r\n        let fourParameter = fourParameterStr.split(\",\");\r\n        cadPt = vjmap.coordTransfromByFourParamter(vjmap.geoPoint(cadPt), {\r\n            dx: +fourParameter[0],\r\n            dy: +fourParameter[1],\r\n            scale: +fourParameter[2],\r\n            rotate: +fourParameter[3]\r\n        })\r\n    }\r\n    return vjmap.geoPoint(cadPt).toArray()\r\n}\r\n\r\n// 四参数中坐标转换-叠加点转底图点\r\nexport const overlay2BaseCoordinate =  (pt: vjmap.GeoPoint,\r\n    coordinates: {x1: number /* 底图公共点x*/;y1: number/* 底图公共点y*/;x2: number /* 叠加公共点x*/;y2: number;/* 叠加公共点x*/}[], \r\n    isSetRotateZero?: boolean/* 是否允许旋转*/, basemapIsWeb?: boolean /* 底图是否为互联网地图*/) => {\r\n    let basePoints;\r\n    if (basemapIsWeb) {\r\n        basePoints = coordinates.map(w => vjmap.geoPoint(vjmap.Projection.lngLat2Mercator([w.x1, w.y1])));\r\n    } else {\r\n        basePoints = coordinates.map(w => vjmap.geoPoint([w.x1, w.y1]));\r\n    }\r\n    let cadPoints = coordinates.map(w => vjmap.geoPoint([w.x2, w.y2]));\r\n    if (basePoints.length == 0 || cadPoints.length == 0) return vjmap.geoPoint(pt)\r\n    let param = vjmap.coordTransfromGetFourParamter(cadPoints, basePoints, isSetRotateZero ?? false, true);\r\n    let co = vjmap.coordTransfromByFourParamter(pt, param);\r\n    if (basemapIsWeb) {\r\n        co = vjmap.geoPoint(vjmap.Projection.mercator2LngLat(co));\r\n    }\r\n    return co;\r\n}\r\n\r\n// 四参数中坐标转换-底图点转叠加点\r\nexport const base2OverlayCoordinate =  (pt: vjmap.GeoPoint,\r\n    coordinates: {x1: number /* 底图公共点x*/;y1: number/* 底图公共点y*/;x2: number /* 叠加公共点x*/;y2: number;/* 叠加公共点x*/}[], \r\n    isSetRotateZero?: boolean/* 是否允许旋转*/, basemapIsWeb?: boolean /* 底图是否为互联网地图*/) => {\r\n    let basePoints;\r\n    if (basemapIsWeb) {\r\n        basePoints = coordinates.map(w => vjmap.geoPoint(vjmap.Projection.lngLat2Mercator([w.x1, w.y1])));\r\n    } else {\r\n        basePoints = coordinates.map(w => vjmap.geoPoint([w.x1, w.y1]));\r\n    }\r\n    let cadPoints = coordinates.map(w => vjmap.geoPoint([w.x2, w.y2]));\r\n    if (basePoints.length == 0 || cadPoints.length == 0) return vjmap.geoPoint(pt)\r\n    let param = vjmap.coordTransfromGetFourParamter(basePoints, cadPoints, isSetRotateZero ?? false, true);\r\n    if (basemapIsWeb) {\r\n        pt = vjmap.geoPoint(vjmap.Projection.lngLat2Mercator(pt));\r\n    }\r\n    return vjmap.coordTransfromByFourParamter(pt, param);\r\n}\r\n\r\n// 获取EPSG范围(北京54三度带、北京54六度带、西安80三度带、西安80六度带、2000三度带、2000六度带)\r\nexport const getEpsgRange = (type: \"BEIJING54_3\" | \"BEIJING54_6\" | \"XIAN80_3\" | \"XIAN80_6\" | \"CGCS2000_3\" | \"CGCS2000_6\")=>  {\r\n    let epsgs: any = [];\r\n    let begin = 0;\r\n    let end = 0;\r\n    if (type == \"BEIJING54_3\") {\r\n        begin = 2401;\r\n        end = 2442;\r\n    } else if (type == \"BEIJING54_6\") {\r\n        begin = 21413;\r\n        end = 21483;\r\n    } else if (type == \"XIAN80_3\") {\r\n        begin = 2327;\r\n        end = 2348;\r\n    } else if (type == \"XIAN80_6\") {\r\n        begin = 2349;\r\n        end = 2390;\r\n    } else if (type == \"CGCS2000_3\") {\r\n        begin = 4513;\r\n        end = 4554;\r\n    } else if (type == \"CGCS2000_6\") {\r\n        begin = 4491;\r\n        end = 4512;\r\n    }\r\n    for(let i = begin; i <= end; i++) {\r\n        epsgs.push(`EPSG:${i}`)\r\n    }\r\n    return epsgs\r\n}","\r\n// 获取当前的按键状态，是否按下了Ctrl、Alt或Shift键\r\nexport const listenKeyEvent = () => {\r\n    let curEvent: KeyboardEvent | undefined;\r\n    const keyDownEvent = (event: KeyboardEvent) => {\r\n        curEvent = event;\r\n    }\r\n    // 监听键盘按下事件\r\n    document.addEventListener(\"keydown\", keyDownEvent);\r\n    \r\n    const keyupEvent = (event: KeyboardEvent) => {\r\n        curEvent = undefined\r\n    }\r\n    // 监听键盘抬起事件\r\n    document.addEventListener(\"keyup\", keyupEvent);\r\n\r\n    const removeEventListener = () => {\r\n        document.removeEventListener(\"keydown\", keyDownEvent);\r\n        document.removeEventListener(\"keyup\", keyupEvent);\r\n    }\r\n\r\n    const isAltKey = () => {\r\n        return curEvent?.altKey\r\n    }\r\n    const isCtrlKey = () => {\r\n        return curEvent?.ctrlKey\r\n    }\r\n    const isShiftKey = () => {\r\n        return curEvent?.shiftKey\r\n    }\r\n    const curKey = () => {\r\n        return curEvent;\r\n    }\r\n    return {\r\n        removeEventListener,\r\n        isAltKey,\r\n        isCtrlKey,\r\n        isShiftKey,\r\n        curKey\r\n    }\r\n}","import vjmap, { Service, Map, MapOptions, Control, IControl, LngLatBounds } from \"vjmap\";\nimport { MapAppConfig, MapLayer, MapOpenOptions, MapOption, MapSource } from \"./types\";\nimport { providerLayers } from \"./layers\";\nimport { execProgram, getShardsTileUrl, toMapLayer } from \"./utils\";\nimport { requestChangeData, queryMapData } from \"./map/query\";\nimport sysImages from \"./sysImages\";\nimport { loadWebMap } from \"./web/provider\";\nimport { locale } from \"./map/setting\"\nimport LayerBase from \"./layers/base\";\nimport { getWmsMapsBounds, getWmsTileUrl } from \"./map/wms\";\nimport { listenKeyEvent } from \"./map/keyboard\";\n// 地图应用类\nexport class MapApp {\n  public config!: MapAppConfig;\n  public svc!: Service;\n  public map!: Map;\n  public sources!: MapSource[];\n  public layers!: MapLayer[];\n  public controls!: (Control | IControl | null)[];\n  public layersInst!: Record<string, LayerBase>;\n  public projectKey: string | undefined;\n  public containerId!: string;\n  private timeMgr: Record<string, any>; // 定时器管理\n  public isEditorMode?: boolean; // 是否为编辑模式\n  public isDisableRunProgram?: boolean; // 是否不运行自定义的程序代码\n  public context?: any; // 上下文环境\n  private programCleaner?: Function[]; //函数清理回调\n  private oldCacheImages?: Record<string, any>;\n  public keyEvent?: ReturnType<typeof listenKeyEvent>; // 键盘事件\n  constructor(config?: MapAppConfig) {\n    this.config = config || {};\n    this.sources = [];\n    this.layers = [];\n    this.layersInst = {};\n    this.timeMgr = {};\n    this.config.mapSources = [];\n    this.config.mapLayers = [];\n  }\n\n  public mount(\n    containerId: string,\n    env?: { serviceUrl: string; serviceToken: string }\n  ) {\n    if (this.svc) return; // 如果已经挂载过\n    if (!this.keyEvent) this.keyEvent = listenKeyEvent();\n    this.containerId = containerId;\n    if (this.config?.backgroundColor) {\n      const element = document.getElementById(containerId);\n      if (element) element.style.backgroundColor = this.config?.backgroundColor;\n    }\n    this.svc = new vjmap.Service(\n      this.config.serviceUrl ?? env?.serviceUrl ?? \"\",\n      this.config.serviceToken ?? env?.serviceToken ?? \"\"\n    );\n\n    if (this.config.workspace) {\n      this.svc.switchWorkspace(this.config.workspace);\n    }\n    if (this.config.accessKey) {\n      this.config.accessKey\n        .split(\";\")\n        .map((key: string) => this.svc.addAccessKey(key));\n    }\n    const mapBounds = this.config.mapInitBounds ?? \"[-10000,-10000,10000,10000]\";\n    const mapExtent = vjmap.GeoBounds.fromString(mapBounds);\n    // 建立坐标系\n    const prj = new vjmap.GeoProjection(mapExtent);\n    // 新建地图对象\n    this.map = new vjmap.Map({\n      container: containerId, // container ID\n      style: {\n        version: this.svc.styleVersion(),\n        glyphs: this.svc.glyphsUrl(),\n        sources: {},\n        layers: [],\n      },\n      center: prj.toLngLat(mapExtent.center()), // 中心点\n      zoom: 2,\n      renderWorldCopies: false,\n      preserveDrawingBuffer: this.isEditorMode ? true : undefined, // 保存地图截图需要设置参数。非编辑模式不要设置此参数，会影响绘制性能\n      doubleClickZoom: false,\n      locale, \n      ...this.config.mapOptions,\n    });\n    // 地图关联服务对象和坐标系\n    this.map.attach(this.svc, prj);\n  }\n\n  // 关联一个已有的地图对象\n  public attachMap(map: Map) {\n    this.map = map;\n    this.svc = this.map.getService();\n    if (!this.keyEvent) this.keyEvent = listenKeyEvent();\n  }\n\n  // 底图是否为互联网底图\n  public isWebBaseMap(config?: MapAppConfig) {\n    let cfg = config ?? this.config ?? {};\n    return !(cfg.baseMapType == \"\" || cfg.baseMapType == \"CAD\" || cfg.baseMapType === undefined)\n  }\n\n  // 设置配置\n  public async setConfig(config?: MapAppConfig, noSetMapOptions?: boolean /* 是否不设置地图选项，如果不想让地图位置设置后回到初始位置，可设置为true */) {\n    // if (this.config && config) return; // 如果配置构造函数里面传过\n    if (!config) {\n      config = vjmap.cloneDeep(this.config); //先备份所有数据\n    }\n    if (!this.map) return;\n    // 清空之前的所有数据\n    await this.map.onLoad();\n    this.clearData();\n    if (config) {\n      this.config = config;\n    }\n    if (this.config?.backgroundColor) {\n      const element = this.map.getContainer();\n      if (element) element.style.backgroundColor = this.config?.backgroundColor;\n    }\n    const mapSources = [...(config?.mapSources ?? [])];\n    const mapLayers = [...(config?.mapLayers ?? [])];\n    this.svc = new vjmap.Service(\n      this.config.serviceUrl ?? this.svc?.serverUrl ?? \"\",\n      this.config.serviceToken ?? this.svc?.accessToken ?? \"\"\n    );\n    if (!this.isWebBaseMap()) {\n      if (!this.config.mapOpenOptions?.mapid) {\n        // 用默认打开时地图初始范围\n        if (this.config.mapInitBounds) {\n          const mapBounds = this.config.mapInitBounds;\n          const mapExtent = vjmap.GeoBounds.fromString(mapBounds);\n          const prj = new vjmap.GeoProjection(mapExtent);\n          this.map.setMapProjection(prj);\n        }\n      } \n      this.map.attach(this.svc, this.map.getMapProjection());\n    } else {\n      // 建立互联网的经纬度投影坐标系\n      let prj = new vjmap.LnglatProjection();\n      this.map.attach(this.svc, prj);\n      loadWebMap(this.map, this.config);\n    }\n    if (this.config.workspace) {\n      this.svc.switchWorkspace(this.config.workspace);\n    }\n\n    if (this.config.accessKey) {\n      this.config.accessKey\n        .split(\";\")\n        .map((key: string) => this.svc.addAccessKey(key));\n    }\n\n    if (!this.isWebBaseMap()) {\n      // 如果是以cad图为底图\n      // @ts-ignore\n      this.config.mapOpenOptions = this.config.mapOpenOptions || {};\n      if (!this.config.mapOpenOptions?.style) {\n        // @ts-ignore\n        this.config.mapOpenOptions.style = vjmap.openMapDarkStyle(); // 如果没有设置样式，则默认为暗黑样式\n      }\n      if (this.config.mapOpenOptions?.mapid) {\n        // 如果有地图id\n        const res = await this.switchMap(this.config.mapOpenOptions);\n        if (res?.error) {\n          return {\n            error: res.error,\n          };\n        }\n      }\n    }\n    if (!noSetMapOptions) {\n      this.setMapOptions(this.config.mapOptions ?? {});\n    }\n    await this.map.onLoad(true);\n    await this.addMapImages();\n    let addSourcesNoDeps: any = [];\n    let addSourcesDeps: any = [];\n    // 没数据依赖的数据源放前面\n    mapSources\n      .filter(\n        (s) => !(s.tag == \"change\" && s.change && s.change.reqType == \"SOURCE\")\n      )\n      .forEach((source) => addSourcesNoDeps.push(this.addSource(source, true)));\n    await Promise.all(addSourcesNoDeps);\n    // 有数据依赖的数据源放后面\n    mapSources\n      .filter(\n        (s) => s.tag == \"change\" && s.change && s.change.reqType == \"SOURCE\"\n      )\n      .forEach((source) => addSourcesDeps.push(this.addSource(source, true)));\n    await Promise.all(addSourcesDeps);\n    for (let layer of mapLayers) {\n      await this.addLayer(layer, true);\n    }\n    this.addControls();\n    await this.execProgram();\n  }\n\n  // 设置地图打开参数\n  public async setMapOpenOptions(option: Partial<MapOpenOptions>) {\n    // @ts-ignore\n    this.config.mapOpenOptions = {\n      ...this.config.mapOpenOptions,\n      ...option,\n    };\n    await this.setConfig();\n  }\n\n  // 设置地图参数\n  public setMapOptions(option: MapOption) {\n    this.config.mapOptions = {\n      ...this.config.mapOptions,\n      ...option,\n    };\n    if (!this.map) return;\n    if (option.center) {\n      this.map.setCenter(option.center);\n    } else if (this.isWebBaseMap()) {\n      // 互联网地图，开始默认设置到中国\n      this.map.setCenter([116.3912, 39.9073]);\n    }\n    if (option.zoom !== undefined) {\n      this.map.setZoom(option.zoom);\n    } else if (this.isWebBaseMap()) {\n      // 互联网地图，开始默认设置到中国\n      this.map.setZoom(8);\n    }\n    if (option.bearing !== undefined) {\n      this.map.setBearing(option.bearing);\n    }\n    if (option.pitch !== undefined) {\n      this.map.setPitch(option.pitch);\n    }\n    if (option.dragRotate === false && this.map.dragRotate.isEnabled()) {\n      // 如果不允许旋转\n      this.map.dragRotate.disable();\n      this.map.touchZoomRotate.disableRotation();\n      // 如果不允许旋转时，禁止系统默认右键弹出\n      this.map.getCanvasContainer().oncontextmenu = (e) => {\n        e.preventDefault();\n      };\n    } else if (option.dragRotate && !this.map.dragRotate.isEnabled()) {\n      // 如果允许旋转\n      this.map.dragRotate.enable();\n      this.map.touchZoomRotate.enableRotation();\n      this.map.getCanvasContainer().oncontextmenu = () => {};\n    }\n    if (option.pitchWithRotate === false) {\n      // 如果不允许旋转\n      this.map.setMaxPitch(0);\n    } else {\n      this.map.setMaxPitch(85);\n    }\n  }\n\n  /**\n   * 增加地图图像资源\n   */\n  public async addMapImages() {\n    try {\n      if (!this.config.mapImages) return;\n      this.oldCacheImages = this.oldCacheImages || {};\n      let mapImages = [...this.config.mapImages];\n      mapImages = mapImages.filter((img) => img.key && img.value);\n      // 如果没有修改过，就不用再加了\n      mapImages = mapImages.filter((img) => {\n        const val = img.value + \"_\" + img.options ?? \"\";\n        // @ts-ignore\n        return this.oldCacheImages[img.key] != val;\n      });\n      // 先移除之前的图片资源\n      for (let img of mapImages) {\n        if (this.map.hasImage(img.key)) this.map.removeImage(img.key);\n      }\n      let loadImages: any = [];\n\n      for (let img of mapImages) {\n        let options;\n        this.oldCacheImages[img.key] = img.value + \"_\" + img.options ?? \"\";\n        if (typeof img.options == \"string\") {\n          try {\n            options = JSON.parse(img.options);\n          } catch (error) {\n            console.error(error);\n          }\n        }\n        let createSysImg = sysImages[img.value];\n        if (createSysImg) {\n          // 如果是系统图片资源\n          loadImages.push(\n            this.map.addImage(img.key, createSysImg(this.map, options), options)\n          );\n        } else {\n          loadImages.push(this.map.loadImageEx(img.key, img.value, options))\n        }\n      }\n      await Promise.all(loadImages);\n    } catch (error) {\n      console.error(error);\n    }\n  }\n\n  /**\n   * 清空地图上的所有数据\n   */\n  public async clearData() {\n    if (!this.map) return;\n    const { sources } = this.map.getStyle();\n    this.removePrograms();\n    for (const layerId in this.layersInst) {\n      const inst = this.layersInst[layerId];\n      if (inst) {\n        inst.removeLayer(this.map, layerId);\n      }\n    }\n    // eslint-disable-next-line no-restricted-syntax\n    for (const item in sources) {\n      this.map.removeSourceEx(item);\n    }\n    this.map.removeMarkers();\n    this.map.removePopups();\n    this.removeControls();\n    this.sources = [];\n    this.layers = [];\n    // @ts-ignore\n    this.layersInst = [];\n    this.config.mapSources = [];\n    this.config.mapLayers = [];\n    this.oldCacheImages = {};\n    for (let k in this.timeMgr) {\n      clearInterval(this.timeMgr[k]);\n    }\n    this.timeMgr = {};\n  }\n\n  /**\n   * 移除所有逻辑程序段\n   */\n  public removePrograms() {\n    if (this.programCleaner) {\n      for (let p of this.programCleaner) {\n        if (p) p();\n      }\n      this.programCleaner = [];\n    }\n  }\n\n  /**\n   * 移除所有逻辑程序段\n   */\n  public async execProgram() {\n    if (this.isDisableRunProgram) return;\n    this.removePrograms();\n    // 加载完成后，如果有代码逻辑，则执行\n    if (this.config.program && this.config.program.onMapLoaded) {\n      let cleaner = await execProgram(\n        this.config.program.onMapLoaded,\n        this.map,\n        this,\n        this.context\n      );\n      if (typeof cleaner == \"function\") {\n        this.programCleaner = this.programCleaner || [];\n        this.programCleaner.push(cleaner);\n      }\n    }\n  }\n  /**\n   * 销毁\n   */\n  public async destory() {\n    this.clearData();\n    if (this.map) {\n      this.map.remove();\n      // @ts-ignore\n      this.map = null;\n    }\n    if (this.keyEvent) this.keyEvent.removeEventListener();\n  }\n\n  /**\n   * 切换地图\n   * @param param 打开选项\n   */\n  public async switchMap(param: MapOpenOptions) {\n    this.config.mapOpenOptions = param;\n    // 如果有地图id\n    const res = await this.map.switchMap(\n      param,\n      param.isKeepOldLayers,\n      param.isVectorStyle,\n      param.isSetCenter,\n      param.isFitBounds\n    );\n    if (res?.error) {\n      return {\n        error: res.error,\n      };\n    }\n    return res;\n  }\n\n  /**\n   * 增加数据源\n   */\n  public async addSource(source: MapSource, isUpdateConfig?: boolean) {\n    const mapSource = vjmap.cloneDeep(source);\n    const idx = this.sources.findIndex((s) => s.id === mapSource.id);\n    if (idx >= 0) return false; // 如果已在\n    this.sources.push(vjmap.cloneDeep(mapSource));\n    if (isUpdateConfig) {\n      const index = this.config.mapSources?.findIndex(\n        (s) => s.id === mapSource.id\n      );\n      if (index == -1) {\n        this.config.mapSources?.push(vjmap.cloneDeep(mapSource));\n      }\n    }\n    if (mapSource.tag === \"query\") {\n      // 如果是数据查询\n      let data = await queryMapData(this.map, mapSource.query);\n      // @ts-ignore\n      mapSource.source.data = data;\n    } else if (mapSource.tag === \"change\") {\n      // 如果是动态数据\n      let data = await requestChangeData(this.map, mapSource.change, this);\n      // @ts-ignore\n      mapSource.source.data = data;\n      this.addTimer(mapSource);\n    }\n    if (mapSource.source.type === \"geojson\") {\n      // 如果是geojson，则需要把data转成lnglat\n      const source = vjmap.cloneDeep(mapSource.source);\n      source.data = this.map.toLngLat(source.data);\n      for (let k in mapSource.props) {\n        // @ts-ignore\n        source[k] = mapSource.props[k];\n      }\n      this.map.addSourceEx(mapSource.id, source);\n    } else {\n      await this.updateSource(mapSource);\n    }\n    return true;\n  }\n\n  /**\n   * 获取数据源数据\n   */\n  public async getSourceData(sourceId: string) {\n    const idx = this.sources.findIndex((s) => s.id === sourceId);\n    if (idx < 0) return; // 如果不存在\n    const mapSource = this.sources[idx];\n    if (mapSource.tag === \"query\") {\n      // 如果是数据查询\n      return await queryMapData(this.map, mapSource.query);\n    } else if (mapSource.tag === \"change\") {\n      // 如果是动态数据\n      return await requestChangeData(this.map, mapSource.change, this);\n    } else if (mapSource.source.type === \"geojson\") {\n      const source = vjmap.cloneDeep(mapSource.source);\n      return source.data;\n    }\n  }\n\n  /**\n   * 设置数据源数据\n   */\n  public async setSourceData(\n    sourceId: string,\n    data?: any,\n    isUpdateConfig?: boolean\n  ) {\n    const idx = this.sources.findIndex((s) => s.id === sourceId);\n    if (idx < 0) return; // 如果不存在\n    let index = -1;\n    if (isUpdateConfig) {\n      index = this.config.mapSources?.findIndex((s) => s.id === sourceId) ?? -1;\n    }\n    let isSetData = true;\n    if (this.sources[idx].tag === \"query\") {\n      // 如果是数据查询\n      this.sources[idx].query = data;\n      if (index >= 0 && this.config.mapSources) {\n        this.config.mapSources[index].query = vjmap.cloneDeep(data);\n      }\n      data = await queryMapData(this.map, this.sources[idx].query);\n    } else if (this.sources[idx].tag === \"change\") {\n      // 如果是动态查询\n      this.sources[idx].change = data;\n      if (index >= 0 && this.config.mapSources) {\n        this.config.mapSources[index].change = vjmap.cloneDeep(data);\n      }\n      data = await requestChangeData(this.map, this.sources[idx].change, this);\n      this.addTimer(this.sources[idx]);\n    } else {\n      if (this.sources[idx].source.type === \"geojson\") {\n        // @ts-ignore\n        this.sources[idx].source.data = data;\n        if (index >= 0 && this.config.mapSources) {\n          // @ts-ignore\n          this.config.mapSources[index].source.data = vjmap.cloneDeep(data);\n        }\n      } else {\n        if (this.sources[idx].tag === \"wms\") {\n          // 如果是wms\n          const sourceType = this.sources[idx].source.type;\n          this.sources[idx].wms = data.wms;\n          this.sources[idx].source = {\n            ...data.source,\n          };\n          if (sourceType) this.sources[idx].source.type = sourceType;\n          if (index >= 0 && this.config.mapSources) {\n            this.config.mapSources[index].wms = vjmap.cloneDeep(data.wms);\n            this.config.mapSources[index].source = {\n              type: this.sources[index].source.type,\n              ...data.source\n            }\n            if (sourceType) this.config.mapSources[index].source.type = sourceType;// type不让修改\n          }\n        } else {\n          const sourceType = this.sources[idx].source.type;\n          this.sources[idx].source = vjmap.cloneDeep(data);\n          if (sourceType) this.sources[idx].source.type = sourceType;\n          if (index >= 0 && this.config.mapSources) {\n            // @ts-ignore\n            this.config.mapSources[index].source = vjmap.cloneDeep(data);\n            if (sourceType) this.config.mapSources[index].source.type = sourceType;// type不让修改\n          }\n        }\n        await this.updateSource(this.sources[idx], true); // 更新数据源\n        isSetData = false;\n      }\n    }\n    if (isSetData) {\n      this.map.setData(sourceId, this.map.toLngLat(data));\n    }\n    await this.notifySourceDataChange(sourceId, !isSetData);\n  }\n\n  /**\n   * 更新除geojson之外的数据源\n   */\n  public async updateSource(source: MapSource, isRemove?: boolean) {\n    let mapSource = vjmap.cloneDeep(source);\n    if (isRemove) {\n      this.map.removeSourceEx(mapSource.id);\n    }\n    if (mapSource.source.type === \"raster\" || mapSource.source.type === \"vector\") {\n      if (mapSource.source.bounds) {\n        const p1 = this.map.toLngLat([mapSource.source.bounds[0], mapSource.source.bounds[1]]);\n        const p2 = this.map.toLngLat([mapSource.source.bounds[2], mapSource.source.bounds[3]]);\n        mapSource.source.bounds = [p1[0], p1[1], p2[0], p2[1]];\n      }\n      if (mapSource.tag == \"wms\") {\n        mapSource.source.tiles = await getWmsTileUrl(this.svc, \n          {\n            baseMapType: this.config.baseMapType,\n            mapid: this.config.mapOpenOptions?.mapid,\n            version: this.config.mapOpenOptions?.version,\n            mapbounds: this.map.getGeoBounds(1.0).toString()\n          },\n          mapSource.wms?.overlayType,\n          mapSource.wms?.param);\n          if (!mapSource.source.bounds) {\n            // 设置wms地图的范围，超过此范围了，就不会加载wms瓦片了\n            let wmsBounds = await getWmsMapsBounds(this.svc, mapSource.wms?.overlayType, this.config.baseMapType ?? '', mapSource.wms?.param?.maps)\n            if (wmsBounds) {\n            let bounds = this.map.toLngLat(wmsBounds).toArray();\n              mapSource.source.bounds = [bounds[0][0], bounds[0][1],bounds[1][0],bounds[1][1]];\n            }\n          }\n      }\n      if (!mapSource.source.tiles) {\n        mapSource.source.tiles = getShardsTileUrl(mapSource.source.tiles as any, this.map);\n      }\n      if (mapSource.source.type === \"raster\") {\n        this.map.addRasterSource(mapSource.id, mapSource.source);\n      } else {\n        this.map.addVectorSource(mapSource.id, mapSource.source, {}) ;\n      }\n    } else if (mapSource.source.type === \"image\" || mapSource.source.type === \"video\") {\n      if (mapSource.source.coordinates) {\n        mapSource.source.coordinates = this.map.toLngLat(mapSource.source.coordinates);\n      }\n      if (mapSource.source.type === \"image\") {\n        this.map.addImageSource(mapSource.id, mapSource.source);\n      } else {\n        this.map.addVideoSource(mapSource.id, mapSource.source) ;\n      }\n    } else {\n      this.map.addSourceEx(mapSource.id, mapSource.source);\n    }\n  }\n  /**\n   * 删除数据源\n   */\n  public removeSource(sourceId: string, isUpdateConfig?: boolean) {\n    // 先删除所有数据源相关的图层\n    for (let k = this.layers.length - 1; k >= 0; k--) {\n      if (this.layers[k].sourceId == sourceId) {\n        this.removeLayer(this.layers[k].layerId, true);\n      }\n    }\n    this.map.removeSourceEx(sourceId); // 删除数据源及相关图层\n    const idx = this.sources.findIndex((y) => y.id === sourceId);\n    if (idx >= 0) {\n      this.sources.splice(idx, 1);\n    }\n    if (isUpdateConfig) {\n      const index = this.config.mapSources?.findIndex((y) => y.id === sourceId);\n      if (index !== undefined && index >= 0) {\n        this.config.mapSources?.splice(index, 1);\n      }\n    }\n    this.clearTimer(sourceId);\n  }\n\n  /**\n   * 增加图层\n   */\n  public async addLayer(layer: MapLayer, isUpdateConfig?: boolean) {\n    const mapLayer = vjmap.cloneDeep(layer);\n    const idx = this.layers.findIndex((y) => y.layerId === mapLayer.layerId);\n    if (idx < 0) {\n      this.layers.push(vjmap.cloneDeep(mapLayer)); // 如果不存在\n    }\n    if (isUpdateConfig) {\n      const index = this.config.mapLayers?.findIndex(\n        (y) => y.layerId === mapLayer.layerId\n      );\n      if (index == -1) {\n        this.config.mapLayers?.push(vjmap.cloneDeep(mapLayer));\n      }\n    }\n    if (mapLayer.visibleOff || this.layersInst[mapLayer.layerId]) {\n      return; // 如果不可见或如果实例已存在\n    }\n\n    let layerClass = providerLayers[mapLayer.type];\n    if (!layerClass) {\n      console.error(`图层类型 ${mapLayer.type} 未注册`);\n    }\n    let layerInst = new layerClass();\n    await layerInst.addLayer(this.map, mapLayer);\n    this.layersInst[mapLayer.layerId] = layerInst; //把图层实例保存起来\n    // 如果图层是设置了置底，则把图层移动至最下面\n    if (layer.isLowest && layerInst.getLayerId()) {\n      // 把这个图层放至所有图层的最下面\n      let allStyleLayers = this.map.getStyle().layers;\n      let lyIds = layerInst.getLayerId() ?? [];\n      if (!Array.isArray(lyIds)) lyIds = [lyIds];//全转成数组格式\n      for(let k = 0; k < allStyleLayers.length - 1; k ++) {\n        if (allStyleLayers.findIndex(ly => ly.id == lyIds[k]) >= 0) {\n          this.map.moveLayer(lyIds[k], allStyleLayers[0].id);\n        }\n      }\n    }\n  }\n\n  /**\n   * 设置图层属性\n   */\n  public async setLayerStyle(\n    layerId: string,\n    layerProps: Record<string, any>,\n    isUpdateConfig?: boolean\n  ) {\n    const idx = this.layers.findIndex((y) => y.layerId === layerId);\n    if (idx < 0) return; // 如果不在\n    if (!this.layersInst[layerId]) {\n      // 如果之前没创建\n      this.layers[idx] = toMapLayer(this.layers[idx], layerProps);\n      await this.addLayer(this.layers[idx], isUpdateConfig);\n    } else {\n      this.layersInst[layerId].setLayerStyle(\n        this.map,\n        layerId,\n        layerProps,\n        this.layers[idx]\n      );\n      this.layers[idx] = toMapLayer(this.layers[idx], layerProps);\n    }\n    if (isUpdateConfig) {\n      const index = this.config.mapLayers?.findIndex(\n        (y) => y.layerId === layerId\n      );\n      if (index !== undefined && index >= 0 && this.config.mapLayers) {\n        this.config.mapLayers[index] = vjmap.cloneDeep(this.layers[idx]);\n      }\n    }\n  }\n  /**\n   * 设置图层开关\n   */\n  public async setLayerVisible(\n    layerId: string,\n    visibleOff?: boolean,\n    isUpdateConfig?: boolean\n  ) {\n    const idx = this.layers.findIndex((y) => y.layerId === layerId);\n    if (idx < 0) return; // 如果不在\n    this.layers[idx].visibleOff = visibleOff;\n    if (!this.layersInst[layerId]) {\n      // 如果之前没创建\n      await this.addLayer(this.layers[idx], isUpdateConfig);\n    }\n    this.layersInst[layerId].setVisible(this.map, layerId, visibleOff);\n    if (isUpdateConfig) {\n      const index = this.config.mapLayers?.findIndex(\n        (y) => y.layerId === layerId\n      );\n      if (index !== undefined && index >= 0 && this.config.mapLayers) {\n        this.config.mapLayers[index].visibleOff = visibleOff;\n      }\n    }\n  }\n  /**\n   * 设置数据源开关\n   */\n  public async setSourceVisible(\n    sourceId: string,\n    visibleOff?: boolean,\n    isUpdateConfig?: boolean\n  ) {\n    for (let layer of this.layers) {\n      if (layer.sourceId == sourceId) {\n        await this.setLayerVisible(layer.layerId, visibleOff);\n      }\n    }\n  }\n  /**\n   * 删除图层\n   */\n  public removeLayer(layerId: string, isUpdateConfig?: boolean) {\n    if (!this.layersInst[layerId]) return; // 如果不在\n    this.layersInst[layerId].removeLayer(this.map, layerId);\n    delete this.layersInst[layerId];\n    const idx = this.layers.findIndex((y) => y.layerId === layerId);\n    if (idx >= 0) {\n      this.layers.splice(idx, 1);\n    }\n    if (isUpdateConfig) {\n      const index = this.config.mapLayers?.findIndex(\n        (y) => y.layerId === layerId\n      );\n      if (index !== undefined && index >= 0) {\n        this.config.mapLayers?.splice(index, 1);\n      }\n    }\n  }\n\n  /**\n   * 增加定时器\n   */\n  public addTimer(mapSource: MapSource) {\n    this.clearTimer(mapSource.id);\n    if (mapSource.change.interval > 0) {\n      this.timeMgr[mapSource.id] = setInterval(async () => {\n        if (!this.map) return;\n        let data = await requestChangeData(this.map, mapSource.change, this);\n        if (this.map.getSource(mapSource.id) !== undefined) {\n          this.map.setData(mapSource.id, this.map.toLngLat(data));\n          await this.notifySourceDataChange(mapSource.id, false, true);\n        }\n      }, mapSource.change.interval * 1000);\n    }\n  }\n\n  /**\n   * 清空定时器\n   */\n  public clearTimer(sourceId: string) {\n    if (this.timeMgr[sourceId]) {\n      clearInterval(this.timeMgr[sourceId]);\n      delete this.timeMgr[sourceId];\n    }\n  }\n\n  /**\n   * 移除所有控件\n   */\n  public removeControls() {\n    if (this.controls) {\n      for (let c of this.controls) {\n        if (c) {\n          this.map.removeControl(c);\n        }\n      }\n      this.controls = [];\n    }\n  }\n\n  /**\n   * 增加控件\n   */\n  public addControls() {\n    this.removeControls();\n    if (!this.config.controls) return;\n    this.controls = this.controls || [];\n    for (let c of this.config.controls) {\n      let ctrl: any;\n      let controlName = c.name;\n      let options = c.options ? JSON.parse(c.options) : {};\n      if (controlName == \"DrawTool\") {\n        ctrl = new vjmap.Draw.Tool(options);\n      } else {\n        if (controlName == \"Custom\") {\n          controlName = options.controlName;\n          if (!controlName) {\n            console.warn(\n              \"custom control options need include controlName field \"\n            );\n            this.controls.push(null);\n            continue;\n          }\n        } else if (controlName == \"MiniMapControl\") {\n          if (!options.containerStyle) {\n            // 设置默认样式\n            options.containerStyle = {\n              background: this.config.backgroundColor,\n              transform: \"scale(0.6)\",\n              transformOrigin: `${\n                c.position.indexOf(\"left\") >= 0 ? \"0%\" : \"100%\"\n              } ${c.position.indexOf(\"top\") >= 0 ? \"0%\" : \"100%\"}`,\n            };\n          }\n        }\n        if (!controlName) continue;\n        // @ts-ignore\n        if (!vjmap[controlName]) {\n          console.warn(`${controlName} is not vjmap class`);\n          this.controls.push(null);\n          continue;\n        }\n        // @ts-ignore\n        ctrl = new vjmap[controlName](options);\n      }\n      if (options?.locale) {\n        // 自定义控件显示文字\n        // @ts-ignore\n        this.map._locale = {\n          // @ts-ignore\n          ...this.map._locale,\n          ...options?.locale,\n        };\n      }\n      // @ts-ignore\n      this.map.addControl(ctrl, c.position);\n      this.controls.push(ctrl);\n    }\n  }\n\n  /**\n   * 获取配置\n   */\n  public getConfig() {\n    return this.config;\n  }\n\n  private findDepsSourceId(sourceId: string, set: Set<string>) {\n    if (!sourceId) return;\n    // 找出依赖此数据源的所有数据源id\n    for (let i = 0; i < this.sources.length; i++) {\n      if (\n        this.sources[i].tag === \"change\" &&\n        this.sources[i].change?.fromSourceId == sourceId\n      ) {\n        // 如果是动态查询\n        let fromSourceId = this.sources[i].id;\n        if (fromSourceId && !set.has(fromSourceId)) {\n          set.add(fromSourceId);\n          this.findDepsSourceId(fromSourceId, set);\n        }\n      }\n    }\n  }\n  /**\n   * 通知数据源数据改变\n   */\n  public async notifySourceDataChange(\n    sourceId?: string,\n    forceUpdate?: boolean,\n    timerUpdate?: boolean\n  ) {\n    if (!sourceId) return;\n    let sourceSet: Set<string> = new Set();\n    sourceSet.add(sourceId);\n    this.findDepsSourceId(sourceId, sourceSet);\n    for (let sId of sourceSet) {\n      const idx = this.sources.findIndex((s) => s.id === sId);\n      if (\n        idx >= 0 &&\n        this.sources[idx].tag === \"change\" &&\n        this.sources[idx].change?.fromSourceId\n      ) {\n        const data = await requestChangeData(\n          this.map,\n          this.sources[idx].change,\n          this\n        );\n        this.map.setData(sId, this.map.toLngLat(data));\n      }\n    }\n    for (let layerId in this.layersInst) {\n      for (let sId of sourceSet) {\n        this.layersInst[layerId]?.onSourceDataChange(\n          this.map,\n          sId,\n          forceUpdate,\n          timerUpdate\n        );\n      }\n    }\n  }\n\n  // 获取系统的图片资源\n  public getSysImages() {\n    return Object.keys(sysImages);\n  }\n\n  static guid(digit = 8): string {\n    return \"x\".repeat(digit).replace(/[xy]/g, (c) => {\n      const r = (Math.random() * 16) | 0;\n      const v = c === \"x\" ? r : (r & 3) | 8;\n      return v.toString(16);\n    });\n  }\n}\n\n\n","import vjmap, { IDrawTool } from \"vjmap\";\r\nimport type { Map } from \"vjmap\";\r\nimport { drawText } from \"./util\";\r\nimport { transformFourParam, transformGeoJsonData } from \"../utils\";\r\n\r\nconst creatPoint = (coordinates: any, properties: any, radius: number, isGeometryCollection?: boolean, map?: Map) => {\r\n    if (properties.symbol && properties.text && map) {\r\n        // 如果是符号中的文本\r\n        return createMText(coordinates, properties, map);\r\n    }\r\n    // 点我们用始点和终点相同的线来表示，也可以根据属性内容用文字也可以\r\n    const ent = new vjmap.DbLine({\r\n        // \"#FF0000\",去了前面的#，把十六进制转成十进制数字\r\n        color: properties.color ? parseInt(properties.color.substring(1), 16) : 0,\r\n        start: coordinates,\r\n        end: coordinates,\r\n        alpha: (properties.opacity ?? 1.0) * 255// 设置个透明度\r\n    });\r\n    fixColor(ent);\r\n    return [ent];\r\n}\r\n\r\nconst creatLineString = (coordinates: any, properties: any, isGeometryCollection?: boolean) => {\r\n    const cadLineWidths = [0, 5, 9, 13, 15, 18, 20, 25, 30, 35, 40, 50, 53, 60, 70, 80, 90, 100, 106, 120, 140, 158, 200, 211] ;// cad支持的线宽，单位mm\r\n    let line_width = properties.line_width ? properties.line_width * 10 : undefined; // cad的线宽是mm，这里是像素，大致转下\r\n    if (line_width) {\r\n        for(let i = 1; i < cadLineWidths.length; i++) {\r\n            if (line_width < cadLineWidths[i]) {\r\n                line_width = cadLineWidths[i - 1];\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    let opacity = isGeometryCollection ? properties.line_opacity : properties.opacity;\r\n    if (properties.center && properties.pointInCircle) {\r\n        // 如果是圆\r\n        const circile = createCircle(coordinates, properties, line_width, opacity);\r\n        return circile;\r\n    }\r\n    const ent = new vjmap.Db2dPolyline({\r\n        // \"#FF0000\",去了前面的#，把十六进制转成十进制数字\r\n        color: properties.color ? parseInt(properties.color.substring(1), 16) : 0,\r\n        points: coordinates,\r\n        lineWidth: line_width,\r\n        alpha: (opacity ?? 1.0) * 255,// 设置个透明度\r\n        elevation: properties.elevation,\r\n    })\r\n    fixColor(ent);\r\n    return [ent]\r\n}\r\n\r\nconst creatPolygon = (coordinates: any, properties: any, isGeometryCollection?: boolean) => {\r\n    let ents = [];\r\n    let color = isGeometryCollection ? properties.fillColor : properties.color;\r\n    let fill =  new vjmap.DbHatch({\r\n        // \"#FF0000\",去了前面的#，把十六进制转成十进制数字\r\n        color: color ? parseInt(color.substring(1), 16) : 0,\r\n        points: coordinates.length == 1 ? coordinates[0] : coordinates,\r\n        pattern: \"SOLID\",\r\n        alpha: (properties.opacity ?? 1.0) * 255// 设置个透明度\r\n    });\r\n    fixColor(fill);\r\n    ents.push(fill);\r\n    if (!isGeometryCollection &&  !properties.noneOutline && properties.color != properties.outlineColor) {\r\n        // 如果有边框\r\n        let outline = new vjmap.Db2dPolyline({\r\n            // \"#FF0000\",去了前面的#，把十六进制转成十进制数字\r\n            color: properties.outlineColor ? parseInt(properties.outlineColor.substring(1), 16) : 0,\r\n            points: coordinates,\r\n            alpha: (properties.opacity ?? 1.0) * 255// 设置个透明度\r\n        })\r\n        fixColor(outline);\r\n        ents.push(outline);\r\n    }\r\n    return ents;\r\n}\r\n\r\nconst createMText = (coordinates: any, properties: any, map: Map) => {\r\n    const fontHeight = properties.text_size_zoom1 ? map.pixelToGeoLength(properties.text_size_zoom1, 1) : map.getGeoBounds().height() / 80;\r\n    coordinates[1] -= fontHeight / 2.0;\r\n    const text = new vjmap.DbMText({\r\n        // \"#FF0000\",去了前面的#，把十六进制转成十进制数字\r\n        color: properties.color ? parseInt(properties.color.substring(1), 16) : 0,\r\n        location: [coordinates[0], coordinates[1]],\r\n        attachment: 2, // 默认是水平居中。垂直顶部\r\n        contents: properties.text,\r\n        rotation: vjmap.degreesToRadians(-parseFloat(properties.text_rotate)),\r\n        textHeight: fontHeight\r\n    });\r\n    fixColor(text);\r\n    return [ text];\r\n}\r\n\r\nexport const getTextRefCo = (feature: any) => {\r\n    let refCo1, refCo2;\r\n    if (feature.geometry.type == \"Polygon\") {\r\n        refCo1 = feature.geometry.coordinates[0][0];\r\n        refCo2 = feature.geometry.coordinates[feature.geometry.coordinates.length - 1][1];\r\n    } else if (feature.geometry.type == \"MultiPolygon\") {\r\n        refCo1 = feature.geometry.coordinates[0][0][0];\r\n        let g = feature.geometry.coordinates[feature.geometry.coordinates.length - 1];\r\n        refCo2 = g[g.length - 1][1];\r\n    } else if (feature.geometry.type == \"MultiLineString\") {\r\n        refCo1 = feature.geometry.coordinates[0][0];\r\n        refCo2 = feature.geometry.coordinates[feature.geometry.coordinates.length - 1][1];\r\n    }  else if (feature.geometry.type == \"GeometryCollection\") {\r\n        let f1 = feature.geometry.geometries[0];\r\n        if (f1.type == \"LineString\") {\r\n            refCo1 = f1.coordinates[0];\r\n        } else  if (f1.type == \"Polygon\") {\r\n            refCo1 = f1.coordinates[0][0];\r\n        }\r\n        let f2 = feature.geometry.geometries[feature.geometry.geometries.length - 1];\r\n        if (f2.type == \"LineString\") {\r\n            refCo2 = f2.coordinates[1];\r\n        } else  if (f2.type == \"Polygon\") {\r\n            refCo2 = f2.coordinates[f2.coordinates.length - 1][1];\r\n        }\r\n    }\r\n    return {\r\n        refCo1, refCo2\r\n    }\r\n}\r\nconst createText = (feature: any, properties: any, map: Map) => {\r\n    let textAttr = properties.export || {};\r\n    if (!textAttr.refCo1 || !textAttr.refCo2 || !textAttr.height || !textAttr.position) return;\r\n    let x, y, height;\r\n    // 取数据上的二个点参考点，和之前保存的参考点计算旋转和缩放系数，用来确定文字的位置和高度属性\r\n    let { refCo1, refCo2 } = getTextRefCo(feature);\r\n    if (!refCo1 || !refCo2) return;\r\n    // 通过之前保存的对应点和现在的对应点，计算缩放和旋转及平移参数\r\n    let param = vjmap.coordTransfromGetFourParamter([vjmap.geoPoint(textAttr.refCo1), vjmap.geoPoint(textAttr.refCo2)],\r\n        [vjmap.geoPoint(refCo1), vjmap.geoPoint(refCo2)], false, true);\r\n    let baseCo = vjmap.coordTransfromByFourParamter(vjmap.geoPoint(textAttr.position), param);\r\n    x = baseCo.x;\r\n    y = baseCo.y; \r\n    height = textAttr.height * param.scale;\r\n   \r\n    let text;\r\n    let attr = {\r\n        ...textAttr,\r\n        rotation: (param.rotate ?? 0) + (textAttr.textRotate ?? 0),\r\n        color: properties.color ? parseInt(properties.color.substring(1), 16) : 0,\r\n    }\r\n    if (!textAttr.isMText) {\r\n        text = new vjmap.DbText({\r\n            ...attr,\r\n            position: [x, y],\r\n            height: height,\r\n        });\r\n    } else {\r\n        text = new vjmap.DbMText({\r\n            ...attr,\r\n            location: [x, y],\r\n            textHeight: height,\r\n        });\r\n    }\r\n    \r\n    fixColor(text);\r\n    return [ text];\r\n}\r\n\r\nconst createCircle = (coordinates: any, properties: any, line_width?: number, opacity?: number) => {\r\n    const p1 = coordinates[0];\r\n    const p2 = coordinates[coordinates.length /2];\r\n    const circle = new vjmap.DbCircle({\r\n        color: properties.color ? parseInt(properties.color.substring(1), 16) : 0,\r\n        center: [(p1[0] + p2[0]) / 2, (p1[1] + p2[1]) / 2],\r\n        radius: vjmap.geoPoint(p1).distanceTo(vjmap.geoPoint(p2)) / 2.0,\r\n        lineWidth: line_width,\r\n        alpha: (opacity ?? 1.0) * 255// 设置个透明度\r\n    })\r\n    fixColor(circle);\r\n    return [ circle];\r\n}\r\n\r\n// 修正颜色，如果颜色为白色或黑色，则置颜色为自动反色\r\nconst fixColor = (ent: any) => {\r\n    if (ent.color == 0 || ent.color == 0xFFFFFF) {\r\n        ent.colorIndex = 7;// cad中颜色索引为7表示自动反色\r\n        delete ent.color;\r\n    }\r\n    return ent;\r\n}\r\n\r\n// 修改图中已绘制的文本\r\nexport const modifyDrawText = async (map: Map,  draw: IDrawTool, promptFunc?: Function /* 显示函数。返回promise<string>*/, message?: Function) => {\r\n    // 先进行选择，点右键确定选择\r\n    message = message || console.log;\r\n    message(\"请选择要选择的绘制文字，按右键结束\");\r\n    let selected = await vjmap.Draw.actionSelect(map, draw);\r\n    if (selected.features.length == 0) return; // 如果没有要选择的实体\r\n    if (!(selected.features[0].properties.export && selected.features[0].properties.export.contents)) {\r\n        message(\"选择的不是绘制的文本类型\");\r\n        return;\r\n    }\r\n    let prop = selected.features[0].properties.export;\r\n    \r\n    let content;\r\n    if (promptFunc) {\r\n      content = await promptFunc(prop.contents);\r\n    } else {\r\n      content  = prompt(\r\n        \"请输入要修改的文字内容\",\r\n        prop.contents\r\n      );\r\n    }\r\n    \r\n    if (content == \"\" || content == null || content == prop.contents) {\r\n      return; // 没有改变\r\n    } \r\n\r\n    \r\n    let textData = await drawText(map, draw, {}, {\r\n        color: selected.features[0].properties.color,// 颜色\r\n        text: content,\r\n        height: 5, // 高度设置少些，要不绘制可能部分不可见\r\n        //height: prop.height,\r\n        //docBounds: map.getGeoBounds(1.0)\r\n    }, undefined, true);\r\n    \r\n    let bounds1 = vjmap.GeoBounds.fromDataExtent(map.fromLngLat(textData));\r\n   \r\n    let feature = selected.features[0];\r\n    let bounds2 = vjmap.GeoBounds.fromDataExtent(map.fromLngLat(selected));\r\n\r\n    // 通过之前保存的对应点和现在的对应点，计算缩放和旋转及平移参数\r\n    \r\n    let fourParam = vjmap.coordTransfromGetFourParamter([bounds1.min, bounds1.max],\r\n        [bounds2.min, bounds2.max], true, true);\r\n   \r\n    let geoTextData = textData;\r\n    let newTextData = transformFourParam(\r\n        map,\r\n        vjmap.cloneDeep(geoTextData),\r\n        fourParam,\r\n      );\r\n      newTextData.features[0].id = selected.features[0].id;\r\n      draw.delete(selected.features[0].id);\r\n      draw.add(newTextData)\r\n}\r\n\r\n// 导出成dwg图\r\nexport const exportDwg = async (map: Map,  draw: IDrawTool, newMapId?: string) => {\r\n    let entsJson = draw.getAll();\r\n    entsJson = map.fromLngLat(entsJson);\r\n    let mapBounds = map.getGeoBounds();\r\n    const defaultRadius = mapBounds.width() / 200 // 取地图宽的200分之一做为半径;\r\n    let addEntitys = [];\r\n    for(let i = 0; i < entsJson.features.length; i++) {\r\n        // 绘制的元素转为cad的元素，demo中只考虑了部分实体类型，可以根据自己的需要扩展\r\n        let feature = entsJson.features[i] as any;\r\n        if (isTrackFeature(feature)) {\r\n            // 如果是数据埋点的实体，此实体只是用来记录一些属性，无需处理。\r\n            // 如果有被删除的实体属性\r\n            const delEnts = getTrackFeatureProperty(draw, \"deleteEntitys\");\r\n            if (delEnts) {\r\n                Array.from(new Set(delEnts)).forEach((entId: any) => {\r\n                    addEntitys.push({\r\n                        objectid: entId,// 实体句柄，如传了实体句柄，是表示修改或删除此实体.\r\n                        delete: true // 表示删除\r\n                    });\r\n                })\r\n            }\r\n            continue;\r\n        }\r\n        if (feature.geometry.type == \"Point\") {\r\n            // 点我们用起点和终点相同的线来表示，也可以根据属性内容用文字也可以\r\n            addEntitys.push(...creatPoint(feature.geometry.coordinates, feature.properties, defaultRadius, false, map));\r\n        } else if (feature.geometry.type == \"LineString\") {\r\n            addEntitys.push(...creatLineString(feature.geometry.coordinates, feature.properties));\r\n        }  else if (feature.geometry.type == \"Polygon\") {\r\n            if (feature.properties.export) {\r\n                // 如果是文字\r\n                const text = createText(feature, feature.properties, map);\r\n                if (text && text.length > 0) {\r\n                    addEntitys.push(...text);\r\n                    continue;// 文字创建成功，否则继续往下执行\r\n                }\r\n            } \r\n            addEntitys.push(...creatPolygon(feature.geometry.coordinates, feature.properties));\r\n        }  else if (feature.geometry.type == \"MultiPoint\") {\r\n            for(let coord of feature.geometry.coordinates) {\r\n                addEntitys.push(...creatPoint(coord, feature.properties, defaultRadius, false, map));\r\n            }\r\n        } else if (feature.geometry.type == \"MultiLineString\") {\r\n            if (feature.properties.export) {\r\n                // 如果是文字\r\n                const text = createText(feature, feature.properties, map);\r\n                if (text && text.length > 0) {\r\n                    addEntitys.push(...text);\r\n                    continue;// 文字创建成功，否则继续往下执行\r\n                }\r\n            } \r\n            for(let coord of feature.geometry.coordinates) {\r\n                addEntitys.push(...creatLineString(coord, feature.properties));\r\n            }\r\n        }  else if (feature.geometry.type == \"MultiPolygon\") {\r\n            if (feature.properties.export) {\r\n                // 如果是文字\r\n                const text = createText(feature, feature.properties, map);\r\n                if (text && text.length > 0) {\r\n                    addEntitys.push(...text);\r\n                    continue;// 文字创建成功，否则继续往下执行\r\n                }\r\n            } \r\n            for(let coord of feature.geometry.coordinates) {\r\n                addEntitys.push(...creatPolygon(coord, feature.properties));\r\n            }\r\n        }else if (feature.geometry.type == \"GeometryCollection\") {\r\n            if (feature.properties.export) {\r\n                // 如果是文字\r\n                const text = createText(feature, feature.properties, map);\r\n                if (text && text.length > 0) {\r\n                    addEntitys.push(...text);\r\n                    continue;// 文字创建成功，否则继续往下执行\r\n                }\r\n            } \r\n\r\n            // 先遍历多边形，再绘制点线，防止多边形把点线覆盖了\r\n            for(let k = 0; k < feature.geometry.geometries.length; k++) {\r\n                let subFeature = feature.geometry.geometries[k];\r\n                if (subFeature.type == \"Polygon\") {\r\n                    addEntitys.push(...creatPolygon(subFeature.coordinates, feature.properties, true));\r\n                } else if (subFeature.type == \"MultiPolygon\") {\r\n                    for(let coord of subFeature.coordinates) {\r\n                        addEntitys.push(...creatPolygon(coord, feature.properties, true));\r\n                    }\r\n                }\r\n            }\r\n            for(let k = 0; k < feature.geometry.geometries.length; k++) {\r\n                let subFeature = feature.geometry.geometries[k];\r\n                if (subFeature.type == \"Point\") {\r\n                    // 点我们用圆来表示，也可以根据属性内容用文字也可以\r\n                    addEntitys.push(...creatPoint(subFeature.coordinates, feature.properties, defaultRadius, true, map));\r\n                } else if (subFeature.type == \"LineString\") {\r\n                    addEntitys.push(...creatLineString(subFeature.coordinates, feature.properties, true));\r\n                } else if (subFeature.type == \"MultiPoint\") {\r\n                    for(let coord of subFeature.coordinates) {\r\n                        addEntitys.push(...creatPoint(coord, feature.properties, defaultRadius, true, map));\r\n                    }\r\n                } else if (subFeature.type == \"MultiLineString\") {\r\n                    for(let coord of subFeature.coordinates) {\r\n                        addEntitys.push(...creatLineString(coord, feature.properties, true));\r\n                    }\r\n                }\r\n            }\r\n        } else {\r\n            console.warn(\"unknow FeatureCollection type:\" + feature.geometry.type)\r\n        }\r\n    }\r\n    let doc = new vjmap.DbDocument();\r\n    /** 来源于哪个图，会在此图的上面进行修改或新增删除，格式如 形式为 mapid/version,如 exam/v1 . */\r\n    let svc = map.getService();\r\n    let param = svc.currentMapParam();\r\n\r\n    if (param?.mapid) {\r\n        if (!param.maptype) {\r\n           // 如果来源于某cad图, 如果是图像不需要传\r\n           doc.from = `${param?.mapid}/${param?.version}`; // 当前地图的地图id和版本\r\n        }\r\n    }\r\n    doc.appendEntity(addEntitys); // 把要绘制的实体加上\r\n  \r\n    // 创建一个新的服务类，否则会影响之前的服务对象\r\n    let service = svc.clone();\r\n    // js代码\r\n    let res = await service.updateMap({\r\n        mapid: newMapId ? newMapId : vjmap.getTempMapId(60, true), // 绘制的导出的用临时图形吧，临时图形不浏览情况下过期自动删除时间，单位分钟。默认30,\r\n        filedoc: doc.toDoc(),\r\n        mapopenway: vjmap.MapOpenWay.Memory,\r\n        style: {\r\n            backcolor: 0 // 如果div背景色是浅色，则设置为oxFFFFFF\r\n        }\r\n    })\r\n    return res;\r\n}\r\n\r\n\r\n// 是否是数据埋点的实体，此实体只是用来记录一些属性，无需显示。\r\nexport const isTrackFeature = (feature: any) => {\r\n    // id并且是__data_track__\r\n    // 数据埋点的实体\r\n    // 必须是点类型\r\n    // 点坐标必须是[0,0]\r\n    // 属性中，要是隐藏，并且是不能选择锁定状态\r\n    if (!feature) return false;\r\n    return feature.id == '__data_track__';\r\n}\r\n\r\n//  设置数据埋点的实体属性，此实体只是用来记录一些属性，无需显示。\r\nexport const setTrackFeatureProperty = (draw: IDrawTool, props: Record<string, any>) => {\r\n    let entsJson = draw.getAll();\r\n    let trackFeature = entsJson.features.find(f => isTrackFeature(f));\r\n    if (!trackFeature) {\r\n        draw.add({\r\n            \"id\": \"__data_track__\",\r\n            \"type\": \"Feature\",\r\n            \"properties\": {\r\n                ...props,\r\n                \"radius_inactive\": 1,\r\n                \"radius_static\": 1,\r\n                \"opacity\": 0,\r\n                \"_hover_opacity\": 0,\r\n                \"isOff\": true,\r\n                \"isLocked\": true\r\n            },\r\n            \"geometry\": {\r\n                \"coordinates\": [\r\n                    0,\r\n                    0\r\n                ],\r\n                \"type\": \"Point\"\r\n            }\r\n        })\r\n    } else if (trackFeature?.id) {\r\n        for(let k in props) {\r\n            draw.setFeatureProperty(trackFeature?.id as any, k, props[k])\r\n        }\r\n    }\r\n}\r\n\r\n//  获取数据埋点的实体属性\r\nexport const getTrackFeatureProperty = (draw: IDrawTool, key?: string) => {\r\n    let entsJson = draw.getAll();\r\n    let trackFeature = entsJson.features.find(f => isTrackFeature(f)) as any;\r\n    if (trackFeature && trackFeature.properties) {\r\n        if (key) {\r\n            return trackFeature.properties[key];\r\n        } else {\r\n            return trackFeature.properties;\r\n        }\r\n    } \r\n}\r\n\r\n\r\n// 增加文字导出信息参考点\r\nexport const addExportRefInfoInText = (prj: any, data: any) => {\r\n    let textAttr: any ={};\r\n    if (data.features.length > 0 ) {\r\n      let f = data.features[0];\r\n      if (f.geometry.type == \"Polygon\") {\r\n        textAttr.refCo1 = prj.fromLngLat(f.geometry.coordinates[0][0]);\r\n      } else if (f.geometry.type == \"LineString\") {\r\n        textAttr.refCo1 = prj.fromLngLat(f.geometry.coordinates[0]);\r\n      } else if (f.geometry.type == \"MultiPolygon\") {\r\n        textAttr.refCo1 = prj.fromLngLat(f.geometry.coordinates[0][0][0]);\r\n      }\r\n      f = data.features[data.features.length - 1];\r\n      if (f.geometry.type == \"Polygon\") {\r\n        textAttr.refCo2 = prj.fromLngLat(f.geometry.coordinates[f.geometry.coordinates.length - 1][1]);\r\n      } else  if (f.geometry.type == \"LineString\") {\r\n        textAttr.refCo2 = prj.fromLngLat(f.geometry.coordinates[1]);\r\n      } else if (f.geometry.type == \"MultiPolygon\") {\r\n        let g = f.geometry.coordinates[f.geometry.coordinates.length - 1];\r\n        textAttr.refCo2 = prj.fromLngLat(g[g.length - 1][1]);\r\n      }\r\n    }\r\n    return textAttr;\r\n  }","import vjmap, { Map, GeoPoint } from \"vjmap\";\r\nimport type { IConditionQueryFeatures } from \"vjmap\";\r\nimport { getEntityObjectId, isAlphanumeric } from \"../utils\";\r\nimport { toProperties } from \"./query\";\r\nexport const addHighLightSourceLayer = (\r\n  map: Map,\r\n  layerId?: string,\r\n  highlightColor?: string\r\n) => {\r\n  const name = layerId ?? \"myhighlight\";\r\n  highlightColor = highlightColor ?? \"#FF8957\";\r\n  //  数据源\r\n  map.addGeoJSONSource(`${name}-source`, {\r\n    type: \"FeatureCollection\",\r\n    features: [],\r\n  });\r\n\r\n  map.addCircleLayer(`${name}-point-layer`, `${name}-source`, {\r\n    circleColor: highlightColor,\r\n    circleOpacity: 0.8,\r\n    circleRadius: 1,\r\n    filter: [\"==\", [\"geometry-type\"], \"Point\"],\r\n  });\r\n\r\n  map.addLineLayer(`${name}-line-layer`, `${name}-source`, {\r\n    lineJoin: \"round\",\r\n    lineCap: \"round\",\r\n    lineColor: highlightColor,\r\n    lineWidth: 3,\r\n    lineOpacity: 0.8,\r\n    filter: [\"==\", [\"geometry-type\"], \"LineString\"],\r\n  });\r\n\r\n  map.addFillLayer(`${name}-fill-layer`, `${name}-source`, {\r\n    fillColor: highlightColor,\r\n    fillOpacity: 1.0,\r\n    filter: [\"==\", [\"geometry-type\"], \"Polygon\"],\r\n  });\r\n};\r\nexport const clearHighLightSourceLayer = (map: Map, layerId?: string) => {\r\n  const name = layerId ?? \"myhighlight\";\r\n  if (map.getSource(`${name}-source`)) {\r\n    // @ts-ignore\r\n    map.getSource(`${name}-source`).setData({\r\n      type: \"FeatureCollection\",\r\n      features: [],\r\n    });\r\n  }\r\n};\r\n\r\n// 获取选择上的整个实体的id数组\r\nconst getSelectedWholeEntityId = async (map: Map,\r\n  bounds: [number, number, number, number] | undefined,\r\n  queryParam?: IConditionQueryFeatures,\r\n  disableSelectEntities?: Set<String> /* 不能选择的实体集合 */) => {\r\n    const svc = map.getService();\r\n    const isPointSel = bounds && vjmap\r\n      .geoPoint([bounds[0], bounds[1]])\r\n      .equals(vjmap.geoPoint([bounds[2], bounds[3]]));\r\n    let res;\r\n    if (isPointSel) {\r\n      res = await svc.pointQueryFeature({\r\n        zoom: map.getZoom(),\r\n        x: bounds[0],\r\n        y: bounds[1],\r\n        limit: 100, \r\n        ...queryParam,\r\n        fields: \"objectid\"\r\n      });\r\n    } else {\r\n      const result = [];\r\n      let beginPos = 0; // 记录查询开始位置\r\n      // 有可能记录数会很多，这里用分页查询\r\n      const limit = 50000; // 每次查5万条\r\n      // eslint-disable-next-line no-constant-condition\r\n      while(true) {\r\n          const query = await svc.conditionQueryFeature({\r\n            condition: ``, // 只需要写sql语句where后面的条件内容,字段内容请参考文档\"服务端条件查询和表达式查询\"\r\n            bounds: bounds, //查找此范围内的实体\r\n            fields: \"objectid\",\r\n            includegeom: true, \r\n            realgeom: true,\r\n            isContains: bounds && bounds[0] > bounds[2], //矩形包含才行,false是相交关系\r\n            beginpos: beginPos, // 记录开始位置\r\n            limit: limit, // 每次查5万条\r\n            ...queryParam,\r\n          });\r\n          if (!query.result) break;\r\n          beginPos += limit; // 开始位置位置挪动\r\n          result.push(...query.result || []);\r\n          if (result.length >= query.recordCount) break;\r\n      }\r\n      res = {\r\n        result,\r\n        recordCount: result.length\r\n      };\r\n    }\r\n\r\n    let objectIdSet = new Set();\r\n    let objectIdCondSet = new Set();\r\n    if (res.result) {\r\n      for (const ent of res.result) {\r\n        if (ent.objectid) {\r\n          if (disableSelectEntities && disableSelectEntities.has(ent.objectid)) {\r\n            objectIdCondSet.add(`1 != 1`); // 加一个返回为false的条件\r\n            continue;\r\n          }\r\n          let objectId = \"\"; \r\n          let k = 0;\r\n          for(k = 0; k < ent.objectid.length; k++) { \r\n            if (isAlphanumeric(ent.objectid[k])) {\r\n              objectId += ent.objectid[k]\r\n            } else { \r\n              break;\r\n            }\r\n          } \r\n          if (objectId) {\r\n            if (objectId == ent.objectid) {\r\n              // 如果直接是id，不是块或组合实体\r\n              objectIdSet.add(objectId);\r\n            } else {\r\n              // 是块或组合实体 用模糊查找，近似的\r\n              const specialChars = ['_'];\r\n              for(const s of specialChars) {\r\n                objectIdCondSet.add(`objectid like '${objectId}${s}%'`);\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    let cond1, cond2;\r\n    if (objectIdSet.size > 0) {\r\n      const ids = Array.from(objectIdSet).map(s => `\"${s}\"`).join(\",\");\r\n      cond1 = ` objectid in (${ids}) `;\r\n    }\r\n    if (objectIdCondSet.size > 0) {\r\n      cond2 = Array.from(objectIdCondSet).join(' or ');\r\n    }\r\n    if (cond1 && cond2) {\r\n      return cond1 + \" or \" + cond2;\r\n    } else if(cond1) {\r\n      return cond1;\r\n    } else {\r\n      return cond2 ?? '';\r\n    }\r\n}\r\n\r\nexport const getHighlightEntities = async (\r\n  map: Map,\r\n  bounds: [number, number, number, number] | undefined,\r\n  useGeomCoord?: boolean,\r\n  queryParam?: IConditionQueryFeatures,\r\n  includeWholeEntity?: boolean, /* 选择时是否选择上整个实体对象 */\r\n  disableSelectEntities?: Set<String>, /* 不能选择的实体集合 */\r\n  isClearOld?: boolean,\r\n  layerId?: string,\r\n  highlightColor?: string\r\n) => {\r\n  const name = layerId ?? \"myhighlight\";\r\n  const svc = map.getService();\r\n  const isPointSel = bounds && vjmap\r\n    .geoPoint([bounds[0], bounds[1]])\r\n    .equals(vjmap.geoPoint([bounds[2], bounds[3]]));\r\n  let queryIdContion;\r\n  if (includeWholeEntity) {\r\n    // 选择上整个实体对象\r\n    queryIdContion = await getSelectedWholeEntityId(map, bounds, queryParam, disableSelectEntities);\r\n  }\r\n  let res;\r\n  if (isPointSel && !queryIdContion) {\r\n    res = await svc.pointQueryFeature({\r\n      zoom: map.getZoom(),\r\n      x: bounds[0],\r\n      y: bounds[1],\r\n      limit: 100, \r\n      ...queryParam,\r\n    });\r\n    \r\n  } else {\r\n    let result = [];\r\n    let beginPos = 0; // 记录查询开始位置\r\n    // 有可能记录数会很多，这里用分页查询\r\n    const limit = 50000; // 每次查5万条\r\n    // eslint-disable-next-line no-constant-condition\r\n    while(true) {\r\n      let query;\r\n      if (!queryIdContion) {\r\n        query = await svc.conditionQueryFeature({\r\n          condition: ``, // 只需要写sql语句where后面的条件内容,字段内容请参考文档\"服务端条件查询和表达式查询\"\r\n          bounds: bounds, //查找此范围内的实体\r\n          fields: \"\",\r\n          includegeom: useGeomCoord, // 是否返回几何数据,为了性能问题，realgeom为false时，如果返回条数大于1.只会返回每个实体的外包矩形，如果条数为1的话，会返回此实体的真实geojson；realgeom为true时每条都会返回实体的geojson\r\n          realgeom: useGeomCoord,\r\n          isContains: bounds && bounds[0] > bounds[2], //矩形包含才行,false是相交关系\r\n          beginpos: beginPos, // 记录开始位置\r\n          limit: limit, // 每次查5万条\r\n          ...queryParam,\r\n        });\r\n      } else {\r\n        // 如果是选择上整个实体对象，因为之前已经查到了所有objectid,所以这里条件应该是objectid了\r\n        query = await svc.conditionQueryFeature({\r\n          condition: queryIdContion,\r\n          fields: \"\",\r\n          includegeom: useGeomCoord, // 是否返回几何数据,为了性能问题，realgeom为false时，如果返回条数大于1.只会返回每个实体的外包矩形，如果条数为1的话，会返回此实体的真实geojson；realgeom为true时每条都会返回实体的geojson\r\n          realgeom: useGeomCoord,\r\n          beginpos: beginPos, // 记录开始位置\r\n          limit: limit, // 每次查5万条\r\n          ...queryParam,\r\n        });\r\n      }\r\n       \r\n        if (!query.result) break;\r\n        beginPos += limit; // 开始位置位置挪动\r\n        result.push(...query.result || []);\r\n        if (result.length >= query.recordCount) break;\r\n    }\r\n    \r\n    res = {\r\n      result,\r\n      recordCount: result.length\r\n    };\r\n  }\r\n  \r\n  if (disableSelectEntities && res.result) {\r\n    res.result = res.result.filter((s: any) => !disableSelectEntities.has(s.objectid));\r\n    res.recordCount = res.result.length;\r\n  }\r\n\r\n  const drawGeom = {\r\n    features: [],\r\n    type: \"FeatureCollection\",\r\n  };\r\n\r\n  const drawCoord = {\r\n    features: [],\r\n    type: \"FeatureCollection\",\r\n  };\r\n\r\n \r\n  if (res && res.result && res.result.length > 0) {\r\n    if (!map.getSource(`${name}-source`)) {\r\n      addHighLightSourceLayer(map, layerId, highlightColor); // 第一次初始化\r\n    }\r\n\r\n    for (const ent of res.result) {\r\n      if (ent.geom && ent.geom.geometries) {\r\n        for(const idx in ent.geom.geometries) {\r\n          const feature = {\r\n            type: \"Feature\",\r\n            id: ent.id + \"_\" + idx,\r\n            properties: toProperties(ent),\r\n            geometry: ent.geom.geometries[idx]\r\n          }\r\n          // @ts-ignore\r\n          drawGeom.features.push(feature);\r\n        }\r\n        \r\n      }\r\n      if (!useGeomCoord) {\r\n        // 使用位置坐标\r\n        const coord =\r\n          ent.points || ent.positon || ent.location || ent.origin || ent.center;\r\n        if (coord) {\r\n          const pts = coord.split(\";\");\r\n          const points = [];\r\n          for(let p of pts) {\r\n            if (p.indexOf(\",\") > 0)\r\n            points.push(map.toLngLat(vjmap.GeoPoint.fromString(p)))\r\n          }\r\n          if (points.length == 1) {\r\n            const feature = {\r\n              type: \"Feature\",\r\n              id: ent.id,\r\n              properties: toProperties(ent),\r\n              geometry: {\r\n                // @ts-ignore\r\n                type: \"Point\",\r\n                // @ts-ignore\r\n                coordinates: points[0],\r\n              }\r\n            }\r\n            // @ts-ignore\r\n            drawCoord.features.push(feature);\r\n          } else if (points.length > 1) {\r\n            const feature = {\r\n              type: \"Feature\",\r\n              id: ent.id,\r\n              properties: toProperties(ent),\r\n              geometry: {\r\n                // @ts-ignore\r\n                type: \"LineString\",\r\n                // @ts-ignore\r\n                coordinates: points,\r\n              }\r\n            }\r\n            // @ts-ignore\r\n            drawCoord.features.push(feature);\r\n          }\r\n        }\r\n      }\r\n    }\r\n    const mapDrawData = useGeomCoord ? drawGeom : drawCoord;\r\n    if (mapDrawData.features.length > 0) {\r\n      // @ts-ignore\r\n      if (!isClearOld && map.getSource(`${name}-source`)?._data?.features) {\r\n        // @ts-ignore\r\n        map.getSource(`${name}-source`).setData({\r\n            // @ts-ignore\r\n            features: [\r\n            // @ts-ignore\r\n            // eslint-disable-next-line no-unsafe-optional-chaining\r\n            ...map.getSource(`${name}-source`)?._data?.features,\r\n            // @ts-ignore\r\n            ...mapDrawData.features,\r\n          ],\r\n          type: \"FeatureCollection\",\r\n        });\r\n      } else {\r\n        // @ts-ignore\r\n        map.getSource(`${name}-source`).setData(mapDrawData);\r\n      }\r\n    } else {\r\n      if (isClearOld) clearHighLightSourceLayer(map, name);\r\n    }\r\n  } else {\r\n    if (isClearOld) clearHighLightSourceLayer(map, name);\r\n  }\r\n  map.triggerRepaint();\r\n  return useGeomCoord ? drawGeom : drawCoord;\r\n};\r\n\r\nexport const clearHighlight = (map: Map, layerId?: string) => {\r\n  const name = layerId ?? \"myhighlight\";\r\n  clearHighLightSourceLayer(map, name);\r\n  map.triggerRepaint();\r\n};\r\n","import type { Map } from 'vjmap'\r\n\r\nconst snapCache: Record<string, object> = {}\r\nexport const getMapSnapPoints = async (map: Map, snapObj: any, snapQueryLimit?: number) => {\r\n    if (snapQueryLimit === 0) {\r\n        // 不启用捕捉\r\n        snapObj.features = []\r\n        return;\r\n    }\r\n    //栅格样式去服务器获取坐标点数据\r\n    // 栅格样式获取捕捉点\r\n    // 查询所有坐标数据,字段含义可参考https://vjmap.com/guide/svrStyleVar.html\r\n    const svc = map.getService();\r\n    const mapid = svc.currentMapParam()?.mapid;\r\n    const ver = svc.currentMapParam()?.version;\r\n    if (!mapid) return;\r\n    const key = `${mapid}_${ver}${svc.getCurWorkspaceName()}`;\r\n    if (key in snapCache) {\r\n        //@ts-ignore\r\n        snapObj.features = [...snapCache[key].features];\r\n        return;\r\n    } else {\r\n        // 去本地缓存获取\r\n        const features = localStorage.getItem('snap_' + key);\r\n        if (features) {\r\n            try {\r\n                const values = JSON.parse(features);\r\n                if (Array.isArray(values)) {\r\n                    //@ts-ignore\r\n                    snapObj.features = [...values];\r\n                    snapCache[key] = snapObj;\r\n                    return;\r\n                }\r\n            // eslint-disable-next-line no-empty\r\n            } catch (error) {\r\n                \r\n            }\r\n        }\r\n    }\r\n    let res = await svc.conditionQueryFeature({ fields:\"s3\", condition:\"s3 != ''\", limit: snapQueryLimit ?? 100000})\r\n    if (!res.result) return;\r\n    res = res.result.map((e: any) => e.s3.split(\";\"))\r\n    snapObj.features = []\r\n    for(const item of res) {\r\n        const coordinates = []\r\n        for(const pt of item) {\r\n            const p = pt.split(\",\")\r\n            if (p.length >= 2) {\r\n                coordinates.push(map.toLngLat([+p[0], +p[1]]))\r\n            }\r\n        }\r\n        if (coordinates.length == 1) {\r\n            snapObj.features.push({\r\n                type: \"Feature\",\r\n                geometry: {\r\n                    type: \"Point\",\r\n                    coordinates: coordinates[0]\r\n                }\r\n            })\r\n        }\r\n        else if (coordinates.length > 1) {\r\n            snapObj.features.push({\r\n                type: \"Feature\",\r\n                geometry: {\r\n                    type: \"LineString\",\r\n                    coordinates: coordinates\r\n                }\r\n            })\r\n        }\r\n    }\r\n    snapCache[key] = snapObj;\r\n    try {\r\n        localStorage.setItem('snap_' + key, JSON.stringify(snapObj.features));\r\n    // eslint-disable-next-line no-empty\r\n    } catch (error) {\r\n        \r\n    }\r\n}","import type { Map } from \"vjmap\";\r\nimport vjmap from \"vjmap\";\r\nimport { clearHighlight, getHighlightEntities } from \"./highlight\";\r\nimport { getMapSnapPoints } from \"./snap\";\r\n\r\n// 选择实体\r\nexport const selectFeatures = async (\r\n  map: Map,\r\n  useGeomCoord?: boolean, /* 返回几何坐标还是位置坐标 */\r\n  includeWholeEntity?: boolean, /* 选择时是否选择上整个实体对象 */\r\n  isPointSel?: boolean, /* 点选还是框选 */\r\n  disableSnap?: boolean, /* 是否禁用捕捉 */\r\n  disableSelectEntities?: Set<String> /* 不能选择的实体集合 */\r\n) => {\r\n  if (\r\n    map.getService().currentMapParam()?.mapopenway == vjmap.MapOpenWay.Memory\r\n  ) {\r\n    console.error(\r\n      \"内存打开模式不支持选择实体，请切换至几何栅格或几何矢量方式打开图形\"\r\n    );\r\n    return;\r\n  }\r\n\r\n  const snapObj = {}; // 设置的捕捉的实体\r\n  if (!disableSnap) {\r\n    getMapSnapPoints(map, snapObj);\r\n  }\r\n  // @ts-ignore\r\n  map._selectFeatures = [];\r\n  // eslint-disable-next-line no-constant-condition\r\n  while (true) {\r\n    let co;\r\n    // @ts-ignore\r\n    if (!(isPointSel ?? map._isPointSel)) {\r\n      const drawRect = (await vjmap.Draw.actionDrawRectangle(map, {\r\n        api: {\r\n          getSnapFeatures: snapObj, //要捕捉的数据项在后面，通过属性features赋值\r\n        },\r\n        contextMenu: (e: any) => {\r\n          // 给地图发送Enter键消息即可取消，模拟按Enter键\r\n          map.fire(\"keyup\", { keyCode: 13 });\r\n        },\r\n      })) as any;\r\n      if (drawRect.cancel) {\r\n        break;\r\n      }\r\n      co = drawRect.features[0].geometry.coordinates[0];\r\n    } else {\r\n      const drawPoint = (await vjmap.Draw.actionDrawPoint(map, {\r\n        api: {\r\n          getSnapFeatures: snapObj, //要捕捉的数据项在后面，通过属性features赋值\r\n        },\r\n        contextMenu: (e: any) => {\r\n          // 给地图发送Enter键消息即可取消，模拟按Enter键\r\n          map.fire(\"keyup\", { keyCode: 13 });\r\n        },\r\n      })) as any;\r\n      if (drawPoint.cancel) {\r\n        break;\r\n      }\r\n      // 构造成四个一样的点，这样可以和矩形一样，统一调用 下面的接口\r\n      co = [\r\n        drawPoint.features[0].geometry.coordinates,\r\n        drawPoint.features[0].geometry.coordinates,\r\n        drawPoint.features[0].geometry.coordinates,\r\n        drawPoint.features[0].geometry.coordinates,\r\n      ];\r\n    }\r\n    co = map.fromLngLat(co);\r\n\r\n    const geom = await getHighlightEntities(\r\n      map,\r\n      [co[0].x, co[0].y, co[2].x, co[1].y],\r\n      useGeomCoord,\r\n      undefined,\r\n      // @ts-ignore\r\n      includeWholeEntity ?? map._includeWholeEntity,\r\n      disableSelectEntities\r\n    );\r\n\r\n    // @ts-ignore\r\n    map._selectFeatures.push(\r\n      ...geom.features\r\n    );\r\n  }\r\n\r\n  // 清空之前临时高亮和实体\r\n  // clearHighlight(map);\r\n  // @ts-ignore\r\n  return map._selectFeatures;\r\n};\r\n","import vjmap, { Map, IDrawTool } from 'vjmap'\r\nimport { addExportRefInfoInText, getTrackFeatureProperty, setTrackFeatureProperty } from \"./export\";\r\nimport { selectFeatures } from \"../map/select\";\r\nimport { getEntityObjectId } from '../utils';\r\nimport { clearHighlight } from '../map/highlight';\r\nimport { addFeaturesToDraw, cancelDraw, getGeoJsonBounds, interactiveCreateGeom } from './util';\r\n// 修改或删除cad底图的实体元素，先通过修改样式的方式，使之在前端不可见。然后最后导出为dwg的时候，再从底图删除。\r\n// 如果是修改，则把cad的数据通过绘图绘制到前端进行修改\r\nexport const editCadEntity = async (\r\n    map: Map, // 地图对象\r\n    draw: IDrawTool, // 绘图对象\r\n    updateMapStyleObj: any, // 通过 createUpdateMapStyleObj 获取\r\n    editOp: \"delete\" | \"modify\" | \"copy\", //删除或修改或复制\r\n    showInfoFunc?: Function, // 显示信息的函数名\r\n    dlgConfirmInfo?: Function, // 显示确认对话框的函数名\r\n    isRectSel?: boolean, /* 点选还是框选 */\r\n    promptFunc?: Function, // 显示函数。返回promise<string>\r\n  ) => {\r\n    const editOpName = editOp == \"delete\" ? \"删除\" : (editOp == \"modify\" ? \"修改\" : \"复制\")\r\n    if (showInfoFunc) showInfoFunc(\r\n      `请选择要 ${editOpName} 的CAD实体对象，按右键结束`\r\n    );\r\n    cancelDraw(map);\r\n    const hideObjectIds =  getTrackFeatureProperty(draw, \"hideEntityObjectIds\");\r\n    const selected = await selectFeatures(map, true, true, !isRectSel, true, hideObjectIds ? new Set(hideObjectIds) : undefined);\r\n    if (!selected || selected.length == 0) return;\r\n    const memoryObjectidSet = new Set(); // 内存模式下面的objectid\r\n    const geomObjectidSet = new Set(); // 几何渲染栅格瓦片的objectid\r\n    const geomIdSet = new Set(); // 几何渲染矢量瓦片的id\r\n    selected.forEach((f: any) => {\r\n      if (f.properties.objectid) {\r\n        // 几何打开模式栅格的objectid\r\n        geomObjectidSet.add(f.properties.objectid);\r\n      }\r\n      if (f.id) {\r\n        // 几何渲染矢量瓦片的id\r\n        geomIdSet.add(parseInt(f.id));\r\n      }\r\n      // 内存打开模式下的objectid\r\n      const id = getEntityObjectId(f.properties.objectid);\r\n      if (id) {\r\n        memoryObjectidSet.add(id);\r\n      }\r\n    });\r\n    const onOk = async (modifyProps?: Record<string, any>, isModifyText?: Boolean) => {\r\n      if (editOp != \"copy\")\r\n      {\r\n        if (map.hasVectorLayer()) {\r\n          // 几何渲染矢量瓦片\r\n          await updateMapStyleObj.addHideObjectIds(Array.from(geomIdSet));\r\n        } else {\r\n          // 几何渲染栅格瓦片\r\n          await updateMapStyleObj.addHideObjectIds(Array.from(geomObjectidSet));\r\n        }\r\n        // 把要加从cad原图删除的实体id保存到数据埋点的实体上，此实体只是用来记录一些属性，无需显示。等导出为dwg图时才处理。\r\n        const deleteEntitys = getTrackFeatureProperty(draw, \"deleteEntitys\") || [];\r\n        deleteEntitys.push(...Array.from(memoryObjectidSet));\r\n        const hideEntityObjectIds =\r\n          getTrackFeatureProperty(draw, \"hideEntityObjectIds\") || [];\r\n        hideEntityObjectIds.push(...Array.from(geomObjectidSet));\r\n        const hideEntityIds = getTrackFeatureProperty(draw, \"hideEntityIds\") || [];\r\n        hideEntityIds.push(...Array.from(geomIdSet));\r\n        setTrackFeatureProperty(draw, {\r\n          deleteEntitys: Array.from(new Set(deleteEntitys)),\r\n          hideEntityObjectIds: Array.from(new Set(hideEntityObjectIds)),\r\n          hideEntityIds: Array.from(new Set(hideEntityIds)),\r\n        });\r\n      }\r\n      \r\n      if (editOp != \"delete\") {\r\n        // 如果是修改\r\n        let param = map.getService().currentMapParam() as any;\r\n        let props = {};\r\n        if (isModifyText && modifyProps) {\r\n          props = modifyProps[0];\r\n        }\r\n        const data = await createGeomData(\r\n          map,\r\n          Array.from(memoryObjectidSet).map((e: any) => {\r\n            return {\r\n              objectid: e,\r\n              ...props\r\n            };\r\n          }),\r\n          updateMapStyleObj?.getClipBounds(),\r\n          null,\r\n          null,\r\n          `${param.mapid}/${param.version}`\r\n        );\r\n        let oldFeatureLength = draw.getAll().features.length;\r\n        addFeaturesToDraw(data, draw, true);\r\n        if (modifyProps) {\r\n          // 如果是单行文本或多行文本，把属性挂至export上面，这样导出dwg的时候，可以根据属性创建text对象了，否则会把文字变成多边形填充对象\r\n          const features = draw.getAll().features;\r\n          const idSet = new Set();\r\n          for(let k = oldFeatureLength; k < features.length; k++) {\r\n            const id = getEntityObjectId(features[k].properties?.objectid);\r\n            if (!idSet.has(id)) \r\n            {\r\n              idSet.add(id);\r\n            }\r\n            let modiPropIndex = idSet.size - 1;\r\n            if (!modifyProps[modiPropIndex]) continue; // 不是文字\r\n            const addFeatureId = features[k].id as string;\r\n            draw.setFeatureProperty(addFeatureId, \"disableDirectEdit\", true); // 禁止选中后直接编辑坐标\r\n            draw.setFeatureProperty(addFeatureId, \"export\", {\r\n              ...modifyProps[modiPropIndex].export,\r\n              ...addExportRefInfoInText(map, {\r\n                features: data.features.filter(f => f.properties?.objectid == features[k]?.properties?.objectid)\r\n              })\r\n            })\r\n          }\r\n        }\r\n        if (editOp == \"copy\") {\r\n          let newFtColl = {\r\n            type: \"FeatureCollection\",\r\n            features: []\r\n          } as any;\r\n          const features = draw.getAll().features;\r\n          for(let k = oldFeatureLength; k < features.length; k++) {\r\n            newFtColl.features.push(features[k])\r\n          }\r\n          draw.delete(newFtColl.features.map((f: any) => f.id))\r\n          // 如果是复制\r\n          let res = await interactiveCreateGeom(newFtColl, map, {}, showInfoFunc, {\r\n            drawInitPixelLength: 0 /*绘制的初始在地图上的像素距离 0 为默认大小*/\r\n          });\r\n          if (res) {\r\n            draw.add(res.feature);\r\n          }\r\n        }\r\n      }\r\n      clearHighlight(map);\r\n    };\r\n    const onCancel = () => {\r\n      clearHighlight(map);\r\n    };\r\n  \r\n    // 如果是单行文本或多行文本，则弹出修改文本的框，其余的直接获取实体绘制geojson绘制到前端进行修改\r\n    const getTextProps = (features: any, content?: string) => {\r\n      let objectIdProps: any;\r\n      const idSet = new Set();\r\n      for(let f = 0 ; f < features.length; f++) {\r\n        const ftProps = features[f].properties;\r\n        const id = getEntityObjectId(ftProps.objectid);\r\n        if (idSet.has(id)) continue;\r\n        idSet.add(id);\r\n        if (!(ftProps.name == \"AcDbText\" || ftProps.name == \"AcDbMText\")) continue;\r\n        const isText = ftProps.name == \"AcDbText\";\r\n        const props: Record<string, any> = isText\r\n          ? {\r\n              text: content ?? ftProps.text, // 单行文本\r\n              isText: true,\r\n            }\r\n          : {\r\n              contents: content ?? ftProps.text, // 多行文本\r\n              isMText: true\r\n         };\r\n         // 增加要导出dwg时，必要的一些参数\r\n         props.export = {\r\n          position: vjmap.GeoPoint.fromString(ftProps.location || ftProps.position),\r\n          height: ftProps.height || ftProps.textHeight,\r\n          contents: content,\r\n          cloneObjectId: getEntityObjectId(ftProps.objectid),\r\n          textRotate: ftProps.rotate || 0\r\n         }\r\n         objectIdProps = objectIdProps ?? {};\r\n         objectIdProps[idSet.size - 1] = props;\r\n      }\r\n      return objectIdProps\r\n    }\r\n    if (editOp != \"delete\" && \r\n      memoryObjectidSet.size == 1 &&\r\n      (selected[0].properties.name == \"AcDbText\" ||\r\n        selected[0].properties.name == \"AcDbMText\")\r\n    ) {\r\n      let content;\r\n      if (promptFunc) {\r\n        content = await promptFunc(selected[0].properties.text);\r\n      } else {\r\n        content  = prompt(\r\n          \"请输入要修改的文字内容\",\r\n          selected[0].properties.text\r\n        );\r\n      }\r\n      \r\n      if (content == \"\" || content == null) {\r\n        onCancel();\r\n        return; // 没有改变\r\n      } else {\r\n        \r\n        await onOk(getTextProps(selected, content), true); // 通过要修改的属性去后台获取实体绘制geojson绘制到前端进行修改\r\n      }\r\n    } else {\r\n      // 直接获取实体绘制geojson绘制到前端进行修改\r\n      if (!dlgConfirmInfo) {\r\n        await onOk();\r\n      } else {\r\n        let isOk = await dlgConfirmInfo(`你确定要${editOpName} 这 ${\r\n            memoryObjectidSet.size\r\n          } 个cad实体对象 ?`);\r\n        if (isOk) {\r\n            await onOk(getTextProps(selected));\r\n        } else {\r\n            onCancel();\r\n        }\r\n      }\r\n    }\r\n  };\r\n  \r\n  // 删除cad底图的实体元素，先通过修改样式的方式，使之在前端不可见。然后最后导出为dwg的时候，再从底图删除\r\n  export const deleteCadEntity = async (\r\n    map: Map, // 地图对象\r\n    draw: IDrawTool, // 绘图对象\r\n    updateMapStyleObj: any, // 通过 createUpdateMapStyleObj 获取\r\n    showInfoFunc?: Function, // 显示信息的函数名\r\n    dlgConfirmInfo?: Function, // 显示确认对话框的函数名\r\n    isRectSel?: boolean, /* 点选还是框选 */\r\n    promptFunc?: Function, // 显示函数。返回promise<string>\r\n  ) => {\r\n    try {\r\n      await editCadEntity(map, draw, updateMapStyleObj, \"delete\", showInfoFunc, dlgConfirmInfo, isRectSel, promptFunc);\r\n    } catch (error) {\r\n      if (showInfoFunc) {\r\n        showInfoFunc(error)\r\n      }\r\n    }\r\n  };\r\n  \r\n  // 修改cad底图的实体元素，先通过修改样式的方式，使之在前端不可见。然后最后导出为dwg的时候，再从底图进行修改\r\n  export const modifyCadEntity = async (\r\n    map: Map, // 地图对象\r\n    draw: IDrawTool, // 绘图对象\r\n    updateMapStyleObj: any, // 通过 createUpdateMapStyleObj 获取\r\n    showInfoFunc?: Function, // 显示信息的函数名\r\n    dlgConfirmInfo?: Function, // 显示确认对话框的函数名\r\n    isRectSel?: boolean, /* 点选还是框选 */\r\n    promptFunc?: Function, // 显示函数。返回promise<string>\r\n  ) => {\r\n    try {\r\n      await editCadEntity(map, draw, updateMapStyleObj, \"modify\", showInfoFunc, dlgConfirmInfo, isRectSel, promptFunc);\r\n    } catch (error) {\r\n      if (showInfoFunc) {\r\n        showInfoFunc(error)\r\n      }\r\n    }\r\n  };\r\n  \r\n  // 复制cad底图的实体元素，先通过修改样式的方式，使之在前端不可见。然后最后导出为dwg的时候，再从底图进行修改\r\n  export const copyCadEntity = async (\r\n    map: Map, // 地图对象\r\n    draw: IDrawTool, // 绘图对象\r\n    updateMapStyleObj: any, // 通过 createUpdateMapStyleObj 获取\r\n    showInfoFunc?: Function, // 显示信息的函数名\r\n    dlgConfirmInfo?: Function, // 显示确认对话框的函数名\r\n    isRectSel?: boolean, /* 点选还是框选 */\r\n    promptFunc?: Function, // 显示函数。返回promise<string>\r\n  ) => {\r\n    try {\r\n      await editCadEntity(map, draw, updateMapStyleObj, \"copy\", showInfoFunc, dlgConfirmInfo, isRectSel, promptFunc);\r\n    } catch (error) {\r\n      if (showInfoFunc) {\r\n        showInfoFunc(error)\r\n      }\r\n    }\r\n  };\r\n  \r\n  \r\n// 创建一个几何对象\r\nexport const createGeomData = async (\r\n    map: Map, // 地图对象\r\n    entities: any = [], // 实体数组 或直接是 DbDocument 对象\r\n    docMapBounds: any = null, // 文档范围\r\n    environment: any = null, // 环境参数\r\n    linetypes: any = null, // 线型\r\n    dbFrom: any = null, // 数据来源\r\n    asFeatureCollection?: boolean // 查询的是一个实体的做为一个集合对象\r\n  ) => {\r\n    let doc: any;\r\n    let mapBounds: any;\r\n    if (Array.isArray(entities)) {\r\n      doc  = new vjmap.DbDocument();\r\n      if (environment) {\r\n        doc.environment = environment; // 文档环境\r\n      }\r\n      if (linetypes) {\r\n        doc.linetypes = linetypes; // 线型定义\r\n      }\r\n      let param = map.getService().currentMapParam() as any;\r\n      if (!docMapBounds) {\r\n        // 如果文档范围为空，则使用当前地图\r\n        if (!dbFrom) {\r\n          if (param.mapid) {\r\n            doc.from = `${param.mapid}/${param.version}`; // 从当前图\r\n          }\r\n        } else {\r\n          doc.from = typeof(dbFrom) == \"string\" ? dbFrom : `${dbFrom.mapid}/${dbFrom.version}`; // 从指定的图\r\n        }\r\n        doc.pickEntitys = entities.map((e: any) => e.objectid);\r\n      } else {\r\n        if (dbFrom) {\r\n          doc.from = dbFrom; // 从指定的图\r\n          doc.pickEntitys = entities.map((e: any) => e.objectid);\r\n        }\r\n      }\r\n      \r\n      doc.appendEntity(entities);\r\n      mapBounds = docMapBounds ? docMapBounds : param.bounds.toArray(); // 如果没有输入文档范围，则使用当前地图的范围\r\n      if (!doc.from && !docMapBounds) {\r\n          mapBounds = undefined; // 如果没有范围\r\n      }\r\n    } else {\r\n      doc = entities; // 直接是 DbDocument 对象\r\n      mapBounds = docMapBounds;\r\n    }\r\n    \r\n    let svc = map.getService();\r\n    let res = await svc.cmdCreateEntitiesGeomData({\r\n      filedoc: doc.toDoc(),\r\n      mapBounds: mapBounds\r\n    });\r\n    if (res.error) {\r\n      throw res.error;\r\n    }\r\n    const features = [];\r\n    if (res && res.result && res.result.length > 0) {\r\n      for (let ent of res.result) {\r\n        if (ent.geom && ent.geom.geometries) {\r\n          let clr = map.entColorToHtmlColor(ent.color); // 实体颜色转html颜色\r\n          let featureAttr: any = {};\r\n            // 因为要组合成一个组合实体，所以线和多边形的颜色得区分\r\n            if (ent.isPolygon) {\r\n              featureAttr.color = clr; // 填充色，只对多边形有效\r\n              featureAttr.noneOutline = true; // 不显示多边形边框，只对多边形有效\r\n            } else {\r\n              featureAttr.color = clr; // 颜色\r\n              featureAttr.line_width = ent.lineWidth; // 线宽\r\n            }\r\n\r\n          for (let g = 0; g < ent.geom.geometries.length; g++) {\r\n            if (ent.geom.geometries[g].type == \"Point\") {\r\n              // 改成起始和终点一样的线\r\n              ent.geom.geometries[g].type = \"LineString\";\r\n              ent.geom.geometries[g].coordinates = [\r\n                ent.geom.geometries[g].coordinates, // 始点\r\n                ent.geom.geometries[g].coordinates // 终点\r\n              ]\r\n            }\r\n          }\r\n          if (asFeatureCollection) {\r\n            let ft = {\r\n                id: ent.id,\r\n                type: \"Feature\",\r\n                properties: {\r\n                    objectid: ent.objectid,\r\n                    opacity: ent.alpha / 255,\r\n                    ...featureAttr,\r\n                },\r\n            }\r\n            if (ent.geom.geometries.length == 1) {\r\n                ft = {\r\n                    ...ft,\r\n                     // @ts-ignore\r\n                    geometry: ent.geom.geometries[0],\r\n                };\r\n            } else {\r\n                ft = {\r\n                    ...ft,\r\n                     // @ts-ignore\r\n                    geometry: {\r\n                        geometries: ent.geom.geometries,\r\n                        type: \"GeometryCollection\"\r\n                    },\r\n                };\r\n            }\r\n            // @ts-ignore\r\n            features.push(ft);\r\n          } else {\r\n            for (let g = 0; g < ent.geom.geometries.length; g++) {\r\n              features.push({\r\n                id: vjmap.RandomID(10),\r\n                type: \"Feature\",\r\n                properties: {\r\n                  objectid: ent.objectid,\r\n                  opacity: ent.alpha / 255,\r\n                  ...featureAttr,\r\n                },\r\n                geometry: ent.geom.geometries[g],\r\n              });\r\n            }\r\n          }\r\n          \r\n        }\r\n      }\r\n    }\r\n    return {\r\n      type: \"FeatureCollection\",\r\n      features: features,\r\n    };\r\n  };\r\n\r\n  // 加载数据至绘图对象\r\nexport const loadDataToDraw = async (map: Map, draw: IDrawTool, data: string, updateMapStyleObj: any) => {\r\n    data = JSON.parse(data);\r\n    draw.set(map.toLngLat(data));\r\n    if (map.hasVectorLayer()) {\r\n    const hideEntityIds =\r\n        getTrackFeatureProperty(draw, \"hideEntityIds\") || [];\r\n    if (hideEntityIds) {\r\n        await updateMapStyleObj.addHideObjectIds(hideEntityIds);\r\n    }\r\n    } else {\r\n    const hideEntityObjectIds =\r\n        getTrackFeatureProperty(draw, \"hideEntityObjectIds\") || [];\r\n    if (hideEntityObjectIds) {\r\n        await updateMapStyleObj.addHideObjectIds(hideEntityObjectIds);\r\n    }\r\n    }\r\n}","import vjmap, { GeoPoint, IDrawTool } from \"vjmap\";\r\nimport type { Map } from \"vjmap\";\r\nimport { exportDwg, addExportRefInfoInText } from \"./export\";\r\nimport { transformGeoJsonData } from \"../utils\";\r\nimport { createGeomData } from \"./entity\";\r\nexport { exportDwg };\r\nexport const setFeatureProperty = (\r\n  feature: any,\r\n  drawProperty?: Record<string, any>\r\n) => {\r\n  if (!drawProperty) return;\r\n  for (let p in drawProperty) {\r\n    feature.properties[p] = drawProperty[p];\r\n  }\r\n};\r\n\r\n// 取消绘制\r\nexport const cancelDraw = (map: Map) => {\r\n  // 给地图发送ESC键消息即可取消，模拟按ESC键\r\n  map.fire(\"keyup\", { keyCode: 27 });\r\n};\r\n\r\n// 绘制点\r\nexport const drawPoint = async (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>\r\n) => {\r\n  let ft = await vjmap.Draw.actionDrawPoint(map, options);\r\n  if (ft.cancel) {\r\n    return;\r\n  }\r\n  setFeatureProperty(ft.features[0], drawProperty);\r\n  // 设置属性\r\n  draw.add(ft.features[0]);\r\n};\r\n\r\n// 绘制线\r\nexport const drawLineSting = async (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>\r\n) => {\r\n  let ft = await vjmap.Draw.actionDrawLineSting(map, options);\r\n  if (ft.cancel) {\r\n    return;\r\n  }\r\n  setFeatureProperty(ft.features[0], drawProperty);\r\n  // 设置属性\r\n  draw.add(ft.features[0]);\r\n};\r\n\r\n// 绘制面\r\nexport const drawPolygon = async (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>\r\n) => {\r\n  let ft = await vjmap.Draw.actionDrawPolygon(map, options);\r\n  if (ft.cancel) {\r\n    return;\r\n  }\r\n  setFeatureProperty(ft.features[0], drawProperty);\r\n  // 设置属性\r\n  draw.add(ft.features[0]);\r\n};\r\n\r\n// 绘制拉伸\r\nexport const drawFillExrusion = async (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>\r\n) => {\r\n  let ft = await vjmap.Draw.actionDrawPolygon(map, options);\r\n  if (ft.cancel) {\r\n    return;\r\n  }\r\n  setFeatureProperty(ft.features[0], drawProperty);\r\n  // 设置属性\r\n  draw.add(ft.features[0]);\r\n};\r\n\r\n// 多边形转多段线实体\r\nexport const polygonToPolyline = (feature: any) => {\r\n  if (feature.geometry.type != \"Polygon\") return;\r\n  feature.geometry.type = \"LineString\";\r\n  // @ts-ignore\r\n  feature.geometry.coordinates = feature.geometry.coordinates[0];\r\n  return feature;\r\n};\r\n\r\n// 绘制圆\r\nexport const drawCircle = async (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>,\r\n  isFill?: boolean\r\n) => {\r\n  let ft = await vjmap.Draw.actionDrawCircle(map, options);\r\n  if (ft.cancel) {\r\n    return;\r\n  }\r\n  setFeatureProperty(ft.features[0], drawProperty);\r\n  if (!isFill) {\r\n    // 如果不是填充，则把多边形转成多段线\r\n    ft.features[0] = polygonToPolyline(ft.features[0]);\r\n    setFeatureProperty(ft.features[0], {\r\n      isCircle: undefined,\r\n    });\r\n  }\r\n  // 设置属性\r\n  draw.add(ft.features[0]);\r\n};\r\n\r\n// 绘制矩形\r\nexport const drawRectangle = async (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>,\r\n  isFill?: boolean\r\n) => {\r\n  let ft = await vjmap.Draw.actionDrawRectangle(map, options);\r\n  if (ft.cancel) {\r\n    return;\r\n  }\r\n  setFeatureProperty(ft.features[0], drawProperty);\r\n  if (!isFill) {\r\n    // 如果不是填充，则把多边形转成多段线\r\n    ft.features[0] = polygonToPolyline(ft.features[0]);\r\n  }\r\n  draw.add(ft.features[0]);\r\n};\r\n\r\n// 绘制斜矩形\r\nexport const drawSlantRectangle = async (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>,\r\n  isFill?: boolean\r\n) => {\r\n  let ft = await vjmap.Draw.actionDrawSlantRectangle(map, options);\r\n  if (ft.cancel) {\r\n    return;\r\n  }\r\n  setFeatureProperty(ft.features[0], drawProperty);\r\n  if (!isFill) {\r\n    // 如果不是填充，则把多边形转成多段线\r\n    ft.features[0] = polygonToPolyline(ft.features[0]);\r\n  }\r\n  draw.add(ft.features[0]);\r\n};\r\n\r\n// 选择多个实体进行旋转\r\nexport const selectRotate = async (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  showInfoFunc?: Function\r\n) => {\r\n  // 先进行选择，点右键确定选择\r\n  let selected = await vjmap.Draw.actionSelect(map, draw);\r\n  if (selected.features.length == 0) return; // 如果没有要选择的实体\r\n\r\n  if (showInfoFunc) showInfoFunc(\"请指定的旋转的基点\");\r\n  let basePointRes = await vjmap.Draw.actionDrawPoint(map, {});\r\n  if (basePointRes.cancel) {\r\n    return; // 取消操作\r\n  }\r\n  if (showInfoFunc) showInfoFunc(\"请指定要旋转的角度\");\r\n  let basePoint = basePointRes.features[0].geometry.coordinates;\r\n  let endPoint = basePoint;\r\n  // 可以做一条辅助线显示\r\n  let tempLine = new vjmap.Polyline({\r\n    data: [basePoint, endPoint],\r\n    lineColor: \"yellow\",\r\n    lineWidth: 1,\r\n    lineDasharray: [2, 2],\r\n  });\r\n  tempLine.addTo(map);\r\n\r\n  // 先把选择的复制下，用于取消还原\r\n  let oldSelected = vjmap.cloneDeep(selected.features);\r\n  let rotatePointRes = await vjmap.Draw.actionDrawPoint(map, {\r\n    ...options,\r\n    updatecoordinate: (e: any) => {\r\n      if (!e.lnglat) return;\r\n      endPoint = e.lnglat;\r\n      // 修改临时线坐标\r\n      tempLine.setData([basePoint, endPoint]);\r\n      let angle = map.fromLngLat(endPoint).angleTo(map.fromLngLat(basePoint));\r\n\r\n      let updateFeatures = vjmap.cloneDeep(oldSelected); // 先用之前保存的数据，不要用更新完的数据\r\n      // 修改选择的实体的坐标\r\n      for (let i = 0; i < updateFeatures.length; i++) {\r\n        let changeFeatures = vjmap.transform.convert(updateFeatures[i], (g) => {\r\n          let pt = map.fromLngLat(g);\r\n          let rotatePt = pt.roateAround(angle, map.fromLngLat(basePoint));\r\n          return map.toLngLat(rotatePt);\r\n        });\r\n        draw.setFeatureProperty(\r\n          updateFeatures[i].id,\r\n          \"coordinates\",\r\n          changeFeatures\r\n        );\r\n      }\r\n      draw.forceRefresh();\r\n    },\r\n  });\r\n  tempLine.remove(); //删除临时线\r\n  if (rotatePointRes.cancel) {\r\n    // 还原回来的\r\n    for (let i = 0; i < oldSelected.length; i++) {\r\n      draw.setFeatureProperty(oldSelected[i].id, \"coordinates\", oldSelected[i]);\r\n    }\r\n    draw.forceRefresh();\r\n    return; // 取消操作\r\n  }\r\n};\r\n\r\n// 转贝塞尔曲线\r\nexport const toBezierCurve = (map: Map, draw: IDrawTool) => {\r\n  let selected = draw\r\n    .getSelected()\r\n    .features.filter(\r\n      (e) => e.geometry.type == \"LineString\" || e.geometry.type == \"Polygon\"\r\n    );\r\n  if (selected.length == 0) return;\r\n  let preFeatures = vjmap.cloneDeep(selected);\r\n  for (let i = 0; i < selected.length; i++) {\r\n    let feature = selected[i] as any;\r\n    if (feature.geometry.type == \"LineString\") {\r\n      // 把曲线上的点转为贝塞尔曲线参数\r\n      const c = vjmap.polylineToBezierCurve(\r\n        map.fromLngLat(feature.geometry.coordinates).map((e: any) => [e.x, e.y])\r\n      );\r\n      // 据贝塞尔曲线参数离散成线\r\n      const curvePath = vjmap.bezierCurveToPolyline(c, 100);\r\n      draw.setFeatureProperty(\r\n        feature.id,\r\n        \"coordinates\",\r\n        map.toLngLat(curvePath)\r\n      );\r\n    } else {\r\n      let coordinates = [];\r\n      for (let p = 0; p < feature.geometry.coordinates.length; p++) {\r\n        // 把曲线上的点转为贝塞尔曲线参数\r\n        const c = vjmap.polylineToBezierCurve(\r\n          map\r\n            .fromLngLat(feature.geometry.coordinates[p])\r\n            .map((e: any) => [e.x, e.y])\r\n        );\r\n        // 据贝塞尔曲线参数离散成线\r\n        const curvePath = vjmap.bezierCurveToPolyline(c, 1000);\r\n        coordinates.push(map.toLngLat(curvePath));\r\n      }\r\n      draw.setFeatureProperty(feature.id, \"coordinates\", coordinates);\r\n    }\r\n  }\r\n  // 重新再获取一次所选择的实体数据\r\n  let newFeatures = draw\r\n    .getSelected()\r\n    .features.filter(\r\n      (e) => e.geometry.type == \"LineString\" || e.geometry.type == \"Polygon\"\r\n    );\r\n  // 用于撤销，重做\r\n  map.fire(\"draw.update\", {\r\n    action: \"toBezierCurve\",\r\n    features: vjmap.cloneDeep(newFeatures), // 更新后的数据\r\n    prevFeatures: preFeatures, // 更新前的数据\r\n    styleId: draw.options.styleId,\r\n  });\r\n  draw.changeMode(\"simple_select\");\r\n};\r\n\r\nconst drawEllipse = async (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>,\r\n  showInfoFunc?: Function,\r\n  isFill?: boolean,\r\n  isSetAngle?: boolean\r\n) => {\r\n  let centerPt = await vjmap.Draw.actionDrawPoint(map, {\r\n    ...options,\r\n  });\r\n  if (centerPt.cancel) {\r\n    return; // 取消操作\r\n  }\r\n  let center = map.fromLngLat(centerPt.features[0].geometry.coordinates);\r\n\r\n  let ellipse: any;\r\n  if (isFill) {\r\n    // @ts-ignore\r\n    ellipse = new vjmap.EllipseFill({\r\n      center: center,\r\n      majorAxisRadius: 0,\r\n      minorAxisRadius: 0,\r\n      fillColor: drawProperty?.color ?? \"green\",\r\n      fillOpacity: drawProperty?.opacity ?? 0.8,\r\n      fillOutlineColor: drawProperty?.outlineColor ?? \"#f00\",\r\n    });\r\n  } else {\r\n    // @ts-ignore\r\n    ellipse = new vjmap.EllipseEdge({\r\n      center: center,\r\n      majorAxisRadius: 0,\r\n      minorAxisRadius: 0,\r\n      lineColor: drawProperty?.outlineColor ?? \"red\",\r\n      lineWidth: drawProperty?.line_width ?? 3,\r\n    });\r\n  }\r\n  ellipse.addTo(map);\r\n\r\n  let ellipseMajorAxisPt = await vjmap.Draw.actionDrawPoint(map, {\r\n    ...options,\r\n    updatecoordinate: (e: any) => {\r\n      if (!e.lnglat) return;\r\n      const co = map.fromLngLat(e.lnglat);\r\n      ellipse.setMinorAxisRadius(center.distanceTo(co));\r\n      ellipse.setMajorAxisRadius(center.distanceTo(co));\r\n    },\r\n  });\r\n  if (ellipseMajorAxisPt.cancel) {\r\n    ellipse.remove();\r\n    return; // 取消操作\r\n  }\r\n\r\n  let ellipseMinorAxisPt = await vjmap.Draw.actionDrawPoint(map, {\r\n    ...options,\r\n    updatecoordinate: (e: any) => {\r\n      if (!e.lnglat) return;\r\n      const co = map.fromLngLat(e.lnglat);\r\n      ellipse.setMinorAxisRadius(center.distanceTo(co));\r\n    },\r\n  });\r\n  if (ellipseMinorAxisPt.cancel) {\r\n    ellipse.remove();\r\n    return; // 取消操作\r\n  }\r\n\r\n  if (isSetAngle) {\r\n    let ellipseStartPt = await vjmap.Draw.actionDrawPoint(map, {\r\n      ...options,\r\n      updatecoordinate: (e: any) => {\r\n        if (!e.lnglat) return;\r\n        const co = map.fromLngLat(e.lnglat);\r\n        ellipse.setStartAngle(vjmap.radiansToDegrees(co.angleTo(center)));\r\n      },\r\n    });\r\n    if (ellipseStartPt.cancel) {\r\n      ellipse.remove();\r\n      return; // 取消操作\r\n    }\r\n\r\n    let ellipseEndPt = await vjmap.Draw.actionDrawPoint(map, {\r\n      ...options,\r\n      updatecoordinate: (e: any) => {\r\n        if (!e.lnglat) return;\r\n        const co = map.fromLngLat(e.lnglat);\r\n        ellipse.setEndAngle(vjmap.radiansToDegrees(co.angleTo(center)));\r\n      },\r\n    });\r\n    if (ellipseEndPt.cancel) {\r\n      ellipse.remove();\r\n      return; // 取消操作\r\n    }\r\n  }\r\n\r\n  // 下面指定旋转角度\r\n  // 先获取所有椭圆的点，然后围绕椭圆圆心旋转一定角度\r\n  // 获取之前椭圆的点\r\n  let data = ellipse.getData();\r\n  let ellipseRotatePt = await vjmap.Draw.actionDrawPoint(map, {\r\n    ...options,\r\n    updatecoordinate: (e: any) => {\r\n      if (!e.lnglat) return;\r\n      // 然后围绕椭圆圆心旋转一定角度\r\n      const co = map.fromLngLat(e.lnglat);\r\n      let angle = co.angleTo(center);\r\n      let newData = vjmap.cloneDeep(data);\r\n      let coordinates;\r\n      if (isFill) {\r\n        coordinates = newData.features[0].geometry.coordinates[0];\r\n      } else {\r\n        coordinates = newData.features[0].geometry.coordinates;\r\n      }\r\n      for (let i = 0; i < coordinates.length; i++) {\r\n        let pt = map.fromLngLat(coordinates[i]);\r\n        pt = pt.roateAround(angle, center);\r\n        pt = map.toLngLat(pt);\r\n        coordinates[i] = pt; //修改原来的值\r\n      }\r\n      ellipse.setData(newData);\r\n    },\r\n  });\r\n  if (ellipseRotatePt.cancel) {\r\n    ellipse.remove();\r\n    return; // 取消操作\r\n  }\r\n\r\n  let feature = ellipse.getData().features[0]; // 获取数据\r\n  feature.id = vjmap.RandomID(10);\r\n  feature.properties = {\r\n    ...drawProperty,\r\n  };\r\n  draw.add(feature);\r\n  ellipse.remove(); // 移除临时绘制的\r\n};\r\n\r\n// 绘制填充椭圆\r\nexport const drawEllipseFill = (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>,\r\n  showInfoFunc?: Function\r\n) => {\r\n  drawEllipse(map, draw, options, drawProperty, showInfoFunc, true);\r\n};\r\n// 绘制椭圆\r\nexport const drawEllipseEdge = (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>,\r\n  showInfoFunc?: Function\r\n) => {\r\n  drawEllipse(map, draw, options, drawProperty, showInfoFunc, false);\r\n};\r\n\r\n// drawEllipseFillArc\r\nexport const drawEllipseFillArc = (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>,\r\n  showInfoFunc?: Function\r\n) => {\r\n  drawEllipse(map, draw, options, drawProperty, showInfoFunc, true, true);\r\n};\r\n// 绘制椭圆弧\r\nexport const drawEllipseArc = (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>,\r\n  showInfoFunc?: Function\r\n) => {\r\n  drawEllipse(map, draw, options, drawProperty, showInfoFunc, false, true);\r\n};\r\n\r\n// 获取一个geojson的外包矩形\r\nexport const getGeoJsonBounds = (data: any) => {\r\n  let pts: any = [];\r\n  vjmap.transform.convert(data, (pt) => {\r\n    pts.push(vjmap.geoPoint(pt));\r\n    return pt; // 只求范围，不做转化，返回原来的\r\n  });\r\n  let bounds = new vjmap.GeoBounds();\r\n  bounds.update(pts);\r\n  return bounds;\r\n};\r\n\r\n// 交互式创建CAD几何对象\r\nexport const interactiveCreateGeom = async (\r\n  data: any,\r\n  map: Map,\r\n  options?: Record<string, any>,\r\n  showInfoFunc?: Function,\r\n  param?: {\r\n    disableScale?: boolean /*禁止指定缩放 */;\r\n    disableRotate?: boolean /*禁止指定旋转 */;\r\n    drawInitPixelLength?: number /*绘制的初始在地图上的像素距离 */;\r\n    tempLineColor?: string /*绘制临时线的颜色 */;\r\n    baseAlign?: \"leftBottom\" | \"center\" | \"leftTop\" /*绘制的基点的位置方向 */;\r\n    keepGeoSize?: boolean /*保持原来的大小，不进行缩放至像素距离 */;\r\n    position?: GeoPoint /* 如果指定了位置，则不需交互拾取位置  */\r\n    scaleValue?: number /* 如果禁止指定缩放并且 指定了缩放倍数  */\r\n    angleValue?: number /* 如果禁止指定旋转并且 指定了旋转角度  */\r\n    unCombineFeature?: boolean /*  不组合成一个新实体 */\r\n  }\r\n) => {\r\n  const tempDraw = map.createDrawLayer(); // 创建一个临时的绘图图层\r\n  param = param ?? {};\r\n  // 取消操作\r\n  const cancelDraw = () => {\r\n    if (tempDraw) map.removeDrawLayer(tempDraw); // 把临时图层删除了\r\n    map.setIsInteracting(false);\r\n  };\r\n  try {\r\n    // 获取数据范围\r\n    let dataBounds = getGeoJsonBounds(data);\r\n    let geoDataBounds: any;\r\n    let drawData;\r\n    if (param.keepGeoSize !== true) {\r\n      //  先获取地图的中心点\r\n      let basePt = map.fromLngLat(map.getCenter());\r\n      // 要生成的像素大小\r\n      let length = map.pixelToGeoLength(\r\n        param.drawInitPixelLength ?? 100,\r\n        map.getZoom()\r\n      );\r\n      let dataGeoBounds = map.fromLngLat(dataBounds);\r\n      let scalex = length / dataGeoBounds.width(); // 缩放的比例\r\n      let scaley = length / dataGeoBounds.height(); // 缩放的比例\r\n      let dblScale = Math.min(scalex, scaley);\r\n      if (vjmap.isZero(dblScale)) dblScale = 1.0;\r\n\r\n      let basePoint = dataBounds.center();\r\n      if (param.baseAlign == \"leftBottom\") {\r\n        basePoint = dataBounds.min;\r\n      } else if (param.baseAlign == \"leftTop\") {\r\n        basePoint = vjmap.geoPoint([dataBounds.min.x, dataBounds.max.y]);\r\n      }\r\n      drawData = transformGeoJsonData(\r\n        map,\r\n        vjmap.cloneDeep(data),\r\n        map.fromLngLat(basePoint),\r\n        basePt,\r\n        dblScale\r\n      );\r\n      \r\n    } else {\r\n      // 把数据增加至临时绘图层\r\n      drawData = data;\r\n    }\r\n    geoDataBounds = map.fromLngLat(getGeoJsonBounds(drawData)); // 获取当前绘制的数据几何范围\r\n    let geoCenter = geoDataBounds.center(); // 获取当前绘制的数据几何中心点\r\n    if (param.baseAlign == \"leftBottom\") {\r\n      geoCenter = geoDataBounds.min;\r\n    } else if (param.baseAlign == \"leftTop\") {\r\n      geoCenter = vjmap.geoPoint([geoDataBounds.min.x, geoDataBounds.max.y]);\r\n    }\r\n    // 把数据增加至临时绘图层\r\n    if (param.unCombineFeature) {\r\n      tempDraw.set(drawData);\r\n    } else {\r\n      addFeaturesToDraw(drawData, tempDraw);\r\n    }\r\n    \r\n    let oldData = vjmap.cloneDeep(tempDraw.getAll()); // 复制下以前的数据\r\n    let destPt: any;\r\n    if (param.position) {\r\n      tempDraw.deleteAll();\r\n      const co = param.position;\r\n      let drawData = transformGeoJsonData(\r\n        map,\r\n        vjmap.cloneDeep(oldData),\r\n        geoCenter,\r\n        co\r\n      );\r\n      tempDraw.set(drawData); // 设置成新的数据\r\n      destPt = param.position;\r\n    } else {\r\n      if (showInfoFunc) {\r\n        showInfoFunc(\"请移动鼠标至指定位置点击进行绘制\");\r\n      }\r\n  \r\n      // 设置地图正在交互\r\n      map.setIsInteracting(true);\r\n  \r\n      let drawDestPt = await vjmap.Draw.actionDrawPoint(map, {\r\n        ...options,\r\n        updatecoordinate: (e: any) => {\r\n          if (!e.lnglat) return;\r\n          tempDraw.deleteAll();\r\n          const co = map.fromLngLat(e.lnglat);\r\n          let drawData = transformGeoJsonData(\r\n            map,\r\n            vjmap.cloneDeep(oldData),\r\n            geoCenter,\r\n            co\r\n          );\r\n          tempDraw.set(drawData); // 设置成新的数据\r\n        },\r\n      });\r\n      if (drawDestPt.cancel) {\r\n        cancelDraw();\r\n        return; // 取消操作\r\n      }\r\n      destPt = map.fromLngLat(drawDestPt.features[0].geometry.coordinates);\r\n    }\r\n   \r\n    // 下面获取缩放系数\r\n    // 可以做一条辅助线显示\r\n    let tempLine: any;\r\n    if (!param.disableScale || !param.disableRotate) {\r\n      tempLine = new vjmap.Polyline({\r\n        data: map.toLngLat([destPt, destPt]),\r\n        lineColor: param.tempLineColor ?? \"yellow\",\r\n        lineWidth: 1,\r\n        lineDasharray: [2, 2],\r\n      });\r\n      tempLine.addTo(map);\r\n    }\r\n   \r\n    let scale = 1.0;\r\n    if (!param.disableScale) {\r\n      let drawScalePoint = await vjmap.Draw.actionDrawPoint(map, {\r\n        ...options,\r\n        updatecoordinate: (e: any) => {\r\n          tempDraw.deleteAll();\r\n          if (!e.lnglat) return;\r\n          const co = map.fromLngLat(e.lnglat);\r\n          let dist = co.distanceTo(destPt);\r\n          let scale = dist / (geoDataBounds.width() / 2.0);\r\n          let drawData = transformGeoJsonData(\r\n            map,\r\n            vjmap.cloneDeep(oldData),\r\n            geoCenter,\r\n            destPt,\r\n            scale\r\n          );\r\n          tempDraw.set(drawData); // 设置成新的数据\r\n          // 修改临时线坐标\r\n          tempLine.setData(map.toLngLat([destPt, co]));\r\n        },\r\n      });\r\n\r\n      if (drawScalePoint.cancel) {\r\n        if (drawScalePoint.isEnterKey) {\r\n          // 如果是按回车键。不是按ESC键取消的，就用默认值\r\n          scale = 1.0;\r\n        } else {\r\n          // ESC键取消的\r\n          cancelDraw();\r\n          tempLine.remove(); // 绘制完成，删除\r\n          return; // 取消操作\r\n        }\r\n      } else {\r\n        // 已经获取了缩放系数\r\n        let scalePt = map.fromLngLat(\r\n          drawScalePoint.features[0].geometry.coordinates\r\n        );\r\n        let dist = scalePt.distanceTo(destPt);\r\n        scale = dist / (geoDataBounds.width() / 2.0);\r\n        if (scale < 0.0001) scale = 0.1;\r\n      }\r\n      tempLine.setData(map.toLngLat([destPt, destPt]));\r\n    } else {\r\n      scale = param.scaleValue ?? 1;\r\n      tempDraw.deleteAll();\r\n      let drawData = transformGeoJsonData(\r\n        map,\r\n        vjmap.cloneDeep(oldData),\r\n        geoCenter,\r\n        destPt,\r\n        scale\r\n      );\r\n      tempDraw.set(drawData); // 设置成新的数据\r\n    }\r\n\r\n    let angle = 0;\r\n    if (!param.disableRotate) {\r\n      // 下面获取旋转系数\r\n      let drawRotatePoint = await vjmap.Draw.actionDrawPoint(map, {\r\n        ...options,\r\n        updatecoordinate: (e: any) => {\r\n          tempDraw.deleteAll();\r\n          if (!e.lnglat) return;\r\n          const co = map.fromLngLat(e.lnglat);\r\n          angle = (co.angleTo(destPt) * 180.0) / Math.PI;\r\n          let drawData = transformGeoJsonData(\r\n            map,\r\n            vjmap.cloneDeep(oldData),\r\n            geoCenter,\r\n            destPt,\r\n            scale,\r\n            angle\r\n          );\r\n          tempDraw.set(drawData); // 设置成新的数据\r\n          // 修改临时线坐标\r\n          tempLine.setData(map.toLngLat([destPt, co]));\r\n        },\r\n      });\r\n      tempLine.remove(); // 绘制完成，删除\r\n      if (drawRotatePoint.cancel) {\r\n        if (!drawRotatePoint.isEnterKey) {\r\n          // ESC键取消的\r\n          cancelDraw();\r\n          return; // 取消操作\r\n        }\r\n        // 不设置旋转默认为0\r\n        angle = 0;\r\n        let drawData = transformGeoJsonData(\r\n          map,\r\n          vjmap.cloneDeep(oldData),\r\n          geoCenter,\r\n          destPt,\r\n          scale,\r\n          angle\r\n        );\r\n        tempDraw.set(drawData);\r\n      }\r\n    }  else {\r\n      angle = param.angleValue ?? 0;\r\n      tempDraw.deleteAll();\r\n      let drawData = transformGeoJsonData(\r\n        map,\r\n        vjmap.cloneDeep(oldData),\r\n        geoCenter,\r\n        destPt,\r\n        scale,\r\n        angle\r\n      );\r\n      tempDraw.set(drawData); // 设置成新的数据\r\n    }\r\n    map.setIsInteracting(false);\r\n\r\n    // 把临时绘图层的数据加至当前地图绘制图层中\r\n    let drawFeatures = tempDraw.getAll() as any;\r\n    map.removeDrawLayer(tempDraw);\r\n    return {\r\n      feature: drawFeatures,\r\n      rotation: angle,\r\n    };\r\n  } catch (e: any) {\r\n    cancelDraw();\r\n    if (showInfoFunc) showInfoFunc(e?.message ?? e);\r\n  }\r\n};\r\n\r\n// 交互式创建箭头\r\nexport const drawArrow = async (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>,\r\n  showInfoFunc?: Function,\r\n  param?: Record<string, any>\r\n) => {\r\n  param = param || {};\r\n  let linetype = new vjmap.DbLineType();\r\n  linetype.name = \"my_arrow_dash\";\r\n  linetype.comments = \"虚线\";\r\n\r\n  linetype.style = [\r\n    {\r\n      method: \"numDashes\", //组成线型的笔画数目\r\n      parameter: 4,\r\n    },\r\n    {\r\n      method: \"patternLength\", // 线型总长度\r\n      parameter: 1.0,\r\n    },\r\n    {\r\n      method: \"dashLengthAt\", //0.5个单位的划线\r\n      parameter: [0, 0.5],\r\n    },\r\n    {\r\n      method: \"dashLengthAt\", //0.25个单位的空格\r\n      parameter: [1, -0.2],\r\n    },\r\n    {\r\n      method: \"dashLengthAt\", //0.1个单位的划线 (如果是一个点的话，则输入0即可）\r\n      parameter: [2, 0.1],\r\n    },\r\n    {\r\n      method: \"dashLengthAt\", //0.25个单位的空格\r\n      parameter: [3, -0.2],\r\n    },\r\n  ] as any;\r\n  let entities = [];\r\n\r\n  let points = param.arrowShape ?? [\r\n    [10, 60],\r\n    [150, 20],\r\n    [140, 40],\r\n    [190, 0],\r\n    [140, -40],\r\n    [150, -20],\r\n    [10, -40],\r\n    [10, 60],\r\n  ];\r\n  let bounds = vjmap.getGeoBounds(points.map((p: any) => vjmap.geoPoint(p)));\r\n  let docBounds = bounds.scale(3).toArray(); // [0, -100, 200, 100]; // 文档坐标范围，可以根据需要自己定。保证下面绘制的实体在此范围内\r\n  let polyline = new vjmap.DbPolyline();\r\n  polyline.lineWidth = param.lineWidth ?? 50;\r\n  // @ts-ignore\r\n  polyline.points = points;\r\n  if (!param.noLineType) {\r\n    // 可以是实线的话，可以不用设置线型\r\n    polyline.linetype = \"my_arrow_dash\"; //线型名称是上面定义的\r\n    polyline.linetypeScale = 30; // 线型比例放大30倍\r\n  }\r\n  polyline.color = map.htmlColorToEntColor(\r\n    drawProperty?.outlineColor ?? vjmap.randomColor()\r\n  );\r\n\r\n  let fillColor = drawProperty?.color ?? vjmap.randomColor();\r\n  let hatch = new vjmap.DbHatch();\r\n  hatch.pattern = \"SOLID\";\r\n  hatch.color = map.htmlColorToEntColor(fillColor);\r\n  // @ts-ignore\r\n  hatch.points = points;\r\n  hatch.alpha = 100 * (drawProperty?.opacity ?? 1.0);\r\n\r\n  entities.push(polyline, hatch);\r\n  if (!param.noText) {\r\n    let text = new vjmap.DbText({\r\n      position: param.textPositon ?? [100, 70],\r\n      contents: param.contents ?? \"箭头\",\r\n      color: map.htmlColorToEntColor(fillColor),\r\n      horizontalMode: 4,\r\n      height: param.textHeight ?? 20,\r\n    });\r\n    entities.push(text);\r\n  }\r\n\r\n  let linetypes = [linetype]; //要创建的线型\r\n\r\n  let data = await createGeomData(\r\n    map,\r\n    entities,\r\n    docBounds,\r\n    { LWDISPLAY: true },\r\n    linetypes\r\n  ); // 显示线宽\r\n\r\n  let res = await interactiveCreateGeom(data, map, options, showInfoFunc);\r\n  if (!res) return;\r\n  draw.add(res?.feature); // 加至地图当前绘制的图层中\r\n};\r\n\r\n// 创建有线型的线段\r\nexport const createLineTypePolyline = async (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>,\r\n  showInfoFunc?: Function,\r\n  param?: Record<string, any>\r\n) => {\r\n  param = param || {};\r\n  let coordinate;\r\n\r\n  // 直接指定坐标\r\n  if (param.coordinates) {\r\n    coordinate = param.coordinates;\r\n  } else {\r\n    // 先交互式绘制线段\r\n    let drawLine = await vjmap.Draw.actionDrawLineSting(map, {\r\n      ...options,\r\n    });\r\n    if (drawLine.cancel) {\r\n      return; // 取消了\r\n    }\r\n    coordinate = map.fromLngLat(drawLine.features[0].geometry.coordinates);\r\n  }\r\n  let dbEnt: any = {};\r\n  // @ts-ignore\r\n  dbEnt.objectid = param.objectid; // 表示要修改此实体 sys_symbols图中的objectid\r\n  if (drawProperty?.color) {\r\n    dbEnt.color = vjmap.htmlColorToEntColor(\r\n      drawProperty?.color\r\n    );\r\n  }\r\n  if (param.linetypeScale ) {\r\n    dbEnt.linetypeScale = param.linetypeScale\r\n  }\r\n \r\n  if (param.isCurve) {\r\n    if (param.curveUseControlPoints) {\r\n      dbEnt.controlPoints = coordinate.map((p: any) => {\r\n        return [p.x, p.y];\r\n      }); // 拟合点 用fitPoints; 控制点 用 controlPoints\r\n    } else {\r\n      dbEnt.fitPoints = coordinate.map((p: any) => {\r\n        return [p.x, p.y];\r\n      }); // 拟合点 用fitPoints; 控制点 用 controlPoints\r\n    }\r\n  } else {\r\n    dbEnt.points = coordinate.map((p: any) => {\r\n      return [p.x, p.y];\r\n    });\r\n  }\r\n\r\n  if (dbEnt) {\r\n    let data = await createGeomData(map, [dbEnt], null, null, null, {\r\n      mapid: param.mapid, // 上面的要修改的实体，来源于此图id\r\n      version: param.version ?? \"v1\",\r\n    });\r\n    addFeaturesToDraw(data, draw);\r\n  }\r\n};\r\n\r\nconst throttle = (method: Function, delay: number, duration: number) => {\r\n  let timer: any = null;\r\n  let begin = new Date();\r\n  return function () {\r\n    // @ts-ignore\r\n    let context: any = this;\r\n    let args: any = arguments;\r\n    let current = new Date();\r\n    clearTimeout(timer);\r\n    // @ts-ignore\r\n    if (current - begin >= duration) {\r\n      method.apply(context, args);\r\n      begin = current;\r\n    } else {\r\n      timer = setTimeout(function () {\r\n        method.apply(context, args);\r\n      }, delay);\r\n    }\r\n  };\r\n};\r\n\r\nexport const createLineTypeCurve = async (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>,\r\n  showInfoFunc?: Function,\r\n  param?: Record<string, any>\r\n) => {\r\n  param = param ?? {};\r\n  // 先交互式绘制线段\r\n  let color = vjmap.htmlColorToEntColor(\r\n    drawProperty?.color ?? vjmap.randomColor()\r\n  );\r\n  const createCurve = async (coordinate: any, color: any) => {\r\n    let dbEnt: any = {}; // 也可以直接赋属性也行不要new对象,只不过没有参数提示了\r\n    dbEnt.objectid = param?.objectid ?? \"40E\"; // 表示要修改此实体 sys_symbols图中的objectid\r\n    dbEnt.color = color;\r\n    dbEnt.linetypeScale = param?.linetypeScale ?? 100; // 线型比例\r\n    // 如果要修改坐标，请用下面的代码，此示例演示还是用以前的坐标数据\r\n    dbEnt.fitPoints = coordinate.map((p: any) => {\r\n      return [p.x, p.y];\r\n    }); // 拟合点 用fitPoints; 控制点 用 controlPoints\r\n\r\n    if (dbEnt) {\r\n      return await createGeomData(map, [dbEnt], null, null, null, {\r\n        mapid: param?.mapid ?? \"sys_symbols\", // 上面的要修改的实体，来源于此图id\r\n        version: param?.version ?? \"v1\",\r\n      });\r\n    }\r\n  };\r\n\r\n  let tempDraw: any = map.createDrawLayer(); // 创建一个临时的绘图图层\r\n  let drawLine = await vjmap.Draw.actionDrawLineSting(map, {\r\n    ...options,\r\n    updatecoordinate: throttle(\r\n      async (e: any) => {\r\n        let coordinate = map.fromLngLat(e.feature.coordinates);\r\n        let data = await createCurve(coordinate, color);\r\n        if (tempDraw) tempDraw.set(data);\r\n      },\r\n      200,\r\n      300\r\n    ),\r\n  });\r\n  map.removeDrawLayer(tempDraw); // 把临时图层删除了\r\n  tempDraw = null;\r\n  if (drawLine.cancel) {\r\n    return; // 取消了\r\n  }\r\n  let coordinate = map.fromLngLat(drawLine.features[0].geometry.coordinates);\r\n  let data = await createCurve(coordinate, color);\r\n  if (data) {\r\n    addFeaturesToDraw(data, draw);\r\n  }\r\n};\r\n\r\nexport const createHatch = async (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>,\r\n  showInfoFunc?: Function,\r\n  param?: Record<string, any>\r\n) => {\r\n  param = param ?? {};\r\n  let coordinate;\r\n  if (param.coordinates) // 直接指定坐标 \r\n  {\r\n    coordinate = param.coordinates;\r\n  }\r\n  else {\r\n    let drawPolygon = await vjmap.Draw.actionDrawPolygon(map, {\r\n      ...options,\r\n    });\r\n    if (drawPolygon.cancel) {\r\n      return; // 取消了\r\n    }\r\n  \r\n    coordinate  = map.fromLngLat(\r\n      drawPolygon.features[0].geometry.coordinates[0]\r\n    );\r\n  }\r\n  \r\n  let dbEnt = new vjmap.DbHatch();\r\n  // @ts-ignore\r\n  dbEnt.objectid = param.objectid ?? \"42F\"; // 表示要修改此实体 sys_symbols图中的objectid\r\n  if (drawProperty?.color) {\r\n    dbEnt.color = vjmap.htmlColorToEntColor(\r\n      drawProperty?.color\r\n    );\r\n  }\r\n  if (param.patternScale) {\r\n    dbEnt.patternScale = param.patternScale; // 填充比例\r\n  }\r\n \r\n  // 如果要修改坐标，请用下面的代码，此示例演示还是用以前的坐标数据\r\n  dbEnt.points = coordinate.map((p: any) => {\r\n    return [p.x, p.y];\r\n  });\r\n\r\n  if (dbEnt) {\r\n    let data = await createGeomData(map, [dbEnt], null, null, null, {\r\n      mapid: param.mapid ?? \"sys_symbols\", // 上面的要修改的实体，来源于此图id\r\n      version: param.version ?? \"v1\",\r\n    });\r\n    addFeaturesToDraw(data, draw);\r\n  }\r\n};\r\n\r\n// 从后台查询几何数据\r\nexport const getQueryGeomData = async (\r\n  map: Map,\r\n  queryParam: any,\r\n  propData?: Record<string, any>\r\n) => {\r\n  propData = propData ?? {};\r\n  let res = await map.getService().conditionQueryFeature({\r\n    fields: \"\",\r\n    includegeom: true, // 是否返回几何数据,为了性能问题，realgeom为false时，如果返回条数大于1.只会返回每个实体的外包矩形，如果条数为1的话，会返回此实体的真实geojson；realgeom为true时每条都会返回实体的geojson\r\n    realgeom: true,\r\n    limit: 10000, //设置很大，相当于把所有的圆都查出来。不传的话，默认只能取100条\r\n    ...queryParam,\r\n  });\r\n  const features = [];\r\n  if (res && res.result && res.result.length > 0) {\r\n    for (let ent of res.result) {\r\n      if (ent.geom && ent.geom.geometries) {\r\n        let clr = map.entColorToHtmlColor(ent.color); // 实体颜色转html颜色\r\n        for (let g = 0; g < ent.geom.geometries.length; g++) {\r\n          features.push({\r\n            id: vjmap.RandomID(10),\r\n            type: \"Feature\",\r\n            properties: {\r\n              objectid: ent.objectid + \"_\" + g,\r\n              color: clr,\r\n              alpha: ent.alpha / 255,\r\n              opacity: ent.alpha / 255,\r\n              lineWidth: 1,\r\n              name: ent.name,\r\n              isline: ent.isline,\r\n              layerindex: ent.layerindex,\r\n              ...propData, // 把额外的属性数据加上\r\n            },\r\n            geometry: ent.geom.geometries[g],\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return {\r\n    type: \"FeatureCollection\",\r\n    features: features,\r\n  };\r\n};\r\n\r\n// 创建外部符号\r\nexport const createOutSymbol = async (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>,\r\n  showInfoFunc?: Function,\r\n  param?: Record<string, any>\r\n) => {\r\n  param = param ?? {};\r\n  if (showInfoFunc)\r\n    showInfoFunc(\"请移动鼠标将要绘制的符号移动至指定位置点击进行绘制\");\r\n  let symbolMapId = param.mapid ?? \"sys_symbols\";\r\n  let symbolMapVer = param.version ?? \"v1\";\r\n  let svc = map.getService();\r\n  let styleName = await svc.getStyleLayerName(symbolMapId, symbolMapVer, true);\r\n  // 获取到的数据，如果条件不变，建议加上缓存，不要每次去后台获取，这里演示就直接每次去获取了\r\n  let data = await getQueryGeomData(\r\n    map,\r\n    {\r\n      mapid: symbolMapId,\r\n      version: symbolMapVer,\r\n      layer: styleName,\r\n      condition: param.condition ?? \"layerindex=1\", // 只需要写sql语句where后面的条件内容,字段内容请参考文档\"服务端条件查询和表达式查询\"\r\n      simplifyTolerance: param.simplifyTolerance\r\n    },\r\n    {\r\n      symbolId: vjmap.RandomID(),\r\n    }\r\n  );\r\n\r\n  let res = await interactiveCreateGeom(data, map, options, showInfoFunc, {\r\n    ...drawProperty,\r\n    baseAlign: \"center\",\r\n    position: param.position,\r\n    angleValue: param.angleValue,\r\n    scaleValue: param.scaleValue\r\n  });\r\n  if (!res) return;\r\n  let innerProps = new Set([\"disableScale\", \"disableRotate\", \"drawInitPixelLength\", \"tempLineColor\", \"baseAlign\", \"keepGeoSize\", \"position\", \"scaleValue\", \"angleValue\", \"unCombineFeature\"])\r\n  if (drawProperty?.unCombineFeature) {\r\n    let ids: any = []\r\n    for(let i = 0; i < res.feature.features.length; i++) {\r\n      let addFeatureID = res.feature.features[i].id as string;\r\n      ids.push(addFeatureID);\r\n      draw.add(res.feature.features[i]);\r\n      for (let prop in drawProperty) {\r\n        if (innerProps.has(prop)) continue;\r\n        draw.setFeatureProperty(addFeatureID, prop, drawProperty[prop]);\r\n      }\r\n    }\r\n    return ids;\r\n  } else {\r\n    addFeaturesToDraw(res.feature, draw);\r\n    let features = draw.getAll().features;\r\n    let addFeatureID = features[features.length - 1].id as string;\r\n    for (let prop in drawProperty) {\r\n      if (innerProps.has(prop)) continue;\r\n      draw.setFeatureProperty(addFeatureID, prop, drawProperty[prop]);\r\n    }\r\n    return [addFeatureID]\r\n  }\r\n};\r\n\r\n// 绘制文本\r\nexport const drawText = async (\r\n  map: Map,\r\n  draw: IDrawTool,\r\n  options?: Record<string, any>,\r\n  drawProperty?: Record<string, any>,\r\n  showInfoFunc?: Function,\r\n  disableInteractive?: boolean,\r\n  docBounds?: [number, number, number, number]\r\n): Promise<any> => {\r\n  drawProperty = drawProperty || {};\r\n  if (!drawProperty.text) return;\r\n  docBounds = docBounds ?? [-1000, -1000, 1000, 1000]; // 文档坐标范围，可以根据需要自己定，但要保证是正方形。保证下面绘制的实体在此范围内\r\n\r\n  let entities = [];\r\n  let textAttr: Record<string, any> = {\r\n    position: [0, 0],\r\n    contents: drawProperty.text,\r\n    color: map.htmlColorToEntColor(drawProperty.color),\r\n    horizontalMode: vjmap.DbTextHorzMode.kTextLeft,\r\n    verticalMode: vjmap.DbTextVertMode.kTextBottom,\r\n    height: drawProperty.height || 50,\r\n  };\r\n \r\n  let text = new vjmap.DbText(textAttr);\r\n  entities.push(text);\r\n\r\n  let data = await createGeomData(map, entities, docBounds); // 显示线宽\r\n  const docProj = new vjmap.GeoProjection(vjmap.GeoBounds.fromArray(docBounds));\r\n  // 需要取数据上的二个点做为参考点，如果以后要导出dwg的时候，创建文字的时候，计算旋转和缩放系数，用来确定文字的位置和高度属性\r\n  let props = addExportRefInfoInText(docProj, data); // 相对于创建文档的参考点坐标\r\n  let refInfo = addExportRefInfoInText(map, data);// 相对于当前地图的参考点坐标\r\n  textAttr = { ...textAttr, ...props, mapRefCo1: refInfo.refCo1, mapRefCo2: refInfo.refCo2 };\r\n\r\n  if (disableInteractive === true) {\r\n    // 如果是直接返回刚创建的，不用交互\r\n    const tempDraw = map.createDrawLayer(); \r\n    addFeaturesToDraw(data, tempDraw);\r\n    let geojson = tempDraw.getAll();\r\n    let features = geojson.features;\r\n    map.removeDrawLayer(tempDraw);\r\n    if (features.length > 0) {\r\n      features[0].properties = features[0].properties ?? {};\r\n      features[0].properties.export = textAttr;\r\n    }\r\n    return geojson;\r\n  }\r\n\r\n  let res = await interactiveCreateGeom(data, map, options, showInfoFunc, {\r\n    ...drawProperty,\r\n    baseAlign: \"leftBottom\",\r\n    drawInitPixelLength: drawProperty.height ?? 50,\r\n    disableRotate: drawProperty?.disableRotate,\r\n    disableScale: drawProperty?.disableScale,\r\n  });\r\n  if (!res) return;\r\n  res.feature.features[0].properties = res.feature.features[0].properties ?? {};\r\n  res.feature.features[0].properties.export = textAttr;\r\n  draw.add(res.feature); // 加至地图当前绘制的图层中\r\n};\r\n\r\n// 增加绘图对象，并组合成一个实体\r\nexport const addFeaturesToDraw = (\r\n  data: any,\r\n  drawLayer: any,\r\n  combineInObject?: boolean /*按objectid合成一个组*/\r\n) => {\r\n  const objectIdSet = new Set();\r\n  if (combineInObject) {\r\n    // 按objectid合成一个组\r\n    data.features.forEach((feature: any) => {\r\n      if (feature && feature.properties && feature.properties.objectid) {\r\n        objectIdSet.add(feature.properties.objectid);\r\n      }\r\n    });\r\n  }\r\n  if (!combineInObject || objectIdSet.size == 0) {\r\n    let addFeatureIds: any = [];\r\n    data.features.forEach((feature: any) => {\r\n      addFeatureIds.push(...drawLayer.add(feature));\r\n    });\r\n    // 先选中此实体\r\n    drawLayer.changeMode(\"simple_select\", { featureIds: addFeatureIds });\r\n    // 然后组合成一个\r\n    try {\r\n      // 忽略合并中的错误\r\n      drawLayer.combineFeatures();\r\n      // @ts-ignore\r\n    } catch (error) {}\r\n    return addFeatureIds.length;\r\n  } else {\r\n    // 按objectid合成一个组\r\n    // 获取所有的objectid\r\n    let oldSize = drawLayer.getAll().features.length;\r\n    for (let objectid of objectIdSet) {\r\n      let addFeatureIds: any = [];\r\n      data.features.forEach((feature: any) => {\r\n        if (feature.properties.objectid == objectid) {\r\n          addFeatureIds.push(...drawLayer.add(feature));\r\n        }\r\n      });\r\n      if (addFeatureIds.length == 0) continue;\r\n      // 先选中此实体\r\n      drawLayer.changeMode(\"simple_select\", { featureIds: addFeatureIds });\r\n      // 然后组合成一个\r\n      try {\r\n        // 忽略合并中的错误\r\n        drawLayer.combineFeatures();\r\n        // @ts-ignore\r\n      } catch (error) {}\r\n    }\r\n    let featureIds: any = [];\r\n    let drawFeatures = drawLayer.getAll().features;\r\n    for (let k = oldSize; k < drawFeatures.length; k++) {\r\n      featureIds.push(drawFeatures[k].id);\r\n    }\r\n    drawLayer.changeMode(\"simple_select\", { featureIds: featureIds });\r\n    return objectIdSet.size;\r\n  }\r\n};\r\n\r\n// 获取点的半径为1个像素的缺省绘制样式。\r\nexport const getPointOnePixelDrawStyleOption = () => {\r\n  const opts = vjmap.Draw.defaultOptions();\r\n  // 修改默认样式，把点的半径改成1，没有边框，默认为5\r\n  let pointIdx = opts.styles.findIndex(\r\n    (s: any) => s.id === \"gl-draw-point-point-stroke-inactive\"\r\n  );\r\n  if (pointIdx >= 0) {\r\n    opts.styles[pointIdx][\"paint\"][\"circle-radius\"][3][3] = 0;\r\n  }\r\n  pointIdx = opts.styles.findIndex(\r\n    (s: any) => s.id === \"gl-draw-point-inactive\"\r\n  );\r\n  if (pointIdx >= 0) {\r\n    opts.styles[pointIdx][\"paint\"][\"circle-radius\"][3][3] = 1;\r\n  }\r\n  pointIdx = opts.styles.findIndex(\r\n    (s: any) => s.id === \"gl-draw-point-stroke-active\"\r\n  );\r\n  if (pointIdx >= 0) {\r\n    opts.styles[pointIdx][\"paint\"][\"circle-radius\"][3] = 0;\r\n  }\r\n  pointIdx = opts.styles.findIndex((s: any) => s.id === \"gl-draw-point-active\");\r\n  if (pointIdx >= 0) {\r\n    opts.styles[pointIdx][\"paint\"][\"circle-radius\"][3] = 1;\r\n  }\r\n  return opts;\r\n};\r\n","import vjmap, { Map } from \"vjmap\";\r\n\r\n// 切换cad图层\r\nexport const switchCadLayers = async (map: Map, layers: {name: string; isOff: boolean}[], isVectorStyle: boolean) => {\r\n  let svc = map.getService();\r\n  if (isVectorStyle) {\r\n    // 如果是矢量瓦片\r\n    let onLayers = layers.reduce((sum, val) => {\r\n      if (!val.isOff) {\r\n        // @ts-ignore\r\n        sum.push(val.name);\r\n      }\r\n      return sum;\r\n    }, []); // 要开的图层\r\n    switchVectorLayers(map, onLayers);\r\n  } else {\r\n    // 如果是栅格瓦片\r\n    await map.switchLayers(svc, layers.reduce((sum, val) => {\r\n      if (!val.isOff) {\r\n        // @ts-ignore\r\n        sum.push(val.name);\r\n      }\r\n      return sum;\r\n    }, []))\r\n  }\r\n}\r\n\r\n// 矢量瓦片切换图层 onLayers 要显示的图层名称数组\r\nexport const switchVectorLayers = (map: Map, onLayers: string[]) => {\r\n  // 通过图层名称来查找图层id\r\n  const getLayerIdByName = (name: string) => {\r\n    return svc.getMapLayers().findIndex(layer => layer.name === name)\r\n  }\r\n  // 增加实体图层判断条件,只要满足任何一种类型即可,如 ['图层一','图层二']\r\n  const conditionLayers = (layers: string[], inputIsIndex: boolean) => {\r\n    if (!Array.isArray(layers)) layers = [layers];// 先转成数组，再统一用数组去算吧\r\n    let layerIndexs: number[] = [];\r\n    if (!inputIsIndex) {\r\n      // 如果输入的不是图层索引，是图层名称，则需要转成图层索引\r\n      layerIndexs = layers.map(layer => getLayerIdByName(layer)); // 把图层名称转为图层索引，在矢量瓦片中图层是用索引来表示的\r\n    }\r\n    if (layerIndexs.length == 0) {\r\n      layerIndexs = [-1]; // 如果全部关闭，防止数组为空，加一个不存在的\r\n    }\r\n    return [\r\n      \"match\",\r\n      ['get', 'layer'],\r\n      layerIndexs,\r\n      true,\r\n      false\r\n    ]\r\n  }\r\n  // 获取之前的默认的矢量图层样式，然后在当前样式中，对矢量图层的数据进行图层进行过滤\r\n  let style = map.getStyle();\r\n  let svc = map.getService();\r\n  let vectorStyle = svc.vectorStyle();\r\n  let vectorLayerIds = vectorStyle.layers.map(layer => layer.id);\r\n  let filter = conditionLayers(onLayers, false);\r\n  for (let i = 0; i < style.layers.length; i++) {\r\n    if (vectorLayerIds.includes(style.layers[i].id)) {\r\n      // @ts-ignore\r\n      style.layers[i].filter = filter; // 设置过滤条件\r\n    }\r\n  }\r\n  map.setStyle(style);\r\n}\r\n\r\n// 设置图层透明度 opacity (0-1)\r\nexport const setLayerOpacity = (map: Map, opacity: number, rasterLayerIdMatch?: string) => {\r\n  if (map.hasVectorLayer()) {\r\n    // 如果是矢量图层\r\n    const layers = map.layersBySource(\"vector-source\");\r\n            for(let layerId of layers) {\r\n                const layer = map.getLayer(layerId);\r\n                if (layer.type == \"fill\") {\r\n                    map.setFillOpacity(layerId, opacity);\r\n                } else if (layer.type == \"line\") {\r\n                    map.setLineOpacity(layerId, opacity);\r\n                } else if (layer.type == \"circle\")  {\r\n                    map.setCircleOpacity(layerId, opacity);\r\n                }\r\n            }\r\n  }\r\n  if (rasterLayerIdMatch) {\r\n    // 如果指定了栅格图层的id匹配\r\n    const layers = map.getStyle().layers;\r\n    const curlayers = layers.filter(ly => ly.id.indexOf(rasterLayerIdMatch) >= 0);\r\n    for(let layer of curlayers) {\r\n      map.setRasterOpacity(layer.id, opacity);\r\n    }\r\n  } else {\r\n    const rasterLayerId = map.getService().rasterLayerId();\r\n    if (!!map.getLayer(rasterLayerId)) {\r\n      map.setRasterOpacity(map.getService().rasterLayerId(), opacity);\r\n    }\r\n  }\r\n  \r\n}\r\n\r\n// 把图层置为最下面\r\nexport const  setLayerToLowest = (map: Map, layerId: string) => {\r\n  const layers = map.getStyle().layers;\r\n  if (layers.length == 0) return;\r\n  // 把这个图层放至所有图层的最下面\r\n  map.moveLayer(layerId, layers[0].id)\r\n}","import vjmap, { Map } from 'vjmap'\r\nimport { sleep } from '../utils';\r\nimport { getMapSnapPoints } from './snap';\r\nlet snapObj: any; // 设置的捕捉的实体\r\nlet curMeasureCmd: string; // 当前测量命令\r\nexport async function runMeasureCmd(map: Map, cmd: string) {\r\n  curMeasureCmd = cmd;\r\n  if (cmd != \"measureCancel\") {\r\n    // 先结束当前测量\r\n    await measureCancel(map);\r\n    if (!snapObj) {\r\n        // 获取地图上的捕捉点\r\n        snapObj = {};\r\n        getMapSnapPoints(map, snapObj);\r\n    }\r\n  }\r\n  switch (cmd) {\r\n    case \"measureDist\":\r\n      measureDistLoop(map, snapObj);\r\n      break;\r\n    case \"measureArea\":\r\n      measureAreaLoop(map, snapObj);\r\n      break;\r\n    case \"measureAngle\":\r\n      measureAngleLoop(map, snapObj);\r\n      break;\r\n    case \"measureCoordinate\":\r\n      measureCoordinateLoop(map, snapObj);\r\n      break;\r\n    case \"measureCancel\":\r\n      await measureCancel(map);\r\n      break;\r\n  }\r\n}\r\n\r\n// 结束绘制\r\nconst measureCancel = async (map: Map)=> {\r\n    // 连续发送取消键，第一次取消当前绘制，第二次退出测量\r\n    map.fire(\"keyup\", {keyCode:27});\r\n    await sleep(100);\r\n    map.fire(\"keyup\", {keyCode:27});\r\n    await sleep(100);\r\n    map.setIsInteracting(false); // 没有进行交互操作了\r\n}\r\n\r\nlet popup: vjmap.Popup | null;\r\nconst setPopupText = (text: string, map: Map) => {\r\n    if (text) {\r\n        if (!popup) {\r\n            popup = new vjmap.Popup({\r\n                className: \"my-custom-popup\",\r\n                closeOnClick: false,\r\n                closeButton: false\r\n            })\r\n                .setHTML(text)\r\n                .setMaxWidth(\"500px\")\r\n                .trackPointer()\r\n                .addTo(map)\r\n        }\r\n        else {\r\n            popup.setHTML(text);\r\n        }\r\n    } else {\r\n        // 如果为空时，则删除popup\r\n        if (popup) {\r\n            popup.setLngLat([0,0]); // 取消trackPointer\r\n            popup.remove();\r\n            popup = null;\r\n        }\r\n    }\r\n\r\n}\r\n// 测量距离循环，直至按ESC键取消，否则测量完一条后，继续测量下一条\r\nconst measureDistLoop = async (map: Map, snapObj: any)=> {\r\n    while(true) {\r\n        let res = await measureDist(map, snapObj);\r\n        if (res.exit === true) break;\r\n        if (curMeasureCmd != \"measureDist\") break;\r\n    }\r\n}\r\n\r\n// 测量距离\r\nconst measureDist = async (map: Map, snapObj: any)=> {\r\n    let isDrawing = false;\r\n    let line = await vjmap.Draw.actionDrawLineSting(map, {\r\n        api: {\r\n            getSnapFeatures: snapObj //要捕捉的数据项在后面，通过属性features赋值\r\n        },\r\n        updatecoordinate: (e: any) => {\r\n            if (!e.lnglat) return;\r\n            isDrawing = true;\r\n            const co = map.fromLngLat(e.feature.coordinates[e.feature.coordinates.length - 1]);\r\n            let html = `<span style=\"color: #16417C\">【测量距离】当前坐标:<span style=\"color: #ff0000\"> ${co.x.toFixed(2)}, ${co.y.toFixed(2)}</span>`;\r\n            if (e.feature.coordinates.length == 1) {\r\n                html += \"<br/>请指定要测量的第一点的坐标位置\"\r\n            } else {\r\n                let len = e.feature.coordinates.length;\r\n                html += `<br/>按Alt键取捕捉; Ctrl键启用正交; 退格键删除上一个点`\r\n                html += `<br/>距上一点距离: <span style=\"color: #ff0000\">${getDist(map, [e.feature.coordinates[len - 2], e.feature.coordinates[len -1]])}</span>`\r\n                html += `;  当前总的距离: <span style=\"color: #ff0000\">${getDist(map, e.feature.coordinates)}</span></span>`\r\n            }\r\n            setPopupText(html, map)\r\n        },\r\n        contextMenu: (e: any) => {\r\n            new vjmap.ContextMenu({\r\n                event: e.event.originalEvent,\r\n                theme: \"dark\", //light\r\n                width: \"250px\",\r\n                items: [\r\n                    {\r\n                        label: '确认',\r\n                        onClick: () => {\r\n                            // 给地图发送Enter键消息即可取消，模拟按Enter键\r\n                            map.fire(\"keyup\", {keyCode:13})\r\n                            setPopupText(\"\", map);\r\n                        }\r\n                    },\r\n                    {\r\n                        label: '取消',\r\n                        onClick: () => {\r\n                            // 给地图发送ESC键消息即可取消，模拟按ESC键\r\n                            map.fire(\"keyup\", {keyCode:27})\r\n                            setPopupText(\"\", map);\r\n                        }\r\n                    },{\r\n                        label: '删除上一个点',\r\n                        onClick: () => {\r\n                            // 给地图发送退格键Backspace消息即可删除上一个点，模拟按Backspace键\r\n                            map.fire(\"keyup\", {keyCode:8})\r\n                        }\r\n                    },{\r\n                        label: '结束测距',\r\n                        onClick: () => {\r\n                            // 给地图发送ESC键消息即可取消，模拟按ESC键\r\n                            map.fire(\"keyup\", {keyCode:27})\r\n                            isDrawing = false;\r\n                            setPopupText(\"\", map);\r\n                        }\r\n                    }\r\n                ]\r\n            });\r\n\r\n        }\r\n    });\r\n    if (line.cancel) {\r\n        setPopupText(\"\", map);\r\n        return {\r\n            cancel: true,\r\n            exit: isDrawing === false // 如果还没有绘制，就取消的话，就结束测距\r\n        };// 取消操作\r\n    }\r\n\r\n    let color = vjmap.randomColor();\r\n    let polyline = new vjmap.Polyline({\r\n        data: line.features[0].geometry.coordinates,\r\n        lineColor: color,\r\n        lineWidth: 2\r\n    });\r\n    polyline.addTo(map);\r\n    addMarkersToLine(map, line.features[0].geometry.coordinates, color, polyline.sourceId || \"\", snapObj);\r\n    return {\r\n        polyline\r\n    };\r\n}\r\n\r\n\r\n// 给线的加个点加个测量的结果值\r\nconst addMarkersToLine = (map: Map, coordinates: Array<[number, number]>, color: string, sourceId: string, snapObj: any) => {\r\n    let markerTexts: any = [];\r\n    for(let i = 1; i < coordinates.length; i++) {\r\n        let text = new vjmap.Text({\r\n            text: getDist(map, coordinates.slice(0, i + 1)),\r\n            anchor: \"left\",\r\n            offset: [3, 0], // x,y 方向像素偏移量\r\n            style:{     // 自定义样式\r\n                'cursor': 'pointer',\r\n                'opacity': 0.8,\r\n                'padding': '6px',\r\n                'border-radius': '12px',\r\n                'background-color': color,\r\n                'border-width': 0,\r\n                'box-shadow': '0px 2px 6px 0px rgba(97,113,166,0.2)',\r\n                'text-align': 'center',\r\n                'font-size': '14px',\r\n                'color': `#${color.substring(1).split(\"\").map(c => (15 - parseInt(c,16)).toString(16)).join(\"\")}`,\r\n            }\r\n        });\r\n        text.setLngLat(coordinates[i]).addTo(map);\r\n        markerTexts.push(text);\r\n    }\r\n    // 给第一个点加一个marker用来删除\r\n    const deletePng = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAbNJREFUWEftlrFOAkEQhv9Z4XgJOCrlTgp5ABOhMBoTCws7EzUaeAx5A0sDiYmFxpLGaAkU2KqFArHi4CU4cMccAQN6HHcIwZi7cnd25tt/5maHsOCPFhwfPoAnBarhQFIIccjAkV3qCMhKKct6q1tym1pPAHVVOWMg6+ScgKuYYR7PBaCmKmw5XgLiy4b5NhzkXVVWP4BXa00zTNcXc21oOR4AjAswaX9M2n4u1yLBIoiSbmV0Zcdc0pqd1HdbWwUWDuDqRjMy8lQDM4o54sYRoJcKq6qHclePKnuScQ0pd/RWt2ztVyOhLUFckIwTvWneDiLYnXdVA18O+r/dcNXXIsozCGsMzuhGJ98DUINpAuUAqmhGe33k/JjiG9g4K2ADUFdDOQan7QAIlI8Z7YwP4CvgK/C/FahFlQcwtm0bEeNFa5qJuSpgdT2AzkFyU290H3udMBzYgBD3gnAQa5iFuQJ4eZB6A8ovW/ETgARLmfIyaPZVSZIQRTBdas326Thwx7fAzRA6SREB2l0x2ndTAfTnwH0CrGk4PinY6D5VQHyhNcwbp3N/eyDxduPprH0FPgHEyH4wGIHUYwAAAABJRU5ErkJggg==\";\r\n    let el = document.createElement('div');\r\n    el.className = 'marker';\r\n    el.style.backgroundImage =\r\n        `url(${deletePng})`;\r\n    el.style.width = '20px';\r\n    el.style.height = '20px';\r\n    el.style.backgroundSize = '100%';\r\n    el.style.cursor = \"pointer\";\r\n\r\n    el.addEventListener('click', function (e) {\r\n        map.removeSourceEx(sourceId); // 删除绘制的线\r\n        markerTexts.forEach((m: any) => m.remove());\r\n        markerTexts = [];\r\n\r\n        // 多点了下，给地图发送退格键Backspace消息即可删除上一个点，模拟按Backspace键\r\n        map.fire(\"keyup\", {keyCode:8})\r\n    });\r\n    // Add markers to the map.\r\n    let deleteMarker = new vjmap.Marker({\r\n        element: el,\r\n        anchor: 'right'\r\n    });\r\n    deleteMarker.setLngLat(coordinates[0])\r\n        .setOffset([-5, 0])\r\n        .addTo(map);\r\n    markerTexts.push(deleteMarker)\r\n\r\n    // 把坐标加进捕捉数组中。\r\n    addSnapCoordinates(snapObj, coordinates);\r\n}\r\n// 得到距离值\r\nconst getDist = (map: Map, coordinates: Array<[number, number]>) => {\r\n    let result = vjmap.Math2D.lineDist(map.fromLngLat(coordinates));\r\n    let unit = \"m\";\r\n    if (result >= 1000) {\r\n        result /= 1000;\r\n        unit = \"km\";\r\n    } else if (result < 0.01) {\r\n        result *= 100;\r\n        unit = \"cm\";\r\n    }\r\n    return result.toFixed(2) + \" \" + unit;\r\n}\r\n// 增加捕捉点\r\nconst addSnapCoordinates = (snapObj: any, coordinates: Array<[number, number]>) => {\r\n    snapObj.features.push({\r\n        type: \"Feature\",\r\n        geometry: {\r\n            type: \"LineString\",\r\n            coordinates: [...coordinates]\r\n        }\r\n    })\r\n}\r\n\r\n\r\n\r\n// 测量面积\r\nconst measureArea = async (map: Map, snapObj: any)=> {\r\n    let isDrawing = false;\r\n    let poly = await vjmap.Draw.actionDrawPolygon(map, {\r\n        api: {\r\n            getSnapFeatures: snapObj //要捕捉的数据项在后面，通过属性features赋值\r\n        },\r\n        updatecoordinate: (e: any) => {\r\n            if (!e.lnglat) return;\r\n            isDrawing = true;\r\n            const co = map.fromLngLat(e.feature.coordinates[0][e.feature.coordinates.length - 1]);\r\n            let html = `<span style=\"color: #16417C\">【测量面积】当前坐标:<span style=\"color: #ff0000\"> ${co.x.toFixed(2)}, ${co.y.toFixed(2)}</span>`;\r\n            if (e.feature.coordinates[0].length == 1) {\r\n                html += \"<br/>请指定要测量的第一点的坐标位置\"\r\n            } else {\r\n                html += `<br/>按Alt键取捕捉; Ctrl键启用正交; 退格键删除上一个点`\r\n                html += `<br/>当前面积: <span style=\"color: #ff0000\">${getArea(map, e.feature.coordinates[0])}</span></span>`\r\n            }\r\n            setPopupText(html, map)\r\n        },\r\n        contextMenu: (e: any) => {\r\n            new vjmap.ContextMenu({\r\n                event: e.event.originalEvent,\r\n                theme: \"dark\", //light\r\n                width: \"250px\",\r\n                items: [\r\n                    {\r\n                        label: '确认',\r\n                        onClick: () => {\r\n                            // 给地图发送Enter键消息即可取消，模拟按Enter键\r\n                            map.fire(\"keyup\", {keyCode:13})\r\n                            setPopupText(\"\", map);\r\n                        }\r\n                    },\r\n                    {\r\n                        label: '取消',\r\n                        onClick: () => {\r\n                            // 给地图发送ESC键消息即可取消，模拟按ESC键\r\n                            map.fire(\"keyup\", {keyCode:27})\r\n                            setPopupText(\"\", map);\r\n                        }\r\n                    },{\r\n                        label: '删除上一个点',\r\n                        onClick: () => {\r\n                            // 给地图发送退格键Backspace消息即可删除上一个点，模拟按Backspace键\r\n                            map.fire(\"keyup\", {keyCode:8})\r\n                        }\r\n                    },{\r\n                        label: '结束测面积',\r\n                        onClick: () => {\r\n                            // 给地图发送ESC键消息即可取消，模拟按ESC键\r\n                            map.fire(\"keyup\", {keyCode:27})\r\n                            isDrawing = false;\r\n                            setPopupText(\"\", map);\r\n                        }\r\n                    }\r\n                ]\r\n            });\r\n\r\n        }\r\n    });\r\n    if (poly.cancel) {\r\n        setPopupText(\"\", map);\r\n        return {\r\n            cancel: true,\r\n            exit: isDrawing === false // 如果还没有绘制，就取消的话，就结束测距\r\n        };// 取消操作\r\n    }\r\n\r\n    let color = vjmap.randomColor();\r\n    let polygon = new vjmap.Polygon({\r\n        data: poly.features[0].geometry.coordinates[0],\r\n        fillColor: color,\r\n        fillOpacity: 0.4,\r\n        fillOutlineColor: color,\r\n    });\r\n    polygon.addTo(map);\r\n    addMarkersToPolygon(map, poly.features[0].geometry.coordinates[0], color, polygon.sourceId || \"\", snapObj);\r\n    return {\r\n        polygon\r\n    };\r\n}\r\n\r\n// 测量面积循环，直至按ESC键取消，否则测量完一条后，继续测量下一条\r\nconst measureAreaLoop = async (map: Map, snapObj: any)=> {\r\n    while(true) {\r\n        let res = await measureArea(map, snapObj);\r\n        if (res.exit === true) break;\r\n        if (curMeasureCmd != \"measureArea\") break;\r\n    }\r\n}\r\n\r\n// 给加个测量的结果值\r\nconst addMarkersToPolygon = (map: Map, coordinates: Array<[number, number]>, color: string, sourceId: string, snapObj: any) => {\r\n    let markerTexts: any = [];\r\n    const center = vjmap.polygonCentroid(map.fromLngLat(coordinates));\r\n    let text = new vjmap.Text({\r\n        text: getArea(map, coordinates),\r\n        anchor: \"center\",\r\n        offset: [0, 0], // x,y 方向像素偏移量\r\n        style:{     // 自定义样式\r\n            'cursor': 'pointer',\r\n            'opacity': 0.8,\r\n            'padding': '6px',\r\n            'border-radius': '12px',\r\n            'background-color': `#${color.substring(1).split(\"\").map(c => (15 - parseInt(c,16)).toString(16)).join(\"\")}`,\r\n            'border-width': 0,\r\n            'box-shadow': '0px 2px 6px 0px rgba(97,113,166,0.2)',\r\n            'text-align': 'center',\r\n            'font-size': '14px',\r\n            'color': color,\r\n        }\r\n    });\r\n    text.setLngLat(map.toLngLat(center)).addTo(map);\r\n    markerTexts.push(text);\r\n    // 给第一个点加一个marker用来删除\r\n    const deletePng = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAbNJREFUWEftlrFOAkEQhv9Z4XgJOCrlTgp5ABOhMBoTCws7EzUaeAx5A0sDiYmFxpLGaAkU2KqFArHi4CU4cMccAQN6HHcIwZi7cnd25tt/5maHsOCPFhwfPoAnBarhQFIIccjAkV3qCMhKKct6q1tym1pPAHVVOWMg6+ScgKuYYR7PBaCmKmw5XgLiy4b5NhzkXVVWP4BXa00zTNcXc21oOR4AjAswaX9M2n4u1yLBIoiSbmV0Zcdc0pqd1HdbWwUWDuDqRjMy8lQDM4o54sYRoJcKq6qHclePKnuScQ0pd/RWt2ztVyOhLUFckIwTvWneDiLYnXdVA18O+r/dcNXXIsozCGsMzuhGJ98DUINpAuUAqmhGe33k/JjiG9g4K2ADUFdDOQan7QAIlI8Z7YwP4CvgK/C/FahFlQcwtm0bEeNFa5qJuSpgdT2AzkFyU290H3udMBzYgBD3gnAQa5iFuQJ4eZB6A8ovW/ETgARLmfIyaPZVSZIQRTBdas326Thwx7fAzRA6SREB2l0x2ndTAfTnwH0CrGk4PinY6D5VQHyhNcwbp3N/eyDxduPprH0FPgHEyH4wGIHUYwAAAABJRU5ErkJggg==\";\r\n    let el = document.createElement('div');\r\n    el.className = 'marker';\r\n    el.style.backgroundImage =\r\n        `url(${deletePng})`;\r\n    el.style.width = '20px';\r\n    el.style.height = '20px';\r\n    el.style.backgroundSize = '100%';\r\n    el.style.cursor = \"pointer\";\r\n\r\n    el.addEventListener('click', function (e) {\r\n        map.removeSourceEx(sourceId); // 删除绘制的线\r\n        markerTexts.forEach((m: any) => m.remove());\r\n        markerTexts = [];\r\n    });\r\n    // Add markers to the map.\r\n    let deleteMarker = new vjmap.Marker({\r\n        element: el,\r\n        anchor: 'right'\r\n    });\r\n    deleteMarker.setLngLat(coordinates[0])\r\n        .setOffset([-5, 0])\r\n        .addTo(map);\r\n    markerTexts.push(deleteMarker)\r\n\r\n    // 把坐标加进捕捉数组中。\r\n    addSnapCoordinates(snapObj, coordinates);\r\n}\r\n// 得到面积值\r\nconst getArea = (map: Map, coordinates: Array<[number, number]>) => {\r\n    let result = vjmap.calcPolygonArea(map.fromLngLat(coordinates));\r\n    let unit = \"m²\";\r\n    if (result >= 1e6) {\r\n        result /= 1e6;\r\n        unit = \"km²\";\r\n    } else if (result < 1.0/1e4) {\r\n        result *= 1e4;\r\n        unit = \"cm²\";\r\n    }\r\n    return result.toFixed(2) + \" \" + unit;\r\n}\r\n\r\n\r\n\r\n// 测量角度\r\nconst measureAngle = async (map: Map, snapObj: any)=> {\r\n    let isDrawing = false;\r\n    let line = await vjmap.Draw.actionDrawLineSting(map, {\r\n        pointCount: 3,// 只需三个点，绘制完三个点后，自动结束\r\n        api: {\r\n            getSnapFeatures: snapObj //要捕捉的数据项在后面，通过属性features赋值\r\n        },\r\n        updatecoordinate: (e: any) => {\r\n            if (!e.lnglat) return;\r\n            isDrawing = true;\r\n            const co = map.fromLngLat(e.feature.coordinates[e.feature.coordinates.length - 1]);\r\n            let html = `<span style=\"color: #16417C\">【测量角度】当前坐标:<span style=\"color: #ff0000\"> ${co.x.toFixed(2)}, ${co.y.toFixed(2)}</span>`;\r\n            if (e.feature.coordinates.length == 1) {\r\n                html += \"<br/>请指定要测量的第一点的坐标位置\"\r\n            } else {\r\n                let len = e.feature.coordinates.length;\r\n                html += `<br/>按Alt键取捕捉; Ctrl键启用正交; 退格键删除上一个点`\r\n                html += `<br/>当前角度: <span style=\"color: #ff0000\">${getAngle(map, e.feature.coordinates).angle}</span></span>`\r\n            }\r\n            setPopupText(html, map)\r\n        },\r\n        contextMenu: (e: any) => {\r\n            new vjmap.ContextMenu({\r\n                event: e.event.originalEvent,\r\n                theme: \"dark\", //light\r\n                width: \"250px\",\r\n                items: [\r\n                    {\r\n                        label: '确认',\r\n                        onClick: () => {\r\n                            // 给地图发送Enter键消息即可取消，模拟按Enter键\r\n                            map.fire(\"keyup\", {keyCode:13})\r\n                            setPopupText(\"\", map);\r\n                        }\r\n                    },\r\n                    {\r\n                        label: '取消',\r\n                        onClick: () => {\r\n                            // 给地图发送ESC键消息即可取消，模拟按ESC键\r\n                            map.fire(\"keyup\", {keyCode:27})\r\n                            setPopupText(\"\", map);\r\n                        }\r\n                    },{\r\n                        label: '删除上一个点',\r\n                        onClick: () => {\r\n                            // 给地图发送退格键Backspace消息即可删除上一个点，模拟按Backspace键\r\n                            map.fire(\"keyup\", {keyCode:8})\r\n                        }\r\n                    },{\r\n                        label: '结束测角度',\r\n                        onClick: () => {\r\n                            // 给地图发送ESC键消息即可取消，模拟按ESC键\r\n                            map.fire(\"keyup\", {keyCode:27})\r\n                            isDrawing = false;\r\n                            setPopupText(\"\", map);\r\n                        }\r\n                    }\r\n                ]\r\n            });\r\n\r\n        }\r\n    });\r\n    if (line.cancel) {\r\n        setPopupText(\"\", map);\r\n        return {\r\n            cancel: true,\r\n            exit: isDrawing === false // 如果还没有绘制，就取消的话，就结束测距\r\n        };// 取消操作\r\n    }\r\n\r\n    let color = vjmap.randomColor();\r\n    let polyline = new vjmap.Polyline({\r\n        data: line.features[0].geometry.coordinates,\r\n        lineColor: color,\r\n        lineWidth: 2\r\n    });\r\n    polyline.addTo(map);\r\n    addMarkersToAngle(map, line.features[0].geometry.coordinates, color, polyline.sourceId || \"\", snapObj);\r\n    return {\r\n        polyline\r\n    };\r\n}\r\n\r\n// 测量角度循环，直至按ESC键取消，否则测量完一条后，继续测量下一条\r\nconst measureAngleLoop = async (map: Map, snapObj: any)=> {\r\n    while(true) {\r\n        let res = await measureAngle(map, snapObj);\r\n        if (res.exit === true) break;\r\n        if (curMeasureCmd != \"measureAngle\") break;\r\n    }\r\n}\r\n\r\n\r\n\r\n// 给加个测量的结果值\r\nconst addMarkersToAngle = (map: Map, coordinates: Array<[number, number]>, color: string, sourceId: string, snapObj: any) => {\r\n    if (coordinates.length < 3) return;\r\n    let markerTexts: any = [];\r\n    let points = map.fromLngLat(coordinates);\r\n    let textPoint = coordinates[1];\r\n    let ang = getAngle(map, coordinates);\r\n    // 绘制注记圆弧\r\n    const cirleArcPath = vjmap.getCirclePolygonCoordinates(\r\n        points[1],\r\n        points[1].distanceTo(points[0]) / 4.0, 36,\r\n        ang.startAngle,  ang.endAngle, false);\r\n    let path = new vjmap.Polyline({\r\n        data: map.toLngLat(cirleArcPath),\r\n        lineColor: color,\r\n        lineWidth: 2\r\n    });\r\n    path.addTo(map);\r\n    markerTexts.push(path)\r\n\r\n    // @ts-ignore\r\n    let arcPoints = path.getData().features[0].geometry.coordinates;\r\n    let arcMid = arcPoints[Math.ceil(arcPoints.length / 2)];// 取中点\r\n    let textAngle = vjmap.radiansToDegrees(-map.fromLngLat(arcMid).angleTo(points[1])) + 90;\r\n    if (textAngle > 90) textAngle += 180;\r\n    else if (textAngle > 270) textAngle -= 180;\r\n    let text = new vjmap.Text({\r\n        text: ang.angle as string,\r\n        anchor: \"center\",\r\n        rotation: textAngle,\r\n        offset: [0, 0], // x,y 方向像素偏移量\r\n        style:{     // 自定义样式\r\n            'cursor': 'pointer',\r\n            'opacity': 0.8,\r\n            'padding': '6px',\r\n            'border-radius': '12px',\r\n            'background-color': color,\r\n            'border-width': 0,\r\n            'box-shadow': '0px 2px 6px 0px rgba(97,113,166,0.2)',\r\n            'text-align': 'center',\r\n            'font-size': '14px',\r\n            'color': `#${color.substring(1).split(\"\").map(c => (15 - parseInt(c,16)).toString(16)).join(\"\")}`,\r\n        }\r\n    });\r\n    text.setLngLat(arcMid).addTo(map);\r\n    markerTexts.push(text);\r\n    // 给第一个点加一个marker用来删除\r\n    const deletePng = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAbNJREFUWEftlrFOAkEQhv9Z4XgJOCrlTgp5ABOhMBoTCws7EzUaeAx5A0sDiYmFxpLGaAkU2KqFArHi4CU4cMccAQN6HHcIwZi7cnd25tt/5maHsOCPFhwfPoAnBarhQFIIccjAkV3qCMhKKct6q1tym1pPAHVVOWMg6+ScgKuYYR7PBaCmKmw5XgLiy4b5NhzkXVVWP4BXa00zTNcXc21oOR4AjAswaX9M2n4u1yLBIoiSbmV0Zcdc0pqd1HdbWwUWDuDqRjMy8lQDM4o54sYRoJcKq6qHclePKnuScQ0pd/RWt2ztVyOhLUFckIwTvWneDiLYnXdVA18O+r/dcNXXIsozCGsMzuhGJ98DUINpAuUAqmhGe33k/JjiG9g4K2ADUFdDOQan7QAIlI8Z7YwP4CvgK/C/FahFlQcwtm0bEeNFa5qJuSpgdT2AzkFyU290H3udMBzYgBD3gnAQa5iFuQJ4eZB6A8ovW/ETgARLmfIyaPZVSZIQRTBdas326Thwx7fAzRA6SREB2l0x2ndTAfTnwH0CrGk4PinY6D5VQHyhNcwbp3N/eyDxduPprH0FPgHEyH4wGIHUYwAAAABJRU5ErkJggg==\";\r\n    let el = document.createElement('div');\r\n    el.className = 'marker';\r\n    el.style.backgroundImage =\r\n        `url(${deletePng})`;\r\n    el.style.width = '20px';\r\n    el.style.height = '20px';\r\n    el.style.backgroundSize = '100%';\r\n    el.style.cursor = \"pointer\";\r\n\r\n    el.addEventListener('click', function (e) {\r\n        map.removeSourceEx(sourceId); // 删除绘制的线\r\n        markerTexts.forEach((m: any) => m.remove());\r\n        markerTexts = [];\r\n    });\r\n    // Add markers to the map.\r\n    let deleteMarker = new vjmap.Marker({\r\n        element: el,\r\n        anchor: 'right'\r\n    });\r\n    deleteMarker.setLngLat(coordinates[1])\r\n        .setOffset([-5, 0])\r\n        .addTo(map);\r\n    markerTexts.push(deleteMarker)\r\n\r\n    // 把坐标加进捕捉数组中。\r\n    addSnapCoordinates(snapObj, coordinates);\r\n}\r\n// 得到角度值\r\nconst getAngle = (map: Map, coordinates: Array<[number, number]>) => {\r\n    let points = map.fromLngLat(coordinates);\r\n    if (points.length < 3) return {  angle: 0.0 }\r\n    let angle1 = points[0].angleTo(points[1]);\r\n    let angle2 = points[2].angleTo(points[1]);\r\n    let angle = angle1 - angle2;\r\n    let deg = vjmap.radiansToDegrees(angle);//弧度转角度\r\n    let dir = true;\r\n    if (deg < 0) {\r\n        deg = -deg;\r\n        dir = !dir;\r\n    }\r\n    if (deg > 180) {\r\n        deg = 360 - deg;\r\n        dir = !dir;\r\n    }\r\n    let startAngle = !dir ? vjmap.radiansToDegrees(angle1) : vjmap.radiansToDegrees(angle2);\r\n    let endAngle = dir ? vjmap.radiansToDegrees(angle1) : vjmap.radiansToDegrees(angle2);\r\n    startAngle = startAngle < 0 ? 360 + startAngle : startAngle;\r\n    endAngle = endAngle < 0 ? 360 + endAngle : endAngle;\r\n    if (endAngle < startAngle) {\r\n        endAngle += 360;\r\n    }\r\n    return {\r\n        angle: deg.toFixed(2) + \"°\",\r\n        dir,\r\n        startAngle,\r\n        endAngle\r\n    }\r\n}\r\n\r\n\r\n// 测量坐标\r\nconst measureCoordinate = async (map: Map, snapObj: any)=> {\r\n    let isDrawing = false;\r\n    let point = await vjmap.Draw.actionDrawPoint(map, {\r\n        api: {\r\n            getSnapFeatures: snapObj //要捕捉的数据项在后面，通过属性features赋值\r\n        },\r\n        updatecoordinate: (e: any) => {\r\n            if (!e.lnglat) return;\r\n            isDrawing = true;\r\n            const co = map.fromLngLat(e.lnglat);\r\n            let html = `<span style=\"color: #16417C\">【测量坐标】当前坐标:<span style=\"color: #ff0000\"> ${co.x.toFixed(2)}, ${co.y.toFixed(2)}</span></span>`;\r\n            setPopupText(html, map)\r\n        },\r\n        contextMenu: (e: any) => {\r\n            new vjmap.ContextMenu({\r\n                event: e.event.originalEvent,\r\n                theme: \"dark\", //light\r\n                width: \"250px\",\r\n                items: [\r\n                    {\r\n                        label: '确认',\r\n                        onClick: () => {\r\n                            // 给地图发送Enter键消息即可取消，模拟按Enter键\r\n                            map.fire(\"keyup\", {keyCode:13})\r\n                            setPopupText(\"\", map);\r\n                        }\r\n                    },\r\n                    {\r\n                        label: '取消',\r\n                        onClick: () => {\r\n                            // 给地图发送ESC键消息即可取消，模拟按ESC键\r\n                            map.fire(\"keyup\", {keyCode:27})\r\n                            setPopupText(\"\", map);\r\n                        }\r\n                    },\r\n                    {\r\n                        label: '结束测坐标',\r\n                        onClick: () => {\r\n                            // 给地图发送ESC键消息即可取消，模拟按ESC键\r\n                            map.fire(\"keyup\", {keyCode:27})\r\n                            isDrawing = false;\r\n                            setPopupText(\"\", map);\r\n                        }\r\n                    }\r\n                ]\r\n            });\r\n\r\n        }\r\n    });\r\n    if (point.cancel) {\r\n        setPopupText(\"\", map);\r\n        return {\r\n            cancel: true,\r\n            exit: isDrawing === false\r\n        };// 取消操作\r\n    }\r\n\r\n    addMarkersToCoord(map, point.features[0].geometry.coordinates);\r\n    return {\r\n        point\r\n    };\r\n}\r\n\r\n// 测量坐标循环，直至按ESC键取消\r\nconst measureCoordinateLoop = async (map: Map, snapObj: any)=> {\r\n    while(true) {\r\n        let res = await measureCoordinate(map, snapObj);\r\n        if (res.exit === true) break;\r\n        if (curMeasureCmd != \"measureCoordinate\") break;\r\n    }\r\n}\r\n\r\n\r\n\r\n// 给加个点加个测量的结果值\r\nconst addMarkersToCoord = (map: Map, coordinates: [number, number]) => {\r\n    let markerTexts: any = [];\r\n    let co = map.fromLngLat(coordinates);\r\n    let content = `X: ${co.x.toFixed(2)}, Y: ${co.y.toFixed(2)}`\r\n    let marker = createLeaderMarker(map, coordinates, content);\r\n    markerTexts.push(marker);\r\n\r\n    // 给第一个点加一个marker用来删除\r\n    const deletePng = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAbNJREFUWEftlrFOAkEQhv9Z4XgJOCrlTgp5ABOhMBoTCws7EzUaeAx5A0sDiYmFxpLGaAkU2KqFArHi4CU4cMccAQN6HHcIwZi7cnd25tt/5maHsOCPFhwfPoAnBarhQFIIccjAkV3qCMhKKct6q1tym1pPAHVVOWMg6+ScgKuYYR7PBaCmKmw5XgLiy4b5NhzkXVVWP4BXa00zTNcXc21oOR4AjAswaX9M2n4u1yLBIoiSbmV0Zcdc0pqd1HdbWwUWDuDqRjMy8lQDM4o54sYRoJcKq6qHclePKnuScQ0pd/RWt2ztVyOhLUFckIwTvWneDiLYnXdVA18O+r/dcNXXIsozCGsMzuhGJ98DUINpAuUAqmhGe33k/JjiG9g4K2ADUFdDOQan7QAIlI8Z7YwP4CvgK/C/FahFlQcwtm0bEeNFa5qJuSpgdT2AzkFyU290H3udMBzYgBD3gnAQa5iFuQJ4eZB6A8ovW/ETgARLmfIyaPZVSZIQRTBdas326Thwx7fAzRA6SREB2l0x2ndTAfTnwH0CrGk4PinY6D5VQHyhNcwbp3N/eyDxduPprH0FPgHEyH4wGIHUYwAAAABJRU5ErkJggg==\";\r\n    let el = document.createElement('div');\r\n    el.className = 'marker';\r\n    el.style.backgroundImage =\r\n        `url(${deletePng})`;\r\n    el.style.width = '20px';\r\n    el.style.height = '20px';\r\n    el.style.backgroundSize = '100%';\r\n    el.style.cursor = \"pointer\";\r\n\r\n    el.addEventListener('click', function (e) {\r\n        markerTexts.forEach((m: any) => m.remove());\r\n        markerTexts = [];\r\n\r\n    });\r\n    // Add markers to the map.\r\n    let deleteMarker = new vjmap.Marker({\r\n        element: el,\r\n        anchor: 'right'\r\n    });\r\n    deleteMarker.setLngLat(coordinates)\r\n        .setOffset([-5, 0])\r\n        .addTo(map);\r\n    markerTexts.push(deleteMarker)\r\n\r\n}\r\n\r\n// 引线标记\r\nconst createLeaderMarker = (map: Map, lnglat: [number, number], content: string) => {\r\n    let el = document.createElement('div');\r\n    el.className = 'marker';\r\n    el.style.position = 'absolute'\r\n\r\n    let img = document.createElement(\"div\");\r\n    img.style.backgroundImage =\r\n        'url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAB4AAAAAlCAYAAACj1PQVAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQ1IDc5LjE2MzQ5OSwgMjAxOC8wOC8xMy0xNjo0MDoyMiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTkgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MTJFMTU1RjExN0UzMTFFOTg3RTBFODdGNTY0NThGQkUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MTJFMTU1RjIxN0UzMTFFOTg3RTBFODdGNTY0NThGQkUiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxMkUxNTVFRjE3RTMxMUU5ODdFMEU4N0Y1NjQ1OEZCRSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxMkUxNTVGMDE3RTMxMUU5ODdFMEU4N0Y1NjQ1OEZCRSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pj97JFoAAAV9SURBVHja7N1faJ1nHQfw33nzpuekaZfWNFmbLHXWdf7DWgvebF4M0SEZhTG8mKvFyzG9UJFKh9peVGnd0DkE/10Ic6s6BBEGbshggho3BVGnRnC2s1n/ras2J2uzc05PXp+3yZzSm7XJkvfi84HveZ9z3ve8F7/bL8/71oqiiMs8NhCLsCllfcpfAwAAAAAAAIDlsXM68jfgtl9K2Z3Sa8IAAAAAAAAAb7hjKW8uF9kS3/jdKR9PaZkxAAAAAAAAwPJa6h3A96X0pBxK+bLxAgAAAAAAACyfpSyAP5jy4ZQXUh747687p00ZAAAAAAAAYBlkS3if+xfW+1MuGC0AAAAAAADA8lqqAnh3yvaUZ1MeMlYAAAAAAACA5bcUBXBfyoGF9edSusYKAAAAAAAAsPyWogD+VMpYypMpTxgpAAAAAAAAwMpYbAG8IWVvylzKHuMEAAAAAAAAWDmLLYC/mDKQ8nDKH4wTAAAAAAAAYOUspgC+IeWelNmYL4IBAAAAAAAAWEGLKYAPpfSmfD1lyigBAAAAAAAAVtbVFsA3pdyR8lLMF8EAAAAAAAAArLCrKYBrKfcvHA+kNI0RAAAAAAAAYOVdTQFc7vwtdwA/l/ItIwQAAAAAAACohistgMt3/h5cWO9N6RghAAAAAAAAQDVcaQF8d8rWlImUnxgfAAAAAAAAQHVcSQF8Tcq+lCJlz8IRAAAAAAAAgIq4kgK4fOTzUMzv/J0wOgAAAAAAAIBqeb0F8FjKp2P+nb97jQ0AAAAAAACgel5vAXwgpS/l2ynPGRsAAAAAAABA9eSjd370sh+P7/q/r9tTdqc0Y74IBgAAAAAAAKCC8v9Zl7uB6yn9o4fHG+lYS2n/867Hv5bXivLcoZQzRgYAAAAAAABQTfnw5nvjxWMHe9N6cP+OyVtv2nj2ruFG6209WbGqM5c181rx9m5RO/ngn2/4zlf/tLV2fNfPCmMDAAAAAAAAqJ68LH+HGq2xRz7wu2+8a31zvCgiLs5FlC3vqp4YKS8638mzqZf7tqXlb1MuGBsAAAAAAABA9ZSPdh58tfyd7UScOh9xYjqLszNZlGVwN6U/71z7hR1/e/g9g9NbRg+P9xobAAAAAAAAQPVk+3ZMfujV8vf0TC3WXWzE9ZveHyNjt0UxOxCnp7NotiPWr2pfl67dk/6zxtgAAAAAAAAAqie7eePZXeVO33OtiOGsHqtvfjDi1scibnkkesafipHVI3HuQi3a3Yh3rpsZT/+5ZvTweM3oAAAAAAAAAKolH2q0byzf+dtuZ9G/8b0RW+587ezat0a84xPR+8z+aHU7MVDvbLhl05lrf3FyaGr08Hj5muA4/qMfmiIAAAAAAABABWS1KPJLTW75UR+8/Ir6uksvCi6K+a/Dfa26sQEAAAAAAABUT/ZyJz+Z19IiL6J7eiLi/NRrZ4tuxNEfRzvmorcnoj2XvfL41MZTMV8XAwAAAAAAAFAh2eS5tU9kWcRAo4ipC9MRP98ZMfnNiH/8IOLJO+LMC7+ORl83Gj0RR5r9z8x08nOhAAYAAAAAAAConPyzT2976H1D//7YYL21ZW5NN442n4/ep/ddeuxzK+air68bb2pEdCN75dEj192Xfp4xNgAAAAAAAIDqyWY6+akHnt16d7Oz6uRAPWJkoIi1azuxek0nhge6MdQXUatlrZ8+P/L5706+ZSLKXhgAAAAAAACAyik3+s5+/++bJ+751fbbfv/S+kc7c/l0WQSva0TUe2rtIzNrJr7yxxs/8pnfbPteurY5vPlej38GAAAAAAAAqKC8LHRfPHZw9penNvwl5ZP1nrmB268/MdafX+x96sTQ8aMz/f9K102ntJS/AAAAAAAAANX1HwEGAM75MhcANnAkAAAAAElFTkSuQmCC\")';\r\n    img.style.backgroundRepeat = \"no-repeat\"\r\n    img.style.height = '37px';\r\n    img.style.width = '100px';\r\n    img.style.position = 'absolute';\r\n    img.style.left = '-3px';\r\n    img.style.bottom = '-3px';\r\n    img.style.right = \"0px\"\r\n    el.appendChild(img);\r\n\r\n    let panel = document.createElement(\"div\");\r\n    panel.style.height = '50px';\r\n    panel.style.width = '350px';\r\n    panel.style.position = 'absolute';\r\n    panel.style.left = '97px';\r\n    panel.style.top = '-60px';\r\n    panel.style.border = \"solid 1px #8E0EFF\";\r\n    panel.style.background = 'linear-gradient(#00ffff, #00ffff) left top,  linear-gradient(#00ffff, #00ffff) left top,     linear-gradient(#00ffff, #00ffff) right bottom,    linear-gradient(#00ffff, #00ffff) right bottom';\r\n    panel.style.backgroundRepeat = 'no-repeat';\r\n    panel.style.backgroundColor ='rgba(87,255,255, 0.3)'\r\n    panel.style.backgroundSize = '1px 6px, 6px 1px';\r\n    panel.style.fontSize = '18px';\r\n    panel.style.color = '#ffffff';\r\n    panel.innerHTML =  `<div style='margin: 15px 5px 15px 5px'>${content}</div>`;\r\n    el.appendChild(panel);\r\n\r\n    // Add markers to the map.\r\n    let marker = new vjmap.Marker({\r\n        element: el,\r\n        anchor: \"bottom-left\"\r\n    })\r\n    marker.setLngLat(lnglat)\r\n        .addTo(map);\r\n    return marker\r\n}\r\n\r\n\r\nconst clearAll  = (map: Map)=> {\r\n    // 清空绘制的图层，如果怕误删除，每次绘制完成，把相关的 sourceId和marker记录下来。然后依次删除\r\n    // @ts-ignore\r\n    Object.keys(map.getStyle().sources).filter(e=>e.indexOf(\"custom_\") == 0).forEach(e=> map.removeSourceEx(e));\r\n    // 清除marker\r\n    map.removeMarkers();\r\n}\r\n\r\n","import type { Map } from \"vjmap\";\r\n\r\n// 创建一个更新样式\r\nexport const createUpdateMapStyleObj = (\r\n  map: Map,\r\n  option?: Record<string, any>\r\n) => {\r\n  if (map.hasVectorLayer()) {\r\n    // 如果底图是矢量瓦片\r\n    return createUpdateMapStyleVectorObj(map, option);\r\n  } else {\r\n    // 如果底图是栅格瓦片\r\n    return createUpdateMapStyleRasterObj(map, option);\r\n  }\r\n};\r\n\r\n// 栅格样式\r\nexport const createUpdateMapStyleRasterObj = (\r\n  map: Map,\r\n  option?: Record<string, any>\r\n) => {\r\n  option = option || {};\r\n  const svc = map.getService();\r\n  // 需要不可见的实体id数组\r\n  const hideObjectIds: Set<string> = new Set();\r\n\r\n  // 更改样式\r\n  let expression = \"\"; // 表达式数组\r\n  let curStyle = {};\r\n  const updateStyle = (style?: any) => {\r\n    curStyle = {\r\n      backcolor: svc.currentMapParam()?.darkMode ? 0 : 0xffffff,\r\n      expression: expression,\r\n      ...style,\r\n      ...option?.style\r\n    };\r\n    map.updateStyle(svc, {\r\n      name: option?.styleName ?? \"myCustomStyle_temp\", // 临时样式图层，用来临时修改，保持的时候，会把此样式的数据复制到myCustomStyle 样式\r\n      ...curStyle,\r\n    });\r\n  };\r\n\r\n  // 修改是否显示\r\n  const modifyVisible = (visible: boolean) => {\r\n    let result = \"\";\r\n    if (visible !== undefined) {\r\n      result += `gOutVisible:=${visible ? 1 : 0};`;\r\n    }\r\n    return result;\r\n  };\r\n\r\n  // 增加实体对象id判断条件,只要满足任何一种类型即可,如 ['283','285']\r\n  const conditionObjectIds = (objectIds: string[]) => {\r\n    if (!Array.isArray(objectIds)) objectIds = [objectIds]; // 先转成数组，再统一用数组去算吧\r\n    let strObjectIds = objectIds.join(\"||\");\r\n    return `gInObjectId  in  '${strObjectIds}'`;\r\n  };\r\n\r\n  const refresh = async () => {\r\n    // objectId\r\n    if (hideObjectIds.size == 0) {\r\n      expression = \"\";\r\n      await updateStyle();\r\n    } else {\r\n      let condition = conditionObjectIds(Array.from(hideObjectIds));\r\n      let value1 = modifyVisible(false);\r\n      expression = `if(${condition}) {${value1} } `;\r\n      await updateStyle();\r\n    }\r\n  };\r\n\r\n  const addHideObjectIds = async (\r\n    objectIds: string[],\r\n    noUpdate?: boolean,\r\n    isClear?: boolean\r\n  ) => {\r\n    if (isClear) {\r\n      hideObjectIds.clear();\r\n    }\r\n    objectIds.forEach((id) => hideObjectIds.add(id));\r\n    if (!noUpdate) {\r\n      await refresh();\r\n    }\r\n  };\r\n\r\n  const getClipBounds = () => {\r\n    if (option?.style?.clipbounds) {\r\n      return option?.style?.clipbounds\r\n    }\r\n  }\r\n  return {\r\n    addHideObjectIds,\r\n    refresh,\r\n    hideObjectIds,\r\n    getClipBounds\r\n  };\r\n};\r\n\r\n// 矢量样式\r\nexport const createUpdateMapStyleVectorObj = (\r\n  map: Map,\r\n  option?: Record<string, any>\r\n) => {\r\n  const svc = map.getService();\r\n  // 需要不可见的实体id数组\r\n  const hideIds: Set<string> = new Set();\r\n  // 增加实体id判断条件,只要满足任何一种类型即可,如 [28, 29]\r\n  const conditionFeatureIds = (featureIds: any) => {\r\n    if (!Array.isArray(featureIds)) featureIds = [featureIds]; // 先转成数组，再统一用数组去算吧\r\n    return [\"match\", [\"id\"], featureIds, true, false];\r\n  };\r\n\r\n  const refresh = async () => {\r\n    // 获取所有矢量图层id\r\n    let layers = svc.vectorStyle().layers.map((layer) => layer.id);\r\n    let featureId = Array.from(hideIds);\r\n    map.setFilterEx(layers, [\"!\", conditionFeatureIds(featureId)]); // 取反，相当于过滤掉这些id\r\n  };\r\n\r\n  const addHideObjectIds = async (\r\n    objectIds: string[],\r\n    noUpdate?: boolean,\r\n    isClear?: boolean\r\n  ) => {\r\n    if (isClear) {\r\n      hideIds.clear();\r\n    }\r\n    objectIds.forEach((id) => hideIds.add(id));\r\n    if (!noUpdate) {\r\n      await refresh();\r\n    }\r\n  };\r\n  \r\n  const getClipBounds = () => {\r\n    if (option?.style?.clipbounds) {\r\n      return option?.style?.clipbounds\r\n    }\r\n  }\r\n  return {\r\n    addHideObjectIds,\r\n    refresh,\r\n    hideObjectIds: hideIds,\r\n    getClipBounds\r\n  };\r\n};\r\n"],"names":["toMapLayer","layer","props","sleep","ms","resolve","execProgram","code","map","mapApp","context","AsyncFunction","vjmap","common","getShardsTileUrl","tileUrl","svc","matched","match","items","n1","n2","urls","n","getTileShards","newTileUrl","tileShards","isAlphanumeric","char","isWebBaseMap","baseMapType","getEntityObjectId","id","objectId","k","transformGeoJsonData","data","basePt","destPt","scale","angle","isGeoCoord","pt","point","transformFourParam","fourParam","newPoint","LayerBase","__publicField","mapLayer","layerId","layerProps","oldLayer","visibleOff","sourceId","forceUpdate","timerUpdate","src","reject","image","options","properties","newOpts","key","value","animateImages","animateImagesOptionsKeys","animateImagesOptions","img","createImagesOptions","width","height","opts","i","_a","imageId","marker","LineLayer","FillLayer","SymbolLayer","CircleLayer","FillExtrusionLayer","HeatmapLayer","MarkerLayer","lnglat","element","el","_b","popup","_c","html","htmlValue","features","geometry","coordinates","co","m","PopupLayer","AnimateLineLayer","featureCollection","AnimateSymbolLayer","AnimateFillLayer","SymbolClusterLayer","geoDatas","outerColors","color","innerColors","_d","_e","clusterLayer","click","e","clusterId","err","zoom","mouseenter","mouseleave","clickUnclustered","mouseenterUnclustered","mouseleaveUnclustered","event","MarkerClusterLayer","textColors","num","isText","createMarker","curMarkerData","clusterMarkersData","text","pts","c","showBounds","lngLatBounds","updateMarker","TextLayer","content","contentValue","BreathingMarkerLayer","RotatingMarkerLayer","HaloRingMarkerLayer","DiffusedMarkerLayer","TextBorderMarkerLayer","FluorescenceMarkerLayer","CurveLayer","curvePath","LineExtrusionsLayer","lineCoords","splitLineCoords","coord","path","initData","latest","prop","polyPath","geojson","ArrowLineLayer","polylineArrow","p","arrow","PathAnimateLayer","symbolSourceid","symbolOptionsKeys","symbolOptions","randID","curFps","anim","status","carGeoJson","symbolSourceId","SymbolPathAnimateLayer","geoPointDatas","geoLineDatas","lineOptionsKeys","lineOptions","lastValue","isReverse","start","end","FillExtrusionsAnimateLayer","mapProgressToValues","idx","GeojsonLayer","fillOptionsKeys","fillOptions","circleOptionsKeys","circleOptions","DrawLayer","f","RasterLayer","VectorLayer","vectorStyle","DivOverlayLayer","divOverlayOpts","SvgOverlayLayer","BackgroundLayer","SkyLayer","providerLayers","_TsIndexDb","dbName","version","tables","dbOptions","tableName","res","transaction","currentValue","condition","handle","cursor","store","_","v","request","task","error","name","idb","option","indexs","commit","mode","backF","handler","success","TsIndexDb","initIndexDb","getInstance","CacheDbStorage","item","parseJson","records","toJson","record","r","prefix","cacheStorage","queryMapData","queryParam","cacheKey","cahceResult","result","beginPos","limit","bounds","query","retResult","ProcessDataToFeatureCollection","toProperties","param","excludeKeys","isUseGeomCoord","FeatureCollection","ent","ft","points","feature","requestChangeData","args","evalDataConvert","convertArrayToGeoJson","colls","asyncFunc","utils","sysImages","size","canvas","duration","colorList","t","radius","outerRadius","outFillRgb","innerFillRgb","_f","_g","osmProviderTiles","tiandituProviderTiles","isImageUrl","tokens","tk","gaodeProviderTiles","loadWebMap","config","webMapTiles","locale","WmsOverlayMapType","createMapStyleLayerName","overMapType","overMapParam","backcolor","getWmsMapsBounds","getMapBounds","omp","metadata","mapbounds","cad2webCoordinate","b","overlay2BaseCoordinate","extent","getMapInfo","baseMapParam","getFourParam","epsg3857Points","w","cadPoints","basePoints","mapids","versions","layers","crss","fourParameters","getWmsDirectTileUrl","getWmsAutoWebBaseMapTileUrl","mapInfos","getWmsAutoCadBaseMapTileUrl","overMap","o","tiles","getWmsParamTileUrl","getWmsTileUrl","crs","fourParameterStr","isWgs84","fourParameter","webPt","web2cadCoordinate","cadPt","isSetRotateZero","basemapIsWeb","base2OverlayCoordinate","getEpsgRange","type","epsgs","begin","listenKeyEvent","curEvent","keyDownEvent","keyupEvent","MapApp","containerId","env","mapBounds","mapExtent","prj","cfg","noSetMapOptions","mapSources","mapLayers","_j","_i","_h","_k","_l","_m","_n","addSourcesNoDeps","addSourcesDeps","s","source","mapImages","val","loadImages","createSysImg","sources","inst","cleaner","isUpdateConfig","mapSource","index","isSetData","sourceType","isRemove","p1","p2","wmsBounds","y","layerClass","layerInst","allStyleLayers","lyIds","ly","ctrl","controlName","set","fromSourceId","sourceSet","sId","digit","creatPoint","isGeometryCollection","createMText","fixColor","creatLineString","cadLineWidths","line_width","opacity","createCircle","creatPolygon","ents","fill","outline","fontHeight","getTextRefCo","refCo1","refCo2","g","f1","f2","createText","textAttr","x","baseCo","attr","circle","modifyDrawText","draw","promptFunc","message","selected","textData","drawText","bounds1","bounds2","geoTextData","newTextData","exportDwg","newMapId","entsJson","defaultRadius","addEntitys","isTrackFeature","delEnts","getTrackFeatureProperty","entId","subFeature","doc","setTrackFeatureProperty","trackFeature","addExportRefInfoInText","addHighLightSourceLayer","highlightColor","clearHighLightSourceLayer","getSelectedWholeEntityId","disableSelectEntities","isPointSel","objectIdSet","objectIdCondSet","specialChars","cond1","cond2","getHighlightEntities","useGeomCoord","includeWholeEntity","isClearOld","queryIdContion","drawGeom","drawCoord","mapDrawData","clearHighlight","snapCache","getMapSnapPoints","snapObj","snapQueryLimit","mapid","ver","values","selectFeatures","disableSnap","drawPoint","drawRect","geom","editCadEntity","updateMapStyleObj","editOp","showInfoFunc","dlgConfirmInfo","isRectSel","editOpName","cancelDraw","hideObjectIds","memoryObjectidSet","geomObjectidSet","geomIdSet","onOk","modifyProps","isModifyText","deleteEntitys","hideEntityObjectIds","hideEntityIds","createGeomData","oldFeatureLength","addFeaturesToDraw","idSet","modiPropIndex","addFeatureId","newFtColl","interactiveCreateGeom","onCancel","getTextProps","objectIdProps","ftProps","deleteCadEntity","modifyCadEntity","copyCadEntity","entities","docMapBounds","environment","linetypes","dbFrom","asFeatureCollection","clr","featureAttr","loadDataToDraw","setFeatureProperty","drawProperty","drawLineSting","drawPolygon","drawFillExrusion","polygonToPolyline","drawCircle","isFill","drawRectangle","drawSlantRectangle","selectRotate","basePointRes","basePoint","endPoint","tempLine","oldSelected","rotatePointRes","updateFeatures","changeFeatures","rotatePt","toBezierCurve","preFeatures","newFeatures","drawEllipse","isSetAngle","centerPt","center","ellipse","newData","drawEllipseFill","drawEllipseEdge","drawEllipseFillArc","drawEllipseArc","getGeoJsonBounds","tempDraw","dataBounds","geoDataBounds","drawData","length","dataGeoBounds","scalex","scaley","dblScale","geoCenter","oldData","drawDestPt","drawScalePoint","drawRotatePoint","drawFeatures","drawArrow","linetype","docBounds","polyline","fillColor","hatch","createLineTypePolyline","coordinate","drawLine","dbEnt","throttle","method","delay","timer","current","createLineTypeCurve","createCurve","createHatch","getQueryGeomData","propData","createOutSymbol","symbolMapId","symbolMapVer","styleName","innerProps","ids","addFeatureID","disableInteractive","docProj","refInfo","drawLayer","combineInObject","addFeatureIds","oldSize","objectid","featureIds","getPointOnePixelDrawStyleOption","pointIdx","switchCadLayers","isVectorStyle","onLayers","sum","switchVectorLayers","getLayerIdByName","conditionLayers","inputIsIndex","layerIndexs","style","vectorLayerIds","filter","setLayerOpacity","rasterLayerIdMatch","curlayers","rasterLayerId","setLayerToLowest","curMeasureCmd","runMeasureCmd","cmd","measureCancel","measureDistLoop","measureAreaLoop","measureAngleLoop","measureCoordinateLoop","setPopupText","measureDist","isDrawing","line","len","getDist","addMarkersToLine","markerTexts","deletePng","deleteMarker","addSnapCoordinates","unit","measureArea","poly","getArea","polygon","addMarkersToPolygon","measureAngle","getAngle","addMarkersToAngle","ang","cirleArcPath","arcPoints","arcMid","textAngle","angle1","angle2","deg","dir","startAngle","endAngle","measureCoordinate","addMarkersToCoord","createLeaderMarker","panel","createUpdateMapStyleObj","createUpdateMapStyleVectorObj","createUpdateMapStyleRasterObj","expression","curStyle","updateStyle","modifyVisible","visible","conditionObjectIds","objectIds","refresh","value1","noUpdate","isClear","hideIds","conditionFeatureIds","featureId"],"mappings":"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"}